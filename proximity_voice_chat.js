const _0x22cd85=_0x4232;(function(_0x1adb5a,_0x174df7){const _0x546452=_0x4232,_0x476ff6=_0x1adb5a();while(!![]){try{const _0x4c3a1d=-parseInt(_0x546452(0x18e))/0x1*(-parseInt(_0x546452(0x182))/0x2)+-parseInt(_0x546452(0x1ac))/0x3+-parseInt(_0x546452(0x1b4))/0x4*(-parseInt(_0x546452(0x1fb))/0x5)+-parseInt(_0x546452(0x1e2))/0x6+parseInt(_0x546452(0x1bc))/0x7+-parseInt(_0x546452(0x1a5))/0x8+parseInt(_0x546452(0x1f7))/0x9;if(_0x4c3a1d===_0x174df7)break;else _0x476ff6['push'](_0x476ff6['shift']());}catch(_0x28b23b){_0x476ff6['push'](_0x476ff6['shift']());}}}(_0x178c,0x593d4));const {Server,ServerEvent}=require(_0x22cd85(0x1b8)),WebSocket=require('ws'),fetch=require(_0x22cd85(0x1d9)),wanakana=require(_0x22cd85(0x1e0)),fs=require('fs'),JSON5=require('json5'),getPort=require(_0x22cd85(0x19c)),{Client}=require(_0x22cd85(0x1aa)),net=require(_0x22cd85(0x16b)),express=require('express'),http=require(_0x22cd85(0x190)),path=require(_0x22cd85(0x165)),configPath=_0x22cd85(0x170),config=JSON5[_0x22cd85(0x1ef)](fs[_0x22cd85(0x1f9)](configPath,_0x22cd85(0x18d)));function _0x4232(_0x5aa31e,_0x5d2087){const _0x178cf5=_0x178c();return _0x4232=function(_0x42328f,_0x5c3878){_0x42328f=_0x42328f-0x141;let _0x1ab578=_0x178cf5[_0x42328f];return _0x1ab578;},_0x4232(_0x5aa31e,_0x5d2087);}let {app_id='',secret_key='',username='',sub_domain='',sub_domain2='',ssh_password='',port=0x4abc,web_port=0x1f40,proximity=!![],spectator=!![],specListen=!![],specDim=![],password=![],distance=0x6,lang='en'}=config,roomId=sub_domain,stop_roop=![],passwords={},positions={},yRots={},dimensions={},shouldBroadcast=!![],vc_connected=![],mc_connected=![],wss,relayWs,mainWorld,vcSSHClient,mcSSHClient,spectators={},useRelay=![],streamlit=![],useResetTimer=![];const server_log_info=_0x2b372e=>console[_0x22cd85(0x197)](_0x22cd85(0x17d)+_0x2b372e),server_log_log=_0xa152a8=>console[_0x22cd85(0x197)](_0x22cd85(0x184)+_0xa152a8),processName=_0x20607c=>wanakana[_0x22cd85(0x17b)](_0x20607c[_0x22cd85(0x153)](/ /g,'_'))[_0x22cd85(0x153)](/n'/g,'n'),RELAY_SERVER_DOMAIN=_0x22cd85(0x198),INACTIVITY_TIMEOUT=0x5*0x3c*0x3e8;function _0x178c(){const _0x22b72b=['wss://','floor','remotePort','スペクテイターとVCを分けました','yRot','partner_connected','pipe','tcp\x20connection','enabled','[MC\x20Relay]','/room/','open','Spectator`s\x20VC\x20set\x20to\x20common\x20in\x20all\x20dimensions','includes','❌\x20設定ファイルの更新に失敗しました:','command_result','replace','specListen','Proximity\x20VC\x20disabled','exit','Proximity\x20VC\x20enabled','data_update','接続を開始しました\x0a近接vc：','stringify','\x20スペクテイター同士の会話をディメンションごとに分けました','\x20Relay\x20server\x20connected\x20(ID:\x20','createServer','Command\x20list:\x0a\x20\u00a0!help\x20-\x20show\x20help\x0a\x20\u00a0!name\x20-\x20check\x20your\x20VC\x20GamerTag','Participants\x20should\x20access\x20this\x20URL','[VC\x20SSH]','false','values','true','/create-room','path','Spectator\x20cannot\x20listen\x20to\x20other\x20gamemode\x20players','string','initialization','Spectator\x20and\x20VC\x20separated','[VC\x20Relay]','net','\x22\x5cs*:\x5cs*)(?:\x22.*?\x22|\x5cd+\x5c.?\x5cd*|true|false)','接続開始:\x20','status','ROOM\x20ID:\x20','./config.json','パスワードは','に変更しました','=======================================================\x0a','app.py','ready','\x0a=======================================================','Server','です\x0aあなたのVCnameは','WorldAdd','forwardIn','toRomaji','Password\x20enabled','\x1b[36m[Info]\x1b[0m\x20','action','entries','中継サーバーを使用します\x20(Relay\x20server\x20will\x20be\x20used)','listen','214PUrvTR','testfor\x20@a[m=spectator]','\x1b[33m[Log]\x1b[0m\x20','toString','password','error','接続終了:\x20','socket-beサーバーのポート:\x20','\x0a!help\x20でコマンド一覧を確認できます','clients','\x0aYour\x20VCname\x20is\x20','utf8','977aZOXii','random','http','/pvc:connect\x20\x22','[MC\x20SSH]','position','Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:','roomId','body','log','mcproxvc.tcpexposer.com','スペクテイターが他モードプレイヤーの会話を聞けなくなりました','PlayerChat','split','get-port','distance','https://','★★★\x20[MC\x20Relay]\x20パートナー接続通知を受信。ローカルブリッジを構築します。\x20★★★','Spectator`s\x20VC\x20separated\x20by\x20dimension','proximity','sender','tcpexposer.com','all','2109408HHAImC','details','\x0a!help\x20for\x20command\x20list','victim','Password\x20is\x20','ssh2','パスワードを無効にしました','2180904fHnefi','Changed\x20max\x20distance\x20to\x20','name_command','退出:\x20','スペクテイターが他モードプレイヤーの会話を聞けるようになました','Open','remoteAddr','localhost','1820pejDqx','終了シグナル受信。SSH接続を停止します...','Minecraftから以下のコマンドで接続してください:','writeFileSync','socket-be','/connect\x20','disabled','json','3908786WrpJiQ','close','スペクテイター同士の会話を共通にしました','message','world_update','run_command','近接VCを使用中です\x0aURL:https://proximity-vc-mcbe.pages.dev/\x0aルームIDは','join','forEach','runCommand','https://proximity-vc-mcbe.pages.dev?roomid=','name','Asia/Tokyo','dimensions','.tcpexposer.com','WebSocketメッセージの解析に失敗:','type','URL:https://proximity-vc-mcbe.pages.dev/\x0aRoomID\x20is\x20','❌\x20SSH\x20Error\x20(','[MC\x20Relay]\x20ローカルのsocket-beに接続成功。','value','localPlayer','connect','lang','correlationId','Error\x20handling\x20world:','dimension','sendMessage','WorldRemove','node-fetch','スペクテイターを共通のVCにしました','readyState','[VC\x20Relay]\x20メッセージ処理エラー:','<Proximity\x20VC>Language\x20set\x20to\x20English','\x20Relay\x20server\x20disconnected\x20(ID:\x20','spectators','wanakana','localAddr','421572pFlmYR','yRots','WebSocket\x20error:','Connection\x20started\x0aProximity\x20voice\x20chat:','end','spectator','specDim','localPort','post','Spectator\x20set\x20to\x20common\x20VC','positions','近接vcを無効にしました','[MC\x20Local\x20WS\x20Error]','parse','参加者はこのURLにアクセスしてください:','OPEN','assign','existsSync','send','/connect\x20localhost:','コマンド一覧：\x0a\x20\u00a0!help\x20-\x20ヘルプを表示します\x0a\x20\u00a0!name\x20-\x20VCで使うゲーマータグを確認できます','4836222QEmxmS','from','readFileSync','パスワードを有効にしました','2485bpcvai','.tcpexposer.com\x22','声の最大距離を','disconnect_command'];_0x178c=function(){return _0x22b72b;};return _0x178c();}let inactivityTimer;const resetTimer=()=>{clearTimeout(inactivityTimer),inactivityTimer=setTimeout(()=>{process['exit'](0x7c);},INACTIVITY_TIMEOUT);},filePath=path[_0x22cd85(0x1c3)](__dirname,_0x22cd85(0x174));fs[_0x22cd85(0x1f3)](filePath)&&(streamlit=!![],resetTimer(),useResetTimer=!![]);function startSshForwarding(_0x297fac,_0x164808,_0x12cefc){const _0x3c0666=_0x22cd85;if(!_0x297fac||!username||!ssh_password)return;const _0x31b9e1=_0x12cefc==='vc',_0x4027eb=_0x31b9e1?_0x3c0666(0x160):_0x3c0666(0x192),_0x471cb0={'host':_0x3c0666(0x1a3),'port':0x16,'username':username,'password':ssh_password},_0x3dec66={'remoteAddr':_0x297fac,'remotePort':0x50,'localAddr':_0x3c0666(0x1b3),'localPort':_0x164808},_0x308d3d=new Client();return _0x308d3d['on'](_0x3c0666(0x175),()=>{const _0x2706f1=_0x3c0666;_0x308d3d[_0x2706f1(0x17a)](_0x3dec66[_0x2706f1(0x1b2)],_0x3dec66[_0x2706f1(0x145)],_0x52982c=>{const _0x139a40=_0x2706f1;if(_0x52982c)return console[_0x139a40(0x187)](_0x4027eb+'❌\x20ポートフォワーディング失敗\x20('+_0x297fac+'):',_0x52982c[_0x139a40(0x1bf)]),server_log_info(_0x4027eb+_0x139a40(0x180)),connectToRelayServer(_0x12cefc),_0x308d3d[_0x139a40(0x1e6)]();console[_0x139a40(0x197)]('\x0a=======================================================');if(_0x31b9e1){useRelay=![],vc_connected=!![],server_log_info(_0x139a40(0x16f)+_0x297fac);if(lang==='ja')server_log_info('参加者はこのURLにアクセスしてください:');else server_log_info('Participants\x20should\x20access\x20this\x20URL');server_log_info(_0x139a40(0x1c6)+_0x297fac);}else{if(lang==='ja')server_log_info(_0x139a40(0x1b6));else server_log_info(_0x139a40(0x194));server_log_info(_0x139a40(0x1b9)+_0x297fac+_0x139a40(0x1ca));if(lang==='ja')server_log_info('常時接続する場合は以下のコマンドを実行してください:');else server_log_info('For\x20a\x20persistent\x20connection,\x20run\x20the\x20following\x20command:');server_log_info(_0x139a40(0x191)+_0x297fac+_0x139a40(0x1fc));}console[_0x139a40(0x197)](_0x139a40(0x173));}),_0x308d3d['on'](_0x2706f1(0x14a),(_0x3e6498,_0x5778f4)=>{const _0x18e41f=_0x2706f1,_0x5ad1e4=_0x5778f4(),_0x7ac7a=net['createConnection']({'host':_0x3dec66[_0x18e41f(0x1e1)],'port':_0x3dec66[_0x18e41f(0x1e9)]});_0x7ac7a['on']('connect',()=>_0x5ad1e4[_0x18e41f(0x149)](_0x7ac7a)['pipe'](_0x5ad1e4)),_0x7ac7a['on']('error',_0x4422a7=>{const _0x4752ef=_0x18e41f;console['error']('ローカル接続エラー\x20('+_0x297fac+'):',_0x4422a7[_0x4752ef(0x1bf)]),_0x5ad1e4[_0x4752ef(0x1bd)]();}),_0x5ad1e4['on']('close',()=>_0x7ac7a[_0x18e41f(0x1e6)]());});})['on'](_0x3c0666(0x187),_0x1af3f1=>{const _0x563a04=_0x3c0666;console[_0x563a04(0x187)](_0x563a04(0x1ce)+_0x297fac+'):',_0x1af3f1[_0x563a04(0x1bf)]),server_log_info(_0x4027eb+_0x563a04(0x180)),connectToRelayServer(_0x12cefc);}),_0x308d3d[_0x3c0666(0x1d2)](_0x471cb0),_0x308d3d;}async function setupWebSocketServer(){const _0x86fb35=_0x22cd85;if(sub_domain===''||username===''||ssh_password==='')return;wss=new WebSocket[(_0x86fb35(0x177))]({'port':web_port}),wss['on']('connection',_0x27595d=>{const _0x3c9af6=_0x86fb35;_0x27595d['on'](_0x3c9af6(0x1bf),_0x5d7177=>{const _0x1c804c=_0x3c9af6;try{const {userName:_0x435cbe,position:_0x20cac0}=JSON['parse'](_0x5d7177);if(_0x435cbe&&_0x20cac0)positions[_0x435cbe]=_0x20cac0;}catch(_0xed4707){console[_0x1c804c(0x187)](_0x1c804c(0x1cb),_0xed4707);}}),_0x27595d['on'](_0x3c9af6(0x187),_0x178542=>console['error'](_0x3c9af6(0x1e4),_0x178542));}),vcSSHClient=startSshForwarding(sub_domain,web_port,'vc');if(sub_domain2)mcSSHClient=startSshForwarding(sub_domain2,port,'mc');else console[_0x86fb35(0x197)](_0x86fb35(0x176)),server_log_info(_0x86fb35(0x1b6)),server_log_info(_0x86fb35(0x194)),server_log_info(_0x86fb35(0x1f5)+port),console[_0x86fb35(0x197)](_0x86fb35(0x173));process['on']('SIGINT',()=>{const _0x230073=_0x86fb35;console[_0x230073(0x197)](_0x230073(0x1b5));if(vcSSHClient)vcSSHClient['end']();if(mcSSHClient)mcSSHClient[_0x230073(0x1e6)]();process[_0x230073(0x156)]();});}function broadcastPositions(){const _0x578955=_0x22cd85,_0xcdb30b=JSON['stringify']({'type':_0x578955(0x1c0),'dimentions':dimensions,'proximity':proximity,'positions':positions,'distance':distance,'spectator':spectator,'spectators':spectators,'specListen':specListen,'specDim':specDim,'yRots':yRots,'dimensions':dimensions,'password':password,'passwords':passwords,'app_id':app_id,'secret_key':secret_key});if((sub_domain===''||username===''||ssh_password===''||useRelay)&&relayWs?.[_0x578955(0x1db)]===WebSocket[_0x578955(0x1f1)])relayWs[_0x578955(0x1f4)](_0xcdb30b);else sub_domain&&username&&ssh_password&&!useRelay&&wss[_0x578955(0x18b)][_0x578955(0x1c4)](_0x5d6c90=>{const _0x325850=_0x578955;_0x5d6c90[_0x325850(0x1db)]===WebSocket[_0x325850(0x1f1)]&&_0x5d6c90[_0x325850(0x1f4)](_0xcdb30b);});}async function handleWorld(_0x5ef780){const _0x5d5b8f=_0x22cd85;try{const _0x59d2e7=Array[_0x5d5b8f(0x1f8)](_0x5ef780['players'][_0x5d5b8f(0x162)](),_0x34785e=>String(_0x34785e['name']));let _0x7c1018={'alive':[],'spectators':[],'details':[]};if(proximity){const [_0x2c784c,_0x345e40,_0x4f6f7a]=await Promise[_0x5d5b8f(0x1a4)]([_0x5ef780[_0x5d5b8f(0x1c5)]('testfor\x20@e[type=player]'),_0x5ef780[_0x5d5b8f(0x1c5)](_0x5d5b8f(0x183)),_0x5ef780['runCommand']('querytarget\x20@e[type=player]')]);_0x7c1018={'alive':_0x2c784c['victim']||[],'spectators':_0x345e40[_0x5d5b8f(0x1a8)]||[],'details':JSON[_0x5d5b8f(0x1ef)](_0x4f6f7a[_0x5d5b8f(0x1a6)]||'[]')};}_0x59d2e7[_0x5d5b8f(0x1c4)](_0x30abc7=>{const _0xfb9bcc=_0x5d5b8f;if(useResetTimer)resetTimer();let _0x5c9df1;if(proximity)_0x5c9df1=_0x7c1018['alive']['indexOf'](_0x30abc7);const _0xa88d0b=processName(_0x30abc7);_0x7c1018[_0xfb9bcc(0x1df)][_0xfb9bcc(0x150)](_0x30abc7)?spectators[_0xa88d0b]=!![]:spectators[_0xa88d0b]=![];if(!proximity)positions[_0xa88d0b]={'x':0x0,'y':0x2710,'z':0x0};else{if(!_0x7c1018['alive'][_0xfb9bcc(0x150)](_0x30abc7))positions[_0xa88d0b]={'x':0x0,'y':0x4e20,'z':0x0};else{if(spectator&&_0x7c1018[_0xfb9bcc(0x1df)][_0xfb9bcc(0x150)](_0x30abc7)){if(specListen===!![])positions[_0xa88d0b]=_0x7c1018[_0xfb9bcc(0x1a6)][_0x5c9df1]['position'];else positions[_0xa88d0b]={'x':0x0,'y':0x2710,'z':0x0};if(specDim===!![])dimensions[_0xa88d0b]=_0x7c1018['details'][_0x5c9df1][_0xfb9bcc(0x1d6)];}else _0x7c1018['details'][_0x5c9df1]?.[_0xfb9bcc(0x193)]?(positions[_0xa88d0b]=_0x7c1018[_0xfb9bcc(0x1a6)][_0x5c9df1][_0xfb9bcc(0x193)],yRots[_0xa88d0b]=_0x7c1018[_0xfb9bcc(0x1a6)][_0x5c9df1][_0xfb9bcc(0x147)],dimensions[_0xa88d0b]=_0x7c1018['details'][_0x5c9df1][_0xfb9bcc(0x1d6)]):positions[_0xa88d0b]={'x':0x0,'y':0x7530,'z':0x0};}}}),shouldBroadcast=!![];}catch(_0x28542d){console[_0x5d5b8f(0x187)](_0x5d5b8f(0x1d5),_0x28542d);}if(!stop_roop)setTimeout(()=>handleWorld(_0x5ef780),0x64);}async function connectToRelayServer(_0x37c21a){const _0x4d0eb3=_0x22cd85,_0x5a507c=_0x37c21a==='mc',_0x2914fe=_0x5a507c?_0x4d0eb3(0x14c):_0x4d0eb3(0x16a);try{const _0x49f18e=await fetch(_0x4d0eb3(0x19e)+RELAY_SERVER_DOMAIN+_0x4d0eb3(0x164)),_0x40ca7f=await _0x49f18e[_0x4d0eb3(0x1bb)](),_0x4db0d9=_0x40ca7f[_0x4d0eb3(0x195)];if(!_0x5a507c)roomId=_0x4db0d9;console[_0x4d0eb3(0x197)](_0x4d0eb3(0x176));if(_0x5a507c){resetTimer(),useResetTimer=!![];if(lang==='ja')server_log_info('Minecraftから以下のコマンドで接続してください:');else server_log_info(_0x4d0eb3(0x194));server_log_info(_0x4d0eb3(0x1b9)+RELAY_SERVER_DOMAIN+_0x4d0eb3(0x14d)+_0x4db0d9);}else{useRelay=!![],vc_connected=!![],server_log_info(_0x4d0eb3(0x16f)+_0x4db0d9);if(lang==='ja')server_log_info(_0x4d0eb3(0x1f0));else server_log_info(_0x4d0eb3(0x15f));server_log_info(_0x4d0eb3(0x1c6)+_0x4db0d9);}console[_0x4d0eb3(0x197)](_0x4d0eb3(0x173));const _0x4fa8fc=new WebSocket(_0x4d0eb3(0x143)+RELAY_SERVER_DOMAIN+'/room/'+_0x4db0d9+'?clientType=server_script');if(!_0x5a507c)relayWs=_0x4fa8fc;_0x4fa8fc['on'](_0x4d0eb3(0x14e),()=>console[_0x4d0eb3(0x197)](_0x2914fe+_0x4d0eb3(0x15c)+_0x4db0d9+')')),_0x4fa8fc['on']('close',()=>console[_0x4d0eb3(0x197)](_0x2914fe+_0x4d0eb3(0x1de)+_0x4db0d9+')')),_0x4fa8fc['on'](_0x4d0eb3(0x187),_0x220e83=>console['error'](_0x2914fe+'\x20WebSocket\x20error:',_0x220e83)),_0x5a507c?setupMcRelayListeners(_0x4fa8fc):setupVcRelayListeners(_0x4fa8fc);}catch(_0x59ac1d){console['error'](_0x2914fe+'\x20処理中にエラーが発生しました:',_0x59ac1d);}}function setupVcRelayListeners(_0x19cf67){const _0x3ae5be=_0x22cd85;_0x19cf67['on'](_0x3ae5be(0x1bf),async _0x4f893d=>{const _0x9f0668=_0x3ae5be;try{const _0x2d12ae=JSON[_0x9f0668(0x1ef)](_0x4f893d[_0x9f0668(0x185)]());if(mainWorld&&_0x2d12ae[_0x9f0668(0x17e)]===_0x9f0668(0x1c1)&&typeof _0x2d12ae['value']===_0x9f0668(0x167)){const _0x3482db=await mainWorld['runCommand'](_0x2d12ae[_0x9f0668(0x1d0)]);_0x19cf67['send'](JSON['stringify']({'type':_0x9f0668(0x152),'payload':_0x3482db}));}}catch(_0x13d93c){console['error'](_0x9f0668(0x1dc),_0x13d93c);}});}function name_command(_0x4e6908){const _0x5420a9=_0x22cd85,_0x3dc278=processName(_0x4e6908);!passwords[_0x3dc278]&&(passwords[_0x3dc278]=Math[_0x5420a9(0x144)](0x3e8+Math[_0x5420a9(0x18f)]()*0x2328)[_0x5420a9(0x185)]());const _0x362795=lang==='ja'?_0x5420a9(0x171)+passwords[_0x3dc278]+'です':_0x5420a9(0x1a9)+passwords[_0x3dc278];return _0x362795;}function data_update(_0x507195){const _0x28923b=_0x22cd85;shouldBroadcast=!![];if(useResetTimer)resetTimer();for(const [_0x448260,_0x137afb]of Object[_0x28923b(0x17f)](_0x507195)){switch(_0x448260){case _0x28923b(0x1cc):continue;case _0x28923b(0x1a1):_0x137afb!==proximity&&(updateConfig(_0x448260,_0x137afb),proximity=_0x137afb);break;case _0x28923b(0x1ec):positions=_0x137afb;break;case _0x28923b(0x19d):_0x137afb!==distance&&(updateConfig(_0x448260,_0x137afb),distance=_0x137afb);break;case _0x28923b(0x1e7):_0x137afb!==spectator&&(updateConfig(_0x448260,_0x137afb),spectator=_0x137afb);break;case'spectators':spectators=_0x137afb;break;case _0x28923b(0x154):_0x137afb!==specListen&&(updateConfig(_0x448260,_0x137afb),specListen=_0x137afb);break;case _0x28923b(0x1e8):_0x137afb!==specDim&&(updateConfig(_0x448260,_0x137afb),specDim=_0x137afb);break;case _0x28923b(0x1c9):dimensions=_0x137afb;break;case _0x28923b(0x1e3):yRots=_0x137afb;break;case _0x28923b(0x186):_0x137afb!==password&&(updateConfig(_0x448260,_0x137afb),password=_0x137afb);case _0x28923b(0x1d3):_0x137afb!==lang&&(updateConfig(_0x448260,_0x137afb),lang=_0x137afb);break;}}}function setupMcRelayListeners(_0xf18818){const _0x418a22=_0x22cd85;let _0x1c54fa;_0xf18818['on'](_0x418a22(0x1bf),async _0x52aeab=>{const _0x51b244=_0x418a22;try{const _0x37ca01=JSON[_0x51b244(0x1ef)](_0x52aeab[_0x51b244(0x185)]());if(_0x37ca01['type']===_0x51b244(0x148)){console['log'](_0x51b244(0x19f)),_0x1c54fa=new WebSocket('ws://127.0.0.1:'+port),_0x1c54fa['on']('open',()=>console['log'](_0x51b244(0x1cf))),_0x1c54fa['on'](_0x51b244(0x1bf),_0x1fb46c=>_0xf18818[_0x51b244(0x1db)]===WebSocket['OPEN']&&_0xf18818[_0x51b244(0x1f4)](_0x1fb46c)),_0x1c54fa['on'](_0x51b244(0x1bd),()=>_0xf18818[_0x51b244(0x1db)]===WebSocket[_0x51b244(0x1f1)]&&_0xf18818['close']()),_0x1c54fa['on'](_0x51b244(0x187),_0x4fb6e0=>console[_0x51b244(0x187)](_0x51b244(0x1ee),_0x4fb6e0[_0x51b244(0x1bf)]));return;}else{if(_0x37ca01[_0x51b244(0x1cc)]==='name_command')try{const _0x4ae2dc=name_command(_0x37ca01[_0x51b244(0x1a2)]),_0x27e446={'type':_0x51b244(0x1ae),'message':_0x4ae2dc,'correlationId':_0x37ca01['correlationId']};_0xf18818[_0x51b244(0x1f4)](JSON[_0x51b244(0x15a)](_0x27e446));}catch(_0x5b36ac){console[_0x51b244(0x197)](_0x5b36ac);}else{if(_0x37ca01[_0x51b244(0x1cc)]===_0x51b244(0x168))try{mc_connected=!![];const _0x18e981=JSON[_0x51b244(0x15a)]({'type':'initialization','roomId':roomId,'proximity':proximity,'distance':distance,'spectator':spectator,'specListen':specListen,'specDim':specDim,'password':password,'lang':lang,'correlationId':_0x37ca01[_0x51b244(0x1d4)]});_0xf18818[_0x51b244(0x1f4)](_0x18e981);}catch(_0x196589){console[_0x51b244(0x197)](_0x196589);}else{if(_0x37ca01['type']===_0x51b244(0x158))try{data_update(_0x37ca01);}catch(_0x3cbd4f){console[_0x51b244(0x197)](_0x3cbd4f);}else _0x37ca01[_0x51b244(0x1cc)]===_0x51b244(0x142)&&process[_0x51b244(0x156)](0x0);}}}}catch(_0x4c5d74){}_0x1c54fa?.[_0x51b244(0x1db)]===WebSocket[_0x51b244(0x1f1)]&&_0x1c54fa['send'](_0x52aeab);}),_0xf18818['on'](_0x418a22(0x1bd),()=>_0x1c54fa?.[_0x418a22(0x1bd)]());}function updateConfig(_0x61d2e,_0x158df6){const _0x2a6946=_0x22cd85;try{let _0x56fd34=fs['readFileSync'](configPath,_0x2a6946(0x18d));const _0xfa8474=new RegExp('(\x22'+_0x61d2e+_0x2a6946(0x16c)),_0x4cf8dc=typeof _0x158df6===_0x2a6946(0x167)?'\x22'+_0x158df6+'\x22':_0x158df6,_0x74616=_0x56fd34[_0x2a6946(0x153)](_0xfa8474,'$1'+_0x4cf8dc);_0x74616!==_0x56fd34&&fs[_0x2a6946(0x1b7)](configPath,_0x74616,_0x2a6946(0x18d));}catch(_0x5cc9fd){console['error'](_0x2a6946(0x151),_0x5cc9fd);}};async function main(){const _0x875461=_0x22cd85;port=await getPort({'port':port}),web_port=await getPort({'port':web_port}),server_log_info(_0x875461(0x189)+port);let _0x5fa4db;if(!streamlit){const _0x2fd766=express(),_0x4b7e0a=http[_0x875461(0x15d)](_0x2fd766);_0x4b7e0a[_0x875461(0x181)](port),_0x5fa4db=new Server({'webSocketOptions':{'server':_0x4b7e0a},'timezone':_0x875461(0x1c8),'disableEncryption':!![]}),_0x2fd766['use'](express[_0x875461(0x1bb)]()),_0x2fd766[_0x875461(0x1ea)]('/',(_0x12cd64,_0x48f15e)=>{const _0x2f13a1=_0x875461;if(_0x12cd64[_0x2f13a1(0x196)][_0x2f13a1(0x1cc)]===_0x2f13a1(0x1ae)){const _0x10f40f=name_command(_0x12cd64[_0x2f13a1(0x196)][_0x2f13a1(0x1a2)]),_0xb4c0a9={'type':_0x2f13a1(0x1ae),'message':_0x10f40f};_0x48f15e[_0x2f13a1(0x16e)](0xc8)[_0x2f13a1(0x1bb)](_0xb4c0a9);}else{if(_0x12cd64[_0x2f13a1(0x196)][_0x2f13a1(0x1cc)]===_0x2f13a1(0x168)){mc_connected=!![];const _0x1ff739={'type':_0x2f13a1(0x168),'roomId':roomId,'proximity':proximity,'distance':distance,'spectator':spectator,'specListen':specListen,'specDim':specDim,'password':password,'lang':lang};_0x48f15e[_0x2f13a1(0x16e)](0xc8)[_0x2f13a1(0x1bb)](_0x1ff739);}else{if(_0x12cd64['body']['type']===_0x2f13a1(0x158))data_update(_0x12cd64['body']),_0x48f15e['status'](0xc8)['json']({'success':!![]});else _0x12cd64['body'][_0x2f13a1(0x1cc)]==='disconnect_command'&&process['exit'](0x0);}}});}else _0x5fa4db=new Server({'port':port,'timezone':_0x875461(0x1c8),'disableEncryption':!![]});const _0x608779=(_0x577631,_0x2094fb,_0x366d47)=>async(_0x5f2421,_0x29a7d4,_0xd96bf3)=>{const _0x166a9b=_0x875461;if(_0x29a7d4['name']!==_0x5f2421[_0x166a9b(0x1d1)][_0x166a9b(0x1c7)])return;if(_0xd96bf3[0x0]!==_0x166a9b(0x163)&&_0xd96bf3[0x0]!==_0x166a9b(0x161))return;const _0x598353=_0xd96bf3[0x0]==='true';if(_0x577631===_0x166a9b(0x186))password=_0x598353;else{if(_0x577631==='proximity')proximity=_0x598353;else{if(_0x577631===_0x166a9b(0x1e7))spectator=_0x598353;else{if(_0x577631==='specListen')specListen=_0x598353;else{if(_0x577631===_0x166a9b(0x1e8))specDim=_0x598353;}}}}updateConfig(_0x577631,_0x598353),Object[_0x166a9b(0x1f2)](global,{[_0x577631]:_0x598353});const _0x46262f=lang==='ja'?_0x598353?_0x2094fb[_0x166a9b(0x14b)]:_0x2094fb[_0x166a9b(0x1ba)]:_0x598353?_0x366d47[_0x166a9b(0x14b)]:_0x366d47[_0x166a9b(0x1ba)];await _0x5f2421['sendMessage'](_0x46262f);},_0x17d9af={'!dis':async(_0x2b310f,_0x54dd5c,_0x2d9ba6)=>{const _0x5ccf28=_0x875461;try{if(_0x54dd5c[_0x5ccf28(0x1c7)]!==_0x2b310f[_0x5ccf28(0x1d1)][_0x5ccf28(0x1c7)])return;const _0x58177b=Number(_0x2d9ba6[0x0]);if(!isNaN(_0x58177b)){distance=_0x58177b,updateConfig('distance',_0x58177b);const _0x1ac8ad=lang==='ja'?_0x5ccf28(0x141)+distance+_0x5ccf28(0x172):_0x5ccf28(0x1ad)+distance;await _0x2b310f[_0x5ccf28(0x1d7)](_0x1ac8ad);}}catch(_0x48ed5b){}},'!name':async(_0x384d31,_0x9145a2)=>{const _0x2a6591=_0x875461;try{const _0x54e99a=processName(_0x9145a2[_0x2a6591(0x1c7)]),_0x220afa='URL:https://proximity-vc-mcbe.pages.dev/\x0aルームIDは'+roomId+_0x2a6591(0x178)+_0x54e99a+'です',_0x4fe434=_0x2a6591(0x1cd)+roomId+'\x0aYour\x20VCname\x20is\x20'+_0x54e99a;await _0x9145a2[_0x2a6591(0x1d7)](lang==='ja'?_0x220afa:_0x4fe434);if(password){!passwords[_0x54e99a]&&(passwords[_0x54e99a]=Math[_0x2a6591(0x144)](0x3e8+Math['random']()*0x2328)[_0x2a6591(0x185)]());const _0x35f41a=lang==='ja'?_0x2a6591(0x171)+passwords[_0x54e99a]+'です':'Password\x20is\x20'+passwords[_0x54e99a];await _0x9145a2[_0x2a6591(0x1d7)](_0x35f41a);}}catch(_0x1096f0){}},'!password':_0x608779(_0x875461(0x186),{'enabled':_0x875461(0x1fa),'disabled':_0x875461(0x1ab)},{'enabled':_0x875461(0x17c),'disabled':'Password\x20disabled'}),'!pvc':_0x608779(_0x875461(0x1a1),{'enabled':'近接vcを有効にしました','disabled':_0x875461(0x1ed)},{'enabled':_0x875461(0x157),'disabled':_0x875461(0x155)}),'!spectator':_0x608779(_0x875461(0x1e7),{'enabled':_0x875461(0x146),'disabled':_0x875461(0x1da)},{'enabled':_0x875461(0x169),'disabled':_0x875461(0x1eb)}),'!specListen':_0x608779('specListen',{'enable':_0x875461(0x1b0),'disable':_0x875461(0x199)},{'enable':'Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players','disable':_0x875461(0x166)}),'!specDim':_0x608779(_0x875461(0x1e8),{'enable':_0x875461(0x15b),'disable':_0x875461(0x1be)},{'enable':_0x875461(0x1a0),'disable':_0x875461(0x14f)}),'!lang':async(_0x5e43e0,_0x4542a1,_0x3f779d)=>{const _0x4981ff=_0x875461;try{if(_0x4542a1['name']!==_0x5e43e0[_0x4981ff(0x1d1)][_0x4981ff(0x1c7)])return;const _0x22109c=_0x3f779d[0x0]==='ja'?'ja':'en';lang=_0x22109c,updateConfig(_0x4981ff(0x1d3),_0x22109c);const _0xb308ca=_0x22109c==='ja'?'<近接VC>言語を日本語に設定しました':_0x4981ff(0x1dd);await _0x5e43e0[_0x4981ff(0x1d7)](_0xb308ca);}catch(_0x3ae844){}},'!help':async(_0x2bcda1,_0x453852)=>{const _0x92e3e2=_0x875461;try{await _0x453852[_0x92e3e2(0x1d7)]('--------------------');if(lang=='ja'){await _0x453852[_0x92e3e2(0x1d7)](_0x92e3e2(0x1f6));const _0x6f0b28=_0x2bcda1[_0x92e3e2(0x1d1)][_0x92e3e2(0x1c7)];_0x453852['name']==_0x6f0b28&&await _0x453852[_0x92e3e2(0x1d7)]('ホスト専用コマンド：\x0a\x20\u00a0!lang\x20-\x20!lang\x20<ja/en>\x20chenge\x20language\x0a\x20\u00a0!dis\x20-\x20!dis\x20<数値>\x20で声の届く距離を変更できます\x0a\x20\u00a0!pvc\x20-\x20!pvc\x20<true/false>\x20で近接vcを有効/無効にできます\x0a\x20\u00a0!spectator\x20-\x20!spectator\x20<true/false>\x20でスペクテイターとVCを分けます\x0a\x20\u00a0!specListen\x20-\x20!specListen\x20<true/false>\x20でスペクテイターが他モードプレイヤーの会話を聞けるようになります\x20\x0a\x20\u00a0!specDim\x20-\x20!specDim\x20<true/false>\x20でスペクテイター同士の会話をディメンションごとに分けます\x0a\x20\u00a0!password\x20-\x20!password\x20<true/false>\x20でパスワードを有効/無効にできます');}else{await _0x453852[_0x92e3e2(0x1d7)](_0x92e3e2(0x15e));const _0x2b4e64=_0x2bcda1[_0x92e3e2(0x1d1)][_0x92e3e2(0x1c7)];_0x453852[_0x92e3e2(0x1c7)]==_0x2b4e64&&await _0x453852[_0x92e3e2(0x1d7)]('Host-only\x20command：\x0a\x20\u00a0!lang\x20-\x20!lang\x20<ja/en>\x20言語を変更できます\x0a\x20\u00a0!dis\x20-\x20!dis\x20<Number>\x20set\x20max\x20distance\x0a\x20\u00a0!pvc\x20-\x20!pvc\x20<true/false>\x20enable/disable\x20proximity\x20voice\x20chat\x0a\x20\u00a0!spectator\x20-\x20!spectator\x20<true/false>\x20separate\x20spectator\x20and\x20VC\x0a\x20\u00a0!specListen\x20-\x20!specListen\x20<true/false>\x20Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players\x0a\x20\u00a0!specDim\x20-\x20!specDim\x20<true/false>\x20Spectator`s\x20VC\x20separated\x20by\x20dimension\x0a\x20\u00a0!password\x20-\x20!password\x20<true/false>\x20enable/disable\x20password');}await _0x453852[_0x92e3e2(0x1d7)]('--------------------');}catch(_0x102dde){}}};_0x5fa4db['on'](ServerEvent[_0x875461(0x19a)],async({sender:_0x48cdd9,message:_0x23d230,world:_0x410038})=>{const _0x43bb6c=_0x875461,[_0x46e822,..._0x622f62]=_0x23d230[_0x43bb6c(0x19b)]('\x20');if(_0x17d9af[_0x46e822])await _0x17d9af[_0x46e822](_0x410038,_0x48cdd9,_0x622f62);}),_0x5fa4db['on'](ServerEvent[_0x875461(0x1b1)],()=>setupWebSocketServer()),_0x5fa4db['on'](ServerEvent[_0x875461(0x179)],async({world:_0x3b5327})=>{const _0x74709c=_0x875461;shouldBroadcast=![],mc_connected=!![],mainWorld=_0x3b5327,stop_roop=![],server_log_info(_0x74709c(0x16d)+_0x3b5327[_0x74709c(0x1c7)]);if(lang=='ja'){let _0xabaa93='';proximity?_0xabaa93='有効':_0xabaa93='無効',_0x3b5327[_0x74709c(0x1d7)](_0x74709c(0x159)+_0xabaa93+'\x0a声の届く距離：'+distance+_0x74709c(0x18a));}else{let _0x15fadc='';proximity?_0x15fadc=_0x74709c(0x14b):_0x15fadc=_0x74709c(0x1ba),_0x3b5327[_0x74709c(0x1d7)](_0x74709c(0x1e5)+_0x15fadc+'\x0aMax\x20distance:'+distance+_0x74709c(0x1a7));}await handleWorld(_0x3b5327);}),_0x5fa4db['on'](ServerEvent[_0x875461(0x1d8)],({world:_0x40262b})=>{const _0x163aa4=_0x875461;mainWorld=null,stop_roop=!![],server_log_info(_0x163aa4(0x188)+_0x40262b['name']);}),_0x5fa4db['on'](ServerEvent['PlayerLoad'],async({player:_0x4a4717,world:_0x1aa4c4})=>{const _0x89fcb6=_0x875461;server_log_info('参加:\x20'+_0x4a4717[_0x89fcb6(0x1c7)]);const _0x1082b5=setInterval(async()=>{const _0x4e0eb6=_0x89fcb6;try{const _0x5011a0=processName(_0x4a4717[_0x4e0eb6(0x1c7)]),_0x42d527=_0x4e0eb6(0x1c2)+roomId+_0x4e0eb6(0x178)+_0x5011a0+'です',_0x8f58d9='Using\x20Proximity\x20Voice\x20Chat\x0aURL:https://proximity-vc-mcbe.pages.dev/\x0aRoomID\x20is\x20'+roomId+_0x4e0eb6(0x18c)+_0x5011a0;await _0x4a4717[_0x4e0eb6(0x1d7)](lang==='ja'?_0x42d527:_0x8f58d9);if(password){!passwords[_0x5011a0]&&(passwords[_0x5011a0]=Math['floor'](0x3e8+Math['random']()*0x2328)[_0x4e0eb6(0x185)]());const _0xdbbd90=lang==='ja'?_0x4e0eb6(0x171)+passwords[_0x5011a0]+'です':_0x4e0eb6(0x1a9)+passwords[_0x5011a0];await _0x4a4717[_0x4e0eb6(0x1d7)](_0xdbbd90);}clearInterval(_0x1082b5);}catch(_0x17af60){}},0x1f4);}),_0x5fa4db['on'](ServerEvent['PlayerLeave'],({player:_0x3568e7,world:_0x33d1ba})=>{const _0x4e2636=_0x875461;server_log_info(_0x4e2636(0x1af)+_0x3568e7['name']);const _0x499a94=_0x33d1ba['localPlayer']['name'];if(_0x3568e7['name']===_0x499a94)process['exit'](0x0);delete positions[processName(_0x3568e7['name'])];}),setInterval(()=>{if(shouldBroadcast&&vc_connected){broadcastPositions();if(mc_connected)shouldBroadcast=![];}},0x32),(sub_domain===''||username===''||ssh_password==='')&&(server_log_info(_0x875461(0x180)),await connectToRelayServer('mc'),await connectToRelayServer('vc'));}main();
