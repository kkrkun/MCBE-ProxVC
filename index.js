const _0x3afe64 = _0x5ada; (function (_0x2f3ec3, _0x38da75) { const _0x548f19 = _0x5ada, _0x1aff79 = _0x2f3ec3(); while (!![]) { try { const _0x5699cd = -parseInt(_0x548f19(0x1f2)) / 0x1 * (parseInt(_0x548f19(0x252)) / 0x2) + parseInt(_0x548f19(0x240)) / 0x3 * (-parseInt(_0x548f19(0x1f9)) / 0x4) + -parseInt(_0x548f19(0x2a4)) / 0x5 + parseInt(_0x548f19(0x2d9)) / 0x6 + parseInt(_0x548f19(0x2a7)) / 0x7 * (-parseInt(_0x548f19(0x282)) / 0x8) + parseInt(_0x548f19(0x23a)) / 0x9 + parseInt(_0x548f19(0x2de)) / 0xa * (parseInt(_0x548f19(0x1f0)) / 0xb); if (_0x5699cd === _0x38da75) break; else _0x1aff79['push'](_0x1aff79['shift']()); } catch (_0xba55a9) { _0x1aff79['push'](_0x1aff79['shift']()); } } }(_0x304f, 0x9a7ca)); const { Server, ServerEvent, Player } = require(_0x3afe64(0x2a2)), WebSocket = require('ws'), fetch = require(_0x3afe64(0x1d4)), wanakana = require(_0x3afe64(0x29d)), fs = require('fs'), fsPromises = require('fs')[_0x3afe64(0x2d6)], JSON5 = require(_0x3afe64(0x250)), getPort = require(_0x3afe64(0x209)), express = require(_0x3afe64(0x274)), http = require(_0x3afe64(0x2c4)), zlib = require(_0x3afe64(0x297)), msgpack = require(_0x3afe64(0x2b5)), { randomUUID } = require(_0x3afe64(0x2ab)); function _0x304f() { const _0x18a7d6 = ['testfor\x20@e[type=player]', 'startWebSession', 'searchParams', 'action', 'json5', 'port', '98niWxBB', 'keys', 'onlinePlayers', 'help_host_2', '接続開始', 'useResetTimer', 'disabled', 'proximity_enabled', 'substring', '\x22\x5cs*:\x5cs*)(?:\x22.*?\x22|\x5cd+\x5c.?\x5cd*|true|false)', 'join_msg', 'position', 'has', 'toString', 'processName', 'size', 'status', 'trim', 'arrayBuffer', 'list', 'all', 'now', 'sshError', 'querytarget\x20@e[type=player]', 'from', 'delete', '\x1b[36m[Info]\x1b[0m\x20Webサーバーのポート:\x20', 'spectators', 'web_port', 'error', 'connectToRelayServer', ']\x20最大稼働時間に達しました。', 'config_on', '?clientType=server_script', 'express', '/create-room?roomid=', 'Pending\x20Session', 'time_limit', 'gunzipSync', 'lang', 'success', 'get', 'finally', 'entries', 'partner_disconnected', 'ws://127.0.0.1:', '/api/session_status/:id', 'connected', '493096XrpNOR', 'playersNames', 'https://mcproxvc.ovh/connect/?roomid=', 'success\x20timeout', 'speclisten_enabled', 'Buffer', './tcpexposer/tcpexposer_handler.js', 'proximity_disabled', 'verify_disabled', 'localClientBuffer', 'command_result', 'handleUpgrade', 'config', 'useRelay', 'name', 'close', 'relayed_vc_data', 'positions', '/room/', 'shouldBroadcast', 'pvcSessionId', 'zlib', 'headers', '/connect\x20', 'destroy', 'clear', 'then', 'wanakana', 'localhost', 'WorldAdd', 'output_disabled', 'sshClient', './lib/server', 'players', '4281765dNZMON', 'mcSshClient', './config.jsonc', '14dBgApr', '/api/stop_session', 'Proximity\x20Voice\x20Chat\x20Gateway\x20Active', 'your_vc_name', 'crypto', 'forEach', 'spectator', ']\x1b[0m\x20', 'spectator_separated', 'statusMessage', 'catch', 'Error\x20handling\x20world\x20loop\x20[', 'config_list', 'pvcDomain', 'msgpack-lite', 'scriptevent\x20pvc:icon_change\x20', 'pendingTimeout', 'map', 'minecraft', 'yRots', 'ROOM\x20ID:\x20', 'testfor\x20@a[tag=pvc:req_cmd]', 'run_command', 'relayWs', 'reason', 'random', 'resetTimer', 'vc_connected', 'host', 'http', 'pvc:roomId=', 'startTimer', 'pvc:req_cmd', '[TCPExposer]\x20TCPExposerハンドラーが見つからないため、接続をスキップします。リレーサーバーを使用します。', 'roomId', 'decode', 'nameCache', 'existsSync', 'tag\x20@a[tag=pvc:req_cmd]\x20remove\x20pvc:req_cmd', 'floor', '\x1b[36m[Info][', 'function', 'verify_code', 'specListen', './config.json5', 'statusCode', 'writeFileSync', 'promises', 'relay_switched', 'userName', '7167558UoLyHk', 'initialization', 'sendInitialPayload', 'startsWith', 'sub_domain', '50RDLzmE', 'aliveSet', 'password', 'success\x20host\x20exit', 'mc_connected', 'verify_enabled', 'help_divider', 'vcSshClient', 'maxRuntimeTimeout', 'PlayerLoad', 'startTcpexposer', 'listen', 'shift', '\x0a=======================================================', 'server_info.json', '[Local\x20Client\x20Error]\x20', '[Connection]\x20Rejected\x20connection\x20for\x20domain\x20\x27', 'distance_changed', 'prefix', 'help_host', 'tag\x20@a[tag=\x22', 'localPlayer', 'details', 'open', 'round', 'enabled', 'add', 'value', 'node-fetch', 'dataUpdate', 'not_found', 'data', 'config_off', 'log', 'world', 'getAllTags', 'true', 'clientType', 'loop', 'http://', 'specdim_separated', 'body', 'Session\x20not\x20found', 'encode', '\x20Error:', 'worldName', 'specDim', 'timestamp', 'inactivityTimer', '[Auto-Stop][', 'send', 'dimensions', 'processTagCommands', 'false', 'concat', 'string', '1577785ZfWLLw', 'active', '17403elptcY', 'icon_change', 'cleanOldTags', 'success\x20world\x20exit', 'Session\x20destroying...\x20Reason:\x20', 'No\x20active\x20sessions', '--streamlit', '12IVwEUK', './config.json', '退出:\x20', 'directVcClients', 'timeout\x20Timer', 'url', 'PlayerLeave', 'readFile', 'readyState', 'Unknown\x20World', 'use', 'type', 'passwords', '[Config]\x20No\x20configuration\x20file\x20found.\x20Using\x20default\x20settings.', 'OPEN', 'partner_connected', 'get-port', 'message', 'includes', '[Relay]', 'disconnect\x20command', 'localClient', 'proximity', 'indexOf', 'victim', 'utf8', 'split', 'yRot', '=======================================================\x0a', 'help_list', 'speclisten_disabled', 'https://', 'length', 'init', 'stringify', 'filter', 'logLog', 'createCommands', 'help_spec', 'json', '\x22]\x20remove\x20\x22', 'consecutiveTimeouts', 'next', 'server_shutdown', 'handleTcpUpgrade', '\x1b[36m[Info]\x1b[0m\x20socket-beサーバーのポート:\x20', 'data_update', 'broadcastPositions', 'set', 'pvc:', './locales/zh.json', 'stop_roop', 'distance', 'commands', 'setupRelayListeners', 'WorldRemove', 'testfor\x20@a[m=spectator]', 'Host\x20left.\x20Handing\x20stop\x20signal...', '[Config]\x20Error\x20parsing\x20', 'lang_set', 'warn', 'runCommand', 'isProcessingTags', 'logInfo', 'parse', '7713396uDAPzv', 'bindWorld', 'tag\x20@s\x20add\x20\x22pvc:roomId=', '\x1b[33m[Log][', 'sendMessage', 'find', '303660zOCbrb', 'PlayerTransform', 'values', '[Relay]\x20Connected\x20(ID:\x20', 'join_pass_msg', 'handleDirectVcConnection', 'disconnect_command', 'verify', 'output', 'post', 'connectCommand', 'replace']; _0x304f = function () { return _0x18a7d6; }; return _0x304f(); } let sshHandler = null; try { fs[_0x3afe64(0x2cc)](_0x3afe64(0x288)) && (sshHandler = require('./tcpexposer/tcpexposer_handler.js')); } catch (_0x28d74d) { } const jaLoc = require('./locales/ja.json'), enLoc = require('./locales/en.json'), zhLoc = require(_0x3afe64(0x22b)), locales = { 'ja': jaLoc, 'en': enLoc, 'zh': zhLoc }, RELAY_SERVER_DOMAIN = 'mcproxvc.fly.dev', TIMEOUT_THRESHOLD = 0xa, INACTIVITY_TIMEOUT = 0x1e * 0x3c * 0x3e8, MAX_RUNTIME = 0x4 * 0x3c * 0x3c * 0x3e8, configCandidates = [_0x3afe64(0x2a6), _0x3afe64(0x2d3), _0x3afe64(0x1fa)]; let globalConfig = {}, configLoaded = ![], configPath = ''; for (const filePath of configCandidates) { if (fs['existsSync'](filePath)) try { const fileContent = fs['readFileSync'](filePath, _0x3afe64(0x212)); globalConfig = JSON5[_0x3afe64(0x239)](fileContent), configLoaded = !![], configPath = filePath; break; } catch (_0x464361) { console['error'](_0x3afe64(0x233) + filePath + ':', _0x464361['message']); } } !configLoaded && console[_0x3afe64(0x235)](_0x3afe64(0x206)); const DEFAULT_CONFIG = { 'app_id': '', 'secret_key': '', 'username': '', 'sub_domain': '', 'ssh_password': '', 'port': 0x4abc, 'web_port': 0x1f40, 'proximity': !![], 'spectator': !![], 'specListen': !![], 'specDim': ![], 'password': ![], 'verify': undefined, 'output': !![], 'distance': 0xa, 'lang': 'en' }, INITIAL_CONFIG = { ...DEFAULT_CONFIG, ...globalConfig }; INITIAL_CONFIG[_0x3afe64(0x2e0)] = INITIAL_CONFIG['verify'] ?? INITIAL_CONFIG[_0x3afe64(0x2e0)]; async function updateConfigFile(_0x5773c3, _0xac2bcf) { const _0x1d7ae2 = _0x3afe64; if (!configPath) return; try { let _0x1dcee4 = await fsPromises[_0x1d7ae2(0x200)](configPath, _0x1d7ae2(0x212)); const _0x8a4740 = new RegExp('(\x22' + _0x5773c3 + _0x1d7ae2(0x25b)), _0x428ecf = typeof _0xac2bcf === 'string' ? '\x22' + _0xac2bcf + '\x22' : _0xac2bcf, _0x1624e1 = _0x1dcee4[_0x1d7ae2(0x24b)](_0x8a4740, '$1' + _0x428ecf); _0x1624e1 !== _0x1dcee4 && await fsPromises['writeFile'](configPath, _0x1624e1, _0x1d7ae2(0x212)); } catch (_0x4a0073) { console['error']('❌\x20設定ファイルの更新に失敗しました:', _0x4a0073); } }; const makeRange = (_0x3872d1, _0x4adaf7) => Array[_0x3afe64(0x26a)]({ 'length': _0x4adaf7 - _0x3872d1 + 0x1 }, (_0x5233b5, _0xf7e3d3) => _0x3872d1 + _0xf7e3d3); function _0x5ada(_0x44374a, _0x982813) { _0x44374a = _0x44374a - 0x1cf; const _0x304f19 = _0x304f(); let _0x5ada03 = _0x304f19[_0x44374a]; return _0x5ada03; } let globalGatewayServer = null; async function startTcpexposer(_0xd2b5da, _0x210992, _0x297373) { const _0x378572 = _0x3afe64; return sshHandler && typeof sshHandler[_0x378572(0x2e8)] === _0x378572(0x2d0) ? await sshHandler['startTcpexposer'](_0xd2b5da, _0x210992, _0x297373) : (_0xd2b5da[_0x378572(0x238)](_0x378572(0x2c8)), _0xd2b5da['roomId'] = '', _0xd2b5da[_0x378572(0x270)](), null); } async function tryDecode(_0x3d036e) { const _0x27053b = _0x3afe64; try { const _0xa8e081 = _0x3d036e instanceof Blob ? await _0x3d036e[_0x27053b(0x264)]() : _0x3d036e; return msgpack[_0x27053b(0x2ca)](new Uint8Array(_0xa8e081)); } catch (_0x16abfb) { try { return JSON['parse'](_0x3d036e); } catch (_0x46e1af) { return null; } } } function setupGlobalVcWebSocket(_0x54e3f1) { const _0x4d6601 = _0x3afe64; if (globalGatewayServer) return; const _0x44a44c = express(), _0x116cf0 = http['createServer'](_0x44a44c), _0x59a362 = new WebSocket['Server']({ 'noServer': !![] }); _0x44a44c[_0x4d6601(0x203)](express[_0x4d6601(0x220)]()), _0x44a44c[_0x4d6601(0x249)]('/', (_0x185793, _0x5700bb) => { const _0x8ceb81 = _0x4d6601, { type: _0x345924 } = _0x185793[_0x8ceb81(0x1e1)], _0xf9985b = _0x185793[_0x8ceb81(0x298)]['host']; let _0x136dea = null; if (_0xf9985b) { for (const _0x4f97af of sessions['values']()) { const _0x3c62aa = _0x4f97af['config'][_0x8ceb81(0x2dd)]; if (_0x3c62aa && _0xf9985b[_0x8ceb81(0x2dc)](_0x3c62aa)) { _0x136dea = _0x4f97af; break; } } if (!_0x136dea) for (const _0x2dd15f of pendingSessions[_0x8ceb81(0x242)]()) { const _0x198e57 = _0x2dd15f['config'][_0x8ceb81(0x2dd)]; if (_0x198e57 && _0xf9985b[_0x8ceb81(0x2dc)](_0x198e57)) { _0x136dea = _0x2dd15f; break; } } } if (_0x136dea) { if (_0x345924 === _0x8ceb81(0x227)) _0x136dea[_0x8ceb81(0x1d5)](_0x185793['body']); else { if (_0x345924 === _0x8ceb81(0x246)) _0x136dea[_0x8ceb81(0x29a)](_0x8ceb81(0x27a)); } _0x345924 === 'initialization' ? (_0x136dea[_0x8ceb81(0x2c2)] = !![], _0x136dea['logInfo'](_0x8ceb81(0x256)), _0x5700bb[_0x8ceb81(0x262)](0xc8)[_0x8ceb81(0x220)]({ 'type': _0x8ceb81(0x2da), 'roomId': _0x136dea['roomId'], 'ws_connected': _0x136dea[_0x8ceb81(0x2e2)], ..._0x136dea[_0x8ceb81(0x28e)] })) : _0x5700bb[_0x8ceb81(0x262)](0xc8)['json']({ 'success': !![] }); } else _0x5700bb['status'](0x194)[_0x8ceb81(0x220)]({ 'error': 'Session\x20not\x20found\x20for\x20this\x20domain' }); }), _0x44a44c[_0x4d6601(0x27b)]('/', (_0x391a0b, _0x49ed10) => { const _0x43824e = _0x4d6601; _0x49ed10[_0x43824e(0x1ea)](_0x43824e(0x2a9)); }), _0x116cf0['on']('upgrade', (_0x33f3c9, _0x24da49, _0x36b7d6) => { const _0x1d14e8 = _0x4d6601; let _0x43ea6e = null, _0x14f710 = null; try { const _0xf3a0a4 = _0x33f3c9[_0x1d14e8(0x298)][_0x1d14e8(0x2c3)] || _0x1d14e8(0x29e); let _0x48966d = _0x33f3c9[_0x1d14e8(0x1fe)] || '/'; if (_0x48966d === '//') _0x48966d = '/'; _0x14f710 = new URL(_0x48966d, _0x1d14e8(0x1df) + _0xf3a0a4), _0x43ea6e = _0x14f710[_0x1d14e8(0x24e)]['get'](_0x1d14e8(0x1dd)); } catch (_0x383c4a) { _0x43ea6e = null; } _0x43ea6e !== 'vc' ? sshHandler && typeof sshHandler[_0x1d14e8(0x225)] === 'function' ? sshHandler[_0x1d14e8(0x225)](_0x33f3c9, _0x24da49, _0x36b7d6, INITIAL_CONFIG[_0x1d14e8(0x251)]) : _0x24da49[_0x1d14e8(0x29a)]() : _0x59a362[_0x1d14e8(0x28d)](_0x33f3c9, _0x24da49, _0x36b7d6, _0x27c8cc => { const _0x2bbde8 = _0x1d14e8, _0x3b9964 = _0x33f3c9[_0x2bbde8(0x298)][_0x2bbde8(0x2c3)]; let _0x2de42a = null; if (_0x3b9964) { for (const _0x4fd3bd of sessions['values']()) { const _0x33ab9f = _0x4fd3bd[_0x2bbde8(0x28e)][_0x2bbde8(0x2dd)]; if (_0x33ab9f && _0x3b9964[_0x2bbde8(0x2dc)](_0x33ab9f)) { _0x2de42a = _0x4fd3bd; break; } } if (!_0x2de42a) for (const _0x35aa1 of pendingSessions[_0x2bbde8(0x242)]()) { const _0x546de1 = _0x35aa1[_0x2bbde8(0x28e)][_0x2bbde8(0x2dd)]; if (_0x546de1 && _0x3b9964[_0x2bbde8(0x2dc)](_0x546de1)) { _0x2de42a = _0x35aa1; break; } } } if (_0x2de42a) _0x2de42a[_0x2bbde8(0x245)](_0x27c8cc); else { const _0x200302 = sessions['values']()[_0x2bbde8(0x223)]()[_0x2bbde8(0x1d3)] || pendingSessions[_0x2bbde8(0x242)]()[_0x2bbde8(0x223)]()[_0x2bbde8(0x1d3)]; if (_0x200302) _0x200302['handleDirectVcConnection'](_0x27c8cc); else _0x27c8cc['close'](); } }); }), _0x116cf0[_0x4d6601(0x2e9)](_0x54e3f1, () => { }), globalGatewayServer = _0x116cf0; }; class Session { constructor(_0x21ae7e, _0x5a4729 = {}) { const _0x5ae6a9 = _0x3afe64; this['id'] = randomUUID(), this[_0x5ae6a9(0x1da)] = _0x21ae7e, this[_0x5ae6a9(0x1e5)] = _0x21ae7e ? _0x21ae7e['name'] || _0x5ae6a9(0x202) : _0x5ae6a9(0x276), this['nameCache'] = new Map(), this[_0x5ae6a9(0x28e)] = { ...INITIAL_CONFIG, ..._0x5a4729 }, this[_0x5ae6a9(0x2c9)] = this[_0x5ae6a9(0x28e)][_0x5ae6a9(0x2dd)], this['connectCommand'] = '', this[_0x5ae6a9(0x205)] = {}, this[_0x5ae6a9(0x293)] = {}, this[_0x5ae6a9(0x2ba)] = {}, this[_0x5ae6a9(0x1eb)] = {}, this[_0x5ae6a9(0x26d)] = {}, this[_0x5ae6a9(0x254)] = new Set(), this[_0x5ae6a9(0x295)] = !![], this[_0x5ae6a9(0x2c2)] = ![], this['mc_connected'] = ![], this[_0x5ae6a9(0x22c)] = ![], this[_0x5ae6a9(0x28f)] = ![], this[_0x5ae6a9(0x257)] = ![], this[_0x5ae6a9(0x2be)] = null, this[_0x5ae6a9(0x20e)] = null, this[_0x5ae6a9(0x1fc)] = new Set(), this[_0x5ae6a9(0x2a1)] = null, this['sshError'] = null, this[_0x5ae6a9(0x1e8)] = null, this[_0x5ae6a9(0x222)] = 0x0, this['pendingTimeout'] = null, this[_0x5ae6a9(0x22e)] = this[_0x5ae6a9(0x21e)](); } [_0x3afe64(0x238)](_0x5ab7af) { const _0x151a90 = _0x3afe64; console[_0x151a90(0x1d9)](_0x151a90(0x2cf) + this['id']['substring'](0x0, 0x6) + ']\x1b[0m\x20' + _0x5ab7af); } ['t'](_0x1ba021, _0xe208be = {}) { const _0x376c3f = _0x3afe64, _0xb4ea01 = this[_0x376c3f(0x28e)][_0x376c3f(0x279)] || 'en'; let _0x29797d = locales[_0xb4ea01] && locales[_0xb4ea01][_0x1ba021] || locales['en'][_0x1ba021] || _0x1ba021; for (const [_0xe80b70, _0x767a56] of Object[_0x376c3f(0x27d)](_0xe208be)) { _0x29797d = _0x29797d[_0x376c3f(0x24b)]('{' + _0xe80b70 + '}', _0x767a56); } return _0x29797d; } [_0x3afe64(0x21d)](_0xb6205d) { const _0x5f2ebb = _0x3afe64; console['log'](_0x5f2ebb(0x23d) + this['id'][_0x5f2ebb(0x25a)](0x0, 0x6) + _0x5f2ebb(0x2ae) + _0xb6205d); } [_0x3afe64(0x260)](_0x22026e) { const _0x43764a = _0x3afe64; if (!this['nameCache'][_0x43764a(0x25e)](_0x22026e)) { const _0x29feb0 = wanakana['toRomaji'](_0x22026e)[_0x43764a(0x24b)](/n'/g, 'n'); this[_0x43764a(0x2cb)][_0x43764a(0x229)](_0x22026e, _0x29feb0); } return this[_0x43764a(0x2cb)][_0x43764a(0x27b)](_0x22026e); } [_0x3afe64(0x245)](_0x4885a5) { const _0x4b7442 = _0x3afe64; this[_0x4b7442(0x1fc)]['add'](_0x4885a5), this[_0x4b7442(0x2c2)] = !![], this[_0x4b7442(0x2db)](_0x4885a5), _0x4885a5['on']('message', async _0x597399 => { const _0x21f366 = _0x4b7442; try { const _0xb616d8 = await tryDecode(_0x597399); if (_0xb616d8) { if (_0xb616d8[_0x21f366(0x2d8)] && _0xb616d8[_0x21f366(0x25d)]) this[_0x21f366(0x293)][_0xb616d8[_0x21f366(0x2d8)]] = _0xb616d8['position']; if (_0xb616d8[_0x21f366(0x24f)] === _0x21f366(0x2bd) && typeof _0xb616d8[_0x21f366(0x1d3)] === _0x21f366(0x1ef)) { if (this[_0x21f366(0x1da)]) { const _0xd795ca = await this[_0x21f366(0x1da)][_0x21f366(0x236)](_0xb616d8[_0x21f366(0x1d3)]); _0x4885a5[_0x21f366(0x1ea)](JSON[_0x21f366(0x21b)]({ 'type': _0x21f366(0x28c), 'payload': _0xd795ca })); } } } } catch (_0x5b0332) { } }), _0x4885a5['on']('close', () => { this['directVcClients']['delete'](_0x4885a5); }); } async[_0x3afe64(0x24d)]() { const _0x406a1c = _0x3afe64, { sub_domain: _0x11a478, username: _0x5c7a8c, ssh_password: _0x33993c } = this['config']; _0x5c7a8c && _0x33993c && _0x11a478 ? this[_0x406a1c(0x2a1)] = await startTcpexposer(this, _0x11a478, INITIAL_CONFIG['web_port']) : (this[_0x406a1c(0x2c9)] = '', await this[_0x406a1c(0x270)]()); } [_0x3afe64(0x23b)](_0x9ca17c) { const _0x3a62d7 = _0x3afe64; this[_0x3a62d7(0x2b7)] && (clearTimeout(this[_0x3a62d7(0x2b7)]), this[_0x3a62d7(0x2b7)] = null), this[_0x3a62d7(0x1da)] = _0x9ca17c, this[_0x3a62d7(0x1e5)] = _0x9ca17c['name'] || _0x3a62d7(0x202), this['init'](); } async['init']() { const _0x3a1f75 = _0x3afe64; if (!this[_0x3a1f75(0x1da)] && !this['pendingTimeout']) return; if (!this[_0x3a1f75(0x28f)] && !this[_0x3a1f75(0x2a1)]) { const { sub_domain: _0x141228, username: _0x5d7885, ssh_password: _0x1d0473 } = this[_0x3a1f75(0x28e)]; if (_0x5d7885 && _0x1d0473 && _0x141228) { this[_0x3a1f75(0x2a1)] = await startTcpexposer(this, _0x141228, INITIAL_CONFIG[_0x3a1f75(0x26e)]); if (!this[_0x3a1f75(0x2a1)]) { if (!this[_0x3a1f75(0x28f)]) await this[_0x3a1f75(0x270)](); } } else { if (!_0x141228) await this['connectToRelayServer'](); } } this['mc_connected'] = !![], this[_0x3a1f75(0x22c)] = ![], this[_0x3a1f75(0x238)](_0x3a1f75(0x256)); if (this['world']) { try { await this['cleanOldTags'](), this[_0x3a1f75(0x1da)][_0x3a1f75(0x236)](_0x3a1f75(0x23c) + this['roomId'] + '\x22'), this['sendInitMessage'](); } catch (_0x16eb87) { } this['loop'](); } } async['cleanOldTags']() { const _0x4d576e = _0x3afe64; if (!this['world']) return; try { const _0x471d44 = await this[_0x4d576e(0x1db)](); for (const _0xf10525 of _0x471d44) { await this[_0x4d576e(0x1da)][_0x4d576e(0x236)](_0x4d576e(0x2f2) + _0xf10525 + _0x4d576e(0x221) + _0xf10525 + '\x22'); } const _0x4aa917 = await this['world'][_0x4d576e(0x236)]('testfor\x20@a'); this[_0x4d576e(0x254)]['clear'](); if (_0x4aa917[_0x4d576e(0x211)]) _0x4aa917['victim'][_0x4d576e(0x2ac)](_0x47c527 => this[_0x4d576e(0x254)][_0x4d576e(0x1d2)](_0x47c527)); } catch (_0x24ea93) { } } ['sendInitMessage']() { const _0x6d732a = _0x3afe64; if (!this[_0x6d732a(0x1da)]) return; const { proximity: _0x224194, distance: _0x37bab6 } = this[_0x6d732a(0x28e)], _0x566df9 = _0x224194 ? this['t'](_0x6d732a(0x1d1)) : this['t'](_0x6d732a(0x258)); this[_0x6d732a(0x1da)][_0x6d732a(0x23e)](this['t'](_0x6d732a(0x281), { 'proximity': _0x566df9, 'distance': _0x37bab6 }))['catch'](_0x514641 => { }); } [_0x3afe64(0x2c1)]() { const _0x54cf91 = _0x3afe64; this[_0x54cf91(0x257)] = !![], clearTimeout(this[_0x54cf91(0x1e8)]), this['inactivityTimer'] = setTimeout(() => { const _0x3c55de = _0x54cf91; this['destroy'](_0x3c55de(0x1fd)); }, INACTIVITY_TIMEOUT); } [_0x3afe64(0x2c6)]() { const _0x2ab5c3 = _0x3afe64; if (this[_0x2ab5c3(0x2e6)]) return; this[_0x2ab5c3(0x2e6)] = setTimeout(() => { const _0x4e0452 = _0x2ab5c3; if (this['world']) this[_0x4e0452(0x1da)][_0x4e0452(0x23e)](this['t'](_0x4e0452(0x277)))['catch'](() => { }); console[_0x4e0452(0x1d9)]('\x0a======================================================='), console[_0x4e0452(0x1d9)](_0x4e0452(0x1e9) + this['worldName'] + _0x4e0452(0x271)), console[_0x4e0452(0x1d9)](_0x4e0452(0x215)), setTimeout(() => this[_0x4e0452(0x29a)]('timeout\x20maxRuntime'), 0x1388); }, MAX_RUNTIME), this[_0x2ab5c3(0x2c1)](); } async[_0x3afe64(0x1de)]() { const _0x6d6af7 = _0x3afe64; if (this[_0x6d6af7(0x22c)] || !this['world']) return; try { if (this[_0x6d6af7(0x257)]) this[_0x6d6af7(0x2c1)](); let _0x6da441 = { 'playersNames': [], 'aliveSet': new Set(), 'spectatorSet': new Set(), 'details': [] }, _0x5786ec = { 'statusCode': -0x1 }; if (this[_0x6d6af7(0x28e)][_0x6d6af7(0x20f)]) { const [_0x45a528, _0x3057e7, _0x2ac046, _0x4e0344, _0x3ac64d] = await Promise[_0x6d6af7(0x266)]([this[_0x6d6af7(0x1da)][_0x6d6af7(0x236)](_0x6d6af7(0x265)), this['world'][_0x6d6af7(0x236)](_0x6d6af7(0x24c)), this['world']['runCommand'](_0x6d6af7(0x231)), this[_0x6d6af7(0x1da)][_0x6d6af7(0x236)](_0x6d6af7(0x269)), this['world'][_0x6d6af7(0x236)]('testfor\x20@a[tag=pvc:req_cmd]')]); _0x5786ec = _0x3ac64d; if (_0x45a528[_0x6d6af7(0x2d4)] <= -0x1) { this['consecutiveTimeouts']++; if (this['consecutiveTimeouts'] >= TIMEOUT_THRESHOLD) { this['destroy'](_0x6d6af7(0x285)); return; } } else this[_0x6d6af7(0x222)] = 0x0; _0x45a528[_0x6d6af7(0x2d4)] === 0x0 && typeof _0x45a528[_0x6d6af7(0x2a3)] === _0x6d6af7(0x1ef) && (_0x6da441[_0x6d6af7(0x283)] = _0x45a528['players'][_0x6d6af7(0x213)](',')[_0x6d6af7(0x2b8)](_0xafc573 => _0xafc573[_0x6d6af7(0x263)]())['filter'](_0x2a8e0a => _0x2a8e0a[_0x6d6af7(0x219)] > 0x0)); if (_0x3057e7[_0x6d6af7(0x211)]) _0x3057e7['victim']['forEach'](_0x5374c0 => _0x6da441[_0x6d6af7(0x2df)][_0x6d6af7(0x1d2)](_0x5374c0)); if (_0x2ac046[_0x6d6af7(0x211)]) _0x2ac046['victim']['forEach'](_0x40b3de => _0x6da441['spectatorSet'][_0x6d6af7(0x1d2)](_0x40b3de)); try { _0x6da441['details'] = JSON['parse'](_0x4e0344['details'] || '[]'); } catch (_0x31f758) { _0x6da441[_0x6d6af7(0x2f4)] = []; } } else { const [_0x5b3fa6, _0x25a47a] = await Promise[_0x6d6af7(0x266)]([this[_0x6d6af7(0x1da)][_0x6d6af7(0x236)](_0x6d6af7(0x265)), this[_0x6d6af7(0x1da)]['runCommand'](_0x6d6af7(0x2bc))]); _0x5786ec = _0x25a47a; if (_0x5b3fa6[_0x6d6af7(0x2d4)] <= -0x1) { this['consecutiveTimeouts']++; if (this[_0x6d6af7(0x222)] >= TIMEOUT_THRESHOLD) { this['destroy'](_0x6d6af7(0x285)); return; } } else this[_0x6d6af7(0x222)] = 0x0; } const _0x21e48c = Array['from'](_0x6da441['aliveSet']); _0x6da441[_0x6d6af7(0x283)][_0x6d6af7(0x2ac)](_0x4db234 => { const _0x4039c4 = _0x6d6af7, _0x45a65b = this[_0x4039c4(0x260)](_0x4db234), _0x544d25 = _0x6da441['spectatorSet'][_0x4039c4(0x25e)](_0x4db234); this[_0x4039c4(0x26d)][_0x45a65b] = _0x544d25; if (!this[_0x4039c4(0x28e)][_0x4039c4(0x20f)]) this[_0x4039c4(0x293)][_0x45a65b] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; else { if (!_0x6da441[_0x4039c4(0x2df)][_0x4039c4(0x25e)](_0x4db234)) this['positions'][_0x45a65b] = { 'x': 0x0, 'y': 0x4e20, 'z': 0x0 }; else { if (this[_0x4039c4(0x28e)][_0x4039c4(0x2ad)] && _0x544d25) { if (this[_0x4039c4(0x28e)]['specListen'] === !![]) { const _0x5b0a0a = _0x21e48c[_0x4039c4(0x210)](_0x4db234); if (_0x5b0a0a !== -0x1 && _0x6da441[_0x4039c4(0x2f4)][_0x5b0a0a]) { this[_0x4039c4(0x293)][_0x45a65b] = _0x6da441[_0x4039c4(0x2f4)][_0x5b0a0a][_0x4039c4(0x25d)]; if (this['config']['specDim'] === !![]) this[_0x4039c4(0x1eb)][_0x45a65b] = _0x6da441[_0x4039c4(0x2f4)][_0x5b0a0a]['dimension']; } else this[_0x4039c4(0x293)][_0x45a65b] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; } else this[_0x4039c4(0x293)][_0x45a65b] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; } else { const _0x503ecd = _0x21e48c['indexOf'](_0x4db234); if (_0x503ecd !== -0x1 && _0x6da441['details'][_0x503ecd]) this[_0x4039c4(0x293)][_0x45a65b] = _0x6da441[_0x4039c4(0x2f4)][_0x503ecd][_0x4039c4(0x25d)], this['yRots'][_0x45a65b] = _0x6da441['details'][_0x503ecd][_0x4039c4(0x214)], this[_0x4039c4(0x1eb)][_0x45a65b] = _0x6da441[_0x4039c4(0x2f4)][_0x503ecd]['dimension']; else this[_0x4039c4(0x293)][_0x45a65b] = { 'x': 0x0, 'y': 0x7530, 'z': 0x0 }; } } } }), this['shouldBroadcast'] = !![], this[_0x6d6af7(0x228)](); if (_0x5786ec[_0x6d6af7(0x2d4)] === 0x0 && !this[_0x6d6af7(0x237)]) { this[_0x6d6af7(0x237)] = !![]; const _0x29bd12 = _0x5786ec['victim'][0x0]; this[_0x6d6af7(0x1ec)](_0x29bd12)[_0x6d6af7(0x2b1)](_0x3618a1 => { const _0x349b28 = _0x6d6af7; console[_0x349b28(0x26f)]('Tag\x20processing\x20error:', _0x3618a1); })[_0x6d6af7(0x27c)](() => { const _0x10d555 = _0x6d6af7; this[_0x10d555(0x237)] = ![]; }); } } catch (_0x6b91a0) { console['error'](_0x6d6af7(0x2b2) + this[_0x6d6af7(0x1e5)] + ']:', _0x6b91a0); } if (!this['stop_roop']) setTimeout(() => this[_0x6d6af7(0x1de)](), 0x0); } async[_0x3afe64(0x1ec)](_0x342e0d) { const _0x3e0e31 = _0x3afe64, _0x17b46d = await this[_0x3e0e31(0x1da)][_0x3e0e31(0x236)]('tag\x20@a[tag=pvc:req_cmd]\x20list'); if (_0x17b46d[_0x3e0e31(0x2d4)] === 0x0 && _0x17b46d[_0x3e0e31(0x2b0)]) { let _0x26be82 = []; const _0xcc827e = new Player(this[_0x3e0e31(0x1da)], _0x342e0d), _0x19d83d = _0x17b46d[_0x3e0e31(0x2b0)][_0x3e0e31(0x213)](/\r\n|\n|\r/); for (const _0x4ae338 of _0x19d83d) { if (!_0x4ae338[_0x3e0e31(0x263)]()) continue; const _0x68b7d6 = _0x4ae338['replace'](/§./g, ''), _0x46e99d = _0x68b7d6[_0x3e0e31(0x210)](':'); _0x46e99d !== -0x1 && (_0x26be82 = _0x26be82['concat'](_0x68b7d6['substring'](_0x46e99d + 0x1)[_0x3e0e31(0x213)](',')['map'](_0x2fb3b4 => _0x2fb3b4[_0x3e0e31(0x263)]())[_0x3e0e31(0x21c)](_0x2177cd => _0x2177cd['startsWith'](_0x3e0e31(0x22a))))); for (const _0x2ffcc4 of _0x26be82) { if (_0x2ffcc4 === _0x3e0e31(0x2c7) || _0x2ffcc4[_0x3e0e31(0x2dc)](_0x3e0e31(0x2c5))) continue; const _0x486785 = _0x2ffcc4['startsWith'](_0x3e0e31(0x22a)) ? _0x2ffcc4[_0x3e0e31(0x25a)](_0x3e0e31(0x22a)[_0x3e0e31(0x219)]) : _0x2ffcc4; let [_0x34b7e5, ..._0x323b03] = _0x486785[_0x3e0e31(0x213)]('='); _0x34b7e5 = '!' + _0x34b7e5, this[_0x3e0e31(0x22e)][_0x34b7e5] && (await this[_0x3e0e31(0x22e)][_0x34b7e5](this['world'], _0xcc827e, _0x323b03), this['world'][_0x3e0e31(0x236)]('tag\x20@a\x20remove\x20\x22' + _0x2ffcc4 + '\x22')); } } await this[_0x3e0e31(0x1da)][_0x3e0e31(0x236)](_0x3e0e31(0x2cd)); } } async['getAllTags']() { const _0x22990c = _0x3afe64; if (!this[_0x22990c(0x1da)]) return []; try { const _0x46470d = await this[_0x22990c(0x1da)][_0x22990c(0x236)]('tag\x20@a\x20list'); if (_0x46470d[_0x22990c(0x2d4)] !== 0x0 || !_0x46470d[_0x22990c(0x2b0)]) return []; let _0x3f5e97 = []; const _0x14b9f4 = _0x46470d[_0x22990c(0x2b0)][_0x22990c(0x213)](/\r\n|\n|\r/); for (const _0x36df49 of _0x14b9f4) { if (!_0x36df49[_0x22990c(0x263)]()) continue; const _0x1a6173 = _0x36df49[_0x22990c(0x24b)](/§./g, ''), _0x2692ad = _0x1a6173[_0x22990c(0x210)](':'); _0x2692ad !== -0x1 && (_0x3f5e97 = _0x3f5e97[_0x22990c(0x1ee)](_0x1a6173[_0x22990c(0x25a)](_0x2692ad + 0x1)[_0x22990c(0x213)](',')[_0x22990c(0x2b8)](_0x423e85 => _0x423e85[_0x22990c(0x263)]())[_0x22990c(0x21c)](_0x528c7e => _0x528c7e[_0x22990c(0x2dc)](_0x22990c(0x22a))))); } return _0x3f5e97; } catch (_0x20d192) { return []; } } [_0x3afe64(0x228)]() { const _0x1b8240 = _0x3afe64; if (!this[_0x1b8240(0x295)]) return; const _0x59c02c = {}; for (const [_0x148925, _0x3a00ba] of Object['entries'](this['positions'])) { if (_0x3a00ba) _0x59c02c[_0x148925] = [Math[_0x1b8240(0x1d0)](_0x3a00ba['x'] * 0x64) / 0x64, Math[_0x1b8240(0x1d0)](_0x3a00ba['y'] * 0x64) / 0x64, Math['round'](_0x3a00ba['z'] * 0x64) / 0x64]; } const _0x4496b9 = { 'spec': this[_0x1b8240(0x28e)][_0x1b8240(0x2ad)], 'spLis': this[_0x1b8240(0x28e)][_0x1b8240(0x2d2)], 'spDim': this[_0x1b8240(0x28e)]['specDim'], 't': 'wu', 'pos': _0x59c02c, 'dis': this['config'][_0x1b8240(0x22d)], 'pssws': this[_0x1b8240(0x205)], 'dim': this[_0x1b8240(0x1eb)], 'yr': this['yRots'], 'spPos': this[_0x1b8240(0x26d)], 'prox': this[_0x1b8240(0x28e)][_0x1b8240(0x20f)] ? 0x1 : 0x0 }, _0x3a4186 = msgpack[_0x1b8240(0x1e3)](_0x4496b9); if (this['relayWs'] && this[_0x1b8240(0x2be)]['readyState'] === WebSocket['OPEN']) this[_0x1b8240(0x2be)]['send'](_0x3a4186); this[_0x1b8240(0x1fc)]['forEach'](_0x3884eb => { const _0x17635a = _0x1b8240; if (_0x3884eb[_0x17635a(0x201)] === WebSocket[_0x17635a(0x207)]) _0x3884eb[_0x17635a(0x1ea)](_0x3a4186); }); } async[_0x3afe64(0x270)]() { const _0x446305 = _0x3afe64, _0x52ddf3 = _0x446305(0x20c); try { if (!this['roomId']) { const _0x6f5f80 = await fetch(_0x446305(0x218) + RELAY_SERVER_DOMAIN + _0x446305(0x275) + this[_0x446305(0x28e)]['sub_domain']), _0x28ff9d = await _0x6f5f80[_0x446305(0x220)](); this[_0x446305(0x2c9)] = _0x28ff9d['roomId'], this[_0x446305(0x1da)] && (this[_0x446305(0x1f4)](), this['world'][_0x446305(0x236)](_0x446305(0x23c) + this['roomId'] + '\x22')['catch'](() => { }), await this['world'][_0x446305(0x23e)](this['t'](_0x446305(0x2d7), { 'roomId': this[_0x446305(0x2c9)] }))); } else !this['useRelay'] && (this[_0x446305(0x1da)] && await this['world']['sendMessage'](this['t'](_0x446305(0x2d7), { 'roomId': this[_0x446305(0x2c9)] }))); this[_0x446305(0x28f)] = !![], console[_0x446305(0x1d9)](_0x446305(0x2eb)), this['logInfo'](this['t']('mc_connect_guide')), this[_0x446305(0x238)](_0x446305(0x299) + RELAY_SERVER_DOMAIN + _0x446305(0x294) + this[_0x446305(0x2c9)]), this[_0x446305(0x24a)] = _0x446305(0x299) + RELAY_SERVER_DOMAIN + _0x446305(0x294) + this[_0x446305(0x2c9)], this[_0x446305(0x238)](_0x446305(0x2bb) + this['roomId']), this['logInfo'](this['t']('vc_connect_guide')), this[_0x446305(0x238)](_0x446305(0x284) + this[_0x446305(0x2c9)]), console[_0x446305(0x1d9)]('=======================================================\x0a'), this[_0x446305(0x2c6)](); let _0xb5926c; this['relayWs'] ? _0xb5926c = this[_0x446305(0x2be)] : (_0xb5926c = new WebSocket('wss://' + RELAY_SERVER_DOMAIN + '/room/' + this[_0x446305(0x2c9)] + _0x446305(0x273)), this['relayWs'] = _0xb5926c, _0xb5926c['on'](_0x446305(0x1cf), () => this[_0x446305(0x238)](_0x446305(0x243) + this[_0x446305(0x2c9)] + ')')), _0xb5926c['on']('close', () => { const _0x39ba76 = _0x446305; if (this[_0x39ba76(0x2be)] === _0xb5926c) this['relayWs'] = null; }), _0xb5926c['on'](_0x446305(0x26f), _0x45c8d2 => console[_0x446305(0x26f)](_0x52ddf3 + _0x446305(0x1e4), _0x45c8d2))), this[_0x446305(0x2e2)] = !![], this[_0x446305(0x2c2)] = !![], this[_0x446305(0x22f)](_0xb5926c); } catch (_0x25534a) { console[_0x446305(0x26f)](_0x52ddf3 + _0x446305(0x1e4), _0x25534a); } } [_0x3afe64(0x2db)](_0x29e328) { const _0x3b20fd = _0x3afe64, { app_id: _0x2d7b53, secret_key: _0x3e0b15, proximity: _0x3d6d02, distance: _0x287c17, spectator: _0x4544c1, specListen: _0x352785, specDim: _0x1f58b6, verify: _0xd149a8, password: _0xbcf4d0 } = this[_0x3b20fd(0x28e)]; _0x29e328[_0x3b20fd(0x1ea)](msgpack[_0x3b20fd(0x1e3)]({ 'password': !!(_0xd149a8 || _0xbcf4d0), 'passwords': this['passwords'], 'app_id': _0x2d7b53, 'secret_key': _0x3e0b15, 'proximity': _0x3d6d02, 'distance': _0x287c17, 'spectator': _0x4544c1, 'specListen': _0x352785, 'specDim': _0x1f58b6 })); } [_0x3afe64(0x22f)](_0x3ce695) { const _0x29acbf = _0x3afe64; _0x3ce695['on'](_0x29acbf(0x20a), async _0x48fd24 => { const _0x4ffb34 = _0x29acbf; let _0x31baba = _0x48fd24; try { Buffer['isBuffer'](_0x48fd24) && _0x48fd24[_0x4ffb34(0x219)] > 0x2 && _0x48fd24[0x0] === 0x1f && _0x48fd24[0x1] === 0x8b && (_0x31baba = zlib[_0x4ffb34(0x278)](_0x48fd24)); } catch (_0xd2b160) { } let _0x25e1d1 = !![]; try { const _0x34086f = JSON[_0x4ffb34(0x239)](_0x31baba[_0x4ffb34(0x25f)]()); if (_0x34086f[_0x4ffb34(0x204)] === _0x4ffb34(0x208)) { const _0x453cd7 = _0x34086f[_0x4ffb34(0x1dd)] || _0x4ffb34(0x2b9); _0x453cd7 === 'minecraft' ? (this[_0x4ffb34(0x20e)] = new WebSocket(_0x4ffb34(0x27f) + this[_0x4ffb34(0x28e)][_0x4ffb34(0x251)], { 'headers': { 'x-proxvc-session': this['id'] } }), this[_0x4ffb34(0x28b)] = [], this['localClient']['on'](_0x4ffb34(0x1cf), () => { const _0x3967d3 = _0x4ffb34; while (this['localClientBuffer'][_0x3967d3(0x219)] > 0x0) { const _0x234f48 = this['localClientBuffer'][_0x3967d3(0x2ea)](); this[_0x3967d3(0x20e)][_0x3967d3(0x1ea)](_0x234f48); } }), this[_0x4ffb34(0x20e)]['on'](_0x4ffb34(0x20a), _0x26c26b => _0x3ce695['readyState'] === WebSocket['OPEN'] && _0x3ce695[_0x4ffb34(0x1ea)](_0x26c26b)), this[_0x4ffb34(0x20e)]['on'](_0x4ffb34(0x291), (_0x57e875, _0x4f522d) => { const _0x3ffdeb = _0x4ffb34; if (_0x3ce695[_0x3ffdeb(0x201)] === WebSocket[_0x3ffdeb(0x207)]) _0x3ce695[_0x3ffdeb(0x291)](); }), this[_0x4ffb34(0x20e)]['on'](_0x4ffb34(0x26f), _0x264719 => console[_0x4ffb34(0x26f)](_0x4ffb34(0x2ed) + _0x264719[_0x4ffb34(0x20a)]))) : this['sendInitialPayload'](_0x3ce695); _0x25e1d1 = ![]; return; } else { if (_0x34086f[_0x4ffb34(0x204)] === _0x4ffb34(0x27e)) { this['localClient'] && (this[_0x4ffb34(0x20e)]['close'](), this[_0x4ffb34(0x20e)] = null); _0x25e1d1 = ![]; return; } else { if (_0x34086f['type'] === _0x4ffb34(0x292)) { try { let _0x53d435 = _0x34086f['data']; _0x53d435?.[_0x4ffb34(0x204)] === _0x4ffb34(0x287) && (_0x53d435 = Buffer[_0x4ffb34(0x26a)](_0x53d435[_0x4ffb34(0x1d7)])); const _0x28793e = await tryDecode(_0x53d435); if (_0x28793e) { if (_0x28793e[_0x4ffb34(0x204)] === _0x4ffb34(0x2bd) && typeof _0x28793e[_0x4ffb34(0x1d3)] === _0x4ffb34(0x1ef)) this[_0x4ffb34(0x1da)]?.[_0x4ffb34(0x236)](_0x28793e['value'])[_0x4ffb34(0x2b1)](() => { }); else { if (_0x28793e[_0x4ffb34(0x2d8)] && _0x28793e[_0x4ffb34(0x25d)]) this[_0x4ffb34(0x293)][_0x28793e['userName']] = _0x28793e[_0x4ffb34(0x25d)]; else _0x28793e[_0x4ffb34(0x204)] === _0x4ffb34(0x208) && this[_0x4ffb34(0x2db)](_0x3ce695); } } } catch (_0x41b553) { } _0x25e1d1 = ![]; return; } } } if (_0x34086f[_0x4ffb34(0x204)] === _0x4ffb34(0x1f3)) { if (this['world']) { const _0x5e5a3f = new Player(this['world'], _0x34086f['userName']); await _0x5e5a3f[_0x4ffb34(0x236)](_0x4ffb34(0x2b6) + _0x34086f['icon']); } _0x25e1d1 = ![]; } else { if (_0x34086f['action'] === _0x4ffb34(0x2bd)) { if (this[_0x4ffb34(0x1da)]) await this[_0x4ffb34(0x1da)][_0x4ffb34(0x236)](_0x34086f[_0x4ffb34(0x1d3)]); _0x25e1d1 = ![]; } } if (_0x34086f[_0x4ffb34(0x204)] === _0x4ffb34(0x227)) this[_0x4ffb34(0x1d5)](_0x34086f); } catch (_0x3a3694) { } if (_0x25e1d1) { if (this[_0x4ffb34(0x20e)]?.[_0x4ffb34(0x201)] === WebSocket[_0x4ffb34(0x207)]) this['localClient'][_0x4ffb34(0x1ea)](_0x31baba); else this[_0x4ffb34(0x20e)]?.[_0x4ffb34(0x201)] === WebSocket['CONNECTING'] && this[_0x4ffb34(0x28b)]['push'](_0x31baba); } }), _0x3ce695['on'](_0x29acbf(0x291), () => this[_0x29acbf(0x20e)]?.[_0x29acbf(0x291)]()); } [_0x3afe64(0x21e)]() { const _0x5baba0 = _0x3afe64, _0x2eb4ae = (_0x1d37d6, _0x5de0f7, _0x4076ff) => async (_0x5dafbb, _0x40d2e5, _0x3540cd) => { const _0x37f50b = _0x5ada; if (_0x40d2e5['name'] !== _0x5dafbb['localPlayer'][_0x37f50b(0x290)]) return; if (_0x3540cd[0x0] !== _0x37f50b(0x1dc) && _0x3540cd[0x0] !== _0x37f50b(0x1ed)) return; const _0x997b57 = _0x3540cd[0x0] === _0x37f50b(0x1dc); this[_0x37f50b(0x28e)][_0x1d37d6] = _0x997b57; if (_0x1d37d6 === _0x37f50b(0x247)) this['config'][_0x37f50b(0x2e0)] = _0x997b57; updateConfigFile(_0x1d37d6, _0x997b57); const _0x590f27 = _0x997b57 ? this['t'](_0x5de0f7) : this['t'](_0x4076ff), _0x2a8c05 = this['t'](_0x37f50b(0x2f0)); if (this[_0x37f50b(0x28e)][_0x37f50b(0x248)]) await _0x5dafbb[_0x37f50b(0x23e)](_0x2a8c05 + _0x590f27); }; return { '!dis': async (_0x5e16db, _0x38b56a, _0x3ed8db) => { const _0x1fce93 = _0x5ada; if (_0x38b56a[_0x1fce93(0x290)] !== _0x5e16db[_0x1fce93(0x2f3)][_0x1fce93(0x290)]) return; const _0x55ba8b = Number(_0x3ed8db[0x0]); if (!isNaN(_0x55ba8b)) { this['config'][_0x1fce93(0x22d)] = _0x55ba8b, updateConfigFile(_0x1fce93(0x22d), _0x55ba8b); const _0x3f9fff = this['t'](_0x1fce93(0x2ef), { 'distance': _0x55ba8b }); if (this['config'][_0x1fce93(0x248)]) await _0x5e16db[_0x1fce93(0x23e)](_0x3f9fff); } }, '!name': async (_0x2ffa12, _0x5d12d1) => { const _0x2650bc = _0x5ada, _0x117222 = this[_0x2650bc(0x260)](_0x5d12d1[_0x2650bc(0x290)]); await _0x5d12d1[_0x2650bc(0x23e)](this['t'](_0x2650bc(0x2aa), { 'roomId': this[_0x2650bc(0x2c9)], 'vcname': _0x117222 })), this[_0x2650bc(0x28e)]['password'] && (!this[_0x2650bc(0x205)][_0x117222] && (this[_0x2650bc(0x205)][_0x117222] = Math['floor'](0x3e8 + Math[_0x2650bc(0x2c0)]() * 0x2328)['toString']()), await _0x5d12d1[_0x2650bc(0x23e)](this['t'](_0x2650bc(0x2d1), { 'code': this['passwords'][_0x117222] }))); }, '!output': _0x2eb4ae('output', 'output_enabled', _0x5baba0(0x2a0)), '!password': _0x2eb4ae(_0x5baba0(0x247), _0x5baba0(0x2e3), _0x5baba0(0x28a)), '!verify': _0x2eb4ae(_0x5baba0(0x247), _0x5baba0(0x2e3), _0x5baba0(0x28a)), '!pvc': _0x2eb4ae(_0x5baba0(0x20f), _0x5baba0(0x259), _0x5baba0(0x289)), '!spectator': _0x2eb4ae(_0x5baba0(0x2ad), _0x5baba0(0x2af), 'spectator_common'), '!specListen': _0x2eb4ae(_0x5baba0(0x2d2), _0x5baba0(0x286), _0x5baba0(0x217)), '!specDim': _0x2eb4ae(_0x5baba0(0x1e6), _0x5baba0(0x1e0), 'specdim_common'), '!lang': async (_0x2a61df, _0x1456ff, _0x801fc5) => { const _0x187e17 = _0x5baba0; if (_0x1456ff[_0x187e17(0x290)] !== _0x2a61df[_0x187e17(0x2f3)][_0x187e17(0x290)]) return; const _0x58fa44 = _0x801fc5[0x0];['ja', 'en', 'zh']['includes'](_0x58fa44) && (this[_0x187e17(0x28e)][_0x187e17(0x279)] = _0x58fa44, updateConfigFile(_0x187e17(0x279), _0x58fa44), await _0x2a61df[_0x187e17(0x23e)](this['t'](_0x187e17(0x234)))); }, '!config': async (_0x20b2ab, _0x6b154a) => { const _0x317a59 = _0x5baba0; if (_0x6b154a[_0x317a59(0x290)] !== _0x20b2ab[_0x317a59(0x2f3)]['name']) return; const { proximity: _0x43fb3f, distance: _0x2e8888, password: _0x25fb25, spectator: _0x5ba8b7, specListen: _0x437fa6, specDim: _0x2e22ed, lang: _0x4ab934, output: _0x2b8856 } = this[_0x317a59(0x28e)], _0x41058a = _0x57576c => _0x57576c ? this['t'](_0x317a59(0x272)) : this['t'](_0x317a59(0x1d8)), _0x511a90 = this['t'](_0x317a59(0x2b3), { 'lang': _0x4ab934, 'proximity': _0x41058a(_0x43fb3f), 'distance': _0x2e8888, 'verify': _0x41058a(_0x25fb25), 'output': _0x41058a(_0x2b8856), 'spectator': _0x41058a(_0x5ba8b7), 'listen': _0x41058a(_0x437fa6), 'dim': _0x41058a(_0x2e22ed) }); await _0x6b154a['sendMessage'](_0x511a90); }, '!help': async (_0x311134, _0x22afbd) => { const _0x36f4a8 = _0x5baba0; await _0x22afbd[_0x36f4a8(0x23e)](this['t'](_0x36f4a8(0x2e4))), await _0x22afbd[_0x36f4a8(0x23e)](this['t'](_0x36f4a8(0x216))), _0x22afbd[_0x36f4a8(0x290)] == _0x311134[_0x36f4a8(0x2f3)][_0x36f4a8(0x290)] && (await _0x22afbd['sendMessage'](this['t'](_0x36f4a8(0x2f1))), await _0x22afbd[_0x36f4a8(0x23e)](this['t'](_0x36f4a8(0x255))), await _0x22afbd[_0x36f4a8(0x23e)](this['t'](_0x36f4a8(0x21f)))), await _0x22afbd[_0x36f4a8(0x23e)](this['t'](_0x36f4a8(0x2e4))); }, '!disconnect': async (_0x59ee53, _0x3d7254) => { const _0x1d894c = _0x5baba0; if (_0x3d7254[_0x1d894c(0x290)] !== _0x59ee53['localPlayer'][_0x1d894c(0x290)]) return; this[_0x1d894c(0x29a)](_0x1d894c(0x20d)); } }; } [_0x3afe64(0x1d5)](_0x201fc0) { const _0x3ec301 = _0x3afe64; if (this[_0x3ec301(0x2c2)]) this[_0x3ec301(0x228)](); if (this[_0x3ec301(0x257)]) this['resetTimer'](); for (const [_0x5e4c17, _0x5d935b] of Object[_0x3ec301(0x27d)](_0x201fc0)) { if (_0x5e4c17 === 'type') continue; if (['positions', _0x3ec301(0x20f), _0x3ec301(0x22d), 'spectator', _0x3ec301(0x26d), _0x3ec301(0x2d2), 'specDim', _0x3ec301(0x1eb), _0x3ec301(0x2ba), 'password', _0x3ec301(0x279)][_0x3ec301(0x20b)](_0x5e4c17)) { if (['positions', _0x3ec301(0x26d), 'dimensions', _0x3ec301(0x2ba)]['includes'](_0x5e4c17)) this[_0x5e4c17] = _0x5d935b; else this[_0x3ec301(0x28e)][_0x5e4c17] = _0x5d935b; } } } [_0x3afe64(0x23b)](_0x1f8afa) { const _0x141e02 = _0x3afe64; this[_0x141e02(0x1da)] = _0x1f8afa, this[_0x141e02(0x21a)](), this['pendingTimeout'] && (clearTimeout(this[_0x141e02(0x2b7)]), this[_0x141e02(0x2b7)] = null), this[_0x141e02(0x28f)] && this[_0x141e02(0x2c9)] && this[_0x141e02(0x1da)][_0x141e02(0x236)](_0x141e02(0x23c) + this[_0x141e02(0x2c9)] + '\x22')[_0x141e02(0x2b1)](() => { }); } ['destroy'](_0x56df92 = 'success') { const _0xee092 = _0x3afe64, _0x1a65f4 = this['worldName']; this[_0xee092(0x238)](_0xee092(0x1f6) + _0x56df92), this['stop_roop'] = !![]; this[_0xee092(0x2b7)] && (clearTimeout(this[_0xee092(0x2b7)]), this[_0xee092(0x2b7)] = null); this['maxRuntimeTimeout'] && (clearTimeout(this['maxRuntimeTimeout']), this[_0xee092(0x2e6)] = null); const _0x3c0ac5 = msgpack['encode']({ 't': 'stop', 'type': _0xee092(0x224) }); this[_0xee092(0x2be)] && (this[_0xee092(0x2be)][_0xee092(0x1ea)](_0x3c0ac5), this['relayWs'][_0xee092(0x291)](), this[_0xee092(0x2be)] = null); this['localClient'] && (this['localClient'][_0xee092(0x291)](), this[_0xee092(0x20e)] = null); this[_0xee092(0x2a1)] && (this[_0xee092(0x2a1)]['end'](), this[_0xee092(0x2a1)] = null); this[_0xee092(0x2e5)] = null, this[_0xee092(0x2a5)] = null, this['directVcClients'][_0xee092(0x2ac)](_0x36ece6 => _0x36ece6[_0xee092(0x291)]()), this['directVcClients'][_0xee092(0x29b)](); if (typeof this['cleanOldTags'] === _0xee092(0x2d0)) this[_0xee092(0x1f4)]()[_0xee092(0x29c)](() => { const _0x529b0c = _0xee092; sessionHistory['set'](this['id'], { 'reason': _0x56df92, 'timestamp': Date[_0x529b0c(0x267)]() }), sessions['delete'](this[_0x529b0c(0x1da)]), pendingSessions['delete'](this['id']); }); else { sessionHistory[_0xee092(0x229)](this['id'], { 'reason': _0x56df92, 'timestamp': Date[_0xee092(0x267)]() }); if (sessionHistory[_0xee092(0x261)] > 0x64) { const _0x11f3bc = sessionHistory[_0xee092(0x253)]()[_0xee092(0x223)]()['value']; sessionHistory['delete'](_0x11f3bc); } sessions[_0xee092(0x26b)](this['world']), pendingSessions[_0xee092(0x26b)](this['id']); } } } const sessions = new Map(), pendingSessions = new Map(), sessionHistory = new Map(); async function main() { const _0x5acffd = _0x3afe64; let _0x3a192e = INITIAL_CONFIG[_0x5acffd(0x251)], _0x140f7e = INITIAL_CONFIG['web_port']; _0x3a192e = await getPort({ 'port': [_0x3a192e, ...makeRange(0x4abd, 0x4b20)] }), _0x140f7e = await getPort({ 'port': [_0x140f7e, ...makeRange(0x1f41, 0x1fa4)] }), console[_0x5acffd(0x1d9)](_0x5acffd(0x226) + _0x3a192e), console[_0x5acffd(0x1d9)](_0x5acffd(0x26c) + _0x140f7e), INITIAL_CONFIG['port'] = _0x3a192e, INITIAL_CONFIG[_0x5acffd(0x26e)] = _0x140f7e, globalConfig[_0x5acffd(0x251)] = _0x3a192e, globalConfig['web_port'] = _0x140f7e, setupGlobalVcWebSocket(_0x140f7e); const _0xd24b8c = express(), _0x2c2787 = http['createServer'](_0xd24b8c); _0x2c2787[_0x5acffd(0x2e9)](_0x3a192e); const _0x970128 = new Server({ 'webSocketOptions': { 'server': _0x2c2787 } }); _0xd24b8c[_0x5acffd(0x203)](express[_0x5acffd(0x220)]()), _0xd24b8c[_0x5acffd(0x249)]('/api/start_session', async (_0x218b10, _0x113397) => { const _0x1f4607 = _0x5acffd; try { const _0xf32a2f = _0x218b10[_0x1f4607(0x1e1)]['config'] || {}, _0x24d476 = new Session(null, _0xf32a2f); await _0x24d476[_0x1f4607(0x24d)](), pendingSessions[_0x1f4607(0x229)](_0x24d476['id'], _0x24d476), _0x113397[_0x1f4607(0x220)]({ 'sessionId': _0x24d476['id'], 'roomId': _0x24d476[_0x1f4607(0x2c9)], 'connectCommand': _0x24d476[_0x1f4607(0x24a)] }), _0x24d476[_0x1f4607(0x2c6)](); } catch (_0x517161) { console['error'](_0x517161), _0x113397[_0x1f4607(0x262)](0x1f4)['json']({ 'error': _0x517161['message'] }); } }), _0xd24b8c[_0x5acffd(0x249)](_0x5acffd(0x2a8), (_0x40b98b, _0x247522) => { const _0x108431 = _0x5acffd, { sessionId: _0x1b72c1 } = _0x40b98b[_0x108431(0x1e1)], _0x3e1474 = pendingSessions[_0x108431(0x27b)](_0x1b72c1) || Array[_0x108431(0x26a)](sessions[_0x108431(0x242)]())[_0x108431(0x23f)](_0x6a3975 => _0x6a3975['id'] === _0x1b72c1); _0x3e1474 ? (_0x3e1474[_0x108431(0x29a)]('streamlit\x20stop'), _0x247522['json']({ 'success': !![] })) : _0x247522[_0x108431(0x262)](0x194)['json']({ 'error': _0x108431(0x1e2) }); }), _0xd24b8c[_0x5acffd(0x27b)](_0x5acffd(0x280), (_0xe4eb9d, _0x578a8d) => { const _0x388817 = _0x5acffd, _0xee211a = _0xe4eb9d['params']['id'], _0x5255b4 = pendingSessions[_0x388817(0x27b)](_0xee211a) || Array['from'](sessions[_0x388817(0x242)]())[_0x388817(0x23f)](_0x5b28f9 => _0x5b28f9['id'] === _0xee211a); if (_0x5255b4) _0x578a8d[_0x388817(0x220)]({ 'status': _0x388817(0x1f1), 'sshError': _0x5255b4[_0x388817(0x268)] }); else { if (sessionHistory['has'](_0xee211a)) { const _0x30483e = sessionHistory[_0x388817(0x27b)](_0xee211a); _0x578a8d[_0x388817(0x220)]({ 'status': 'ended', 'reason': _0x30483e[_0x388817(0x2bf)], 'timestamp': _0x30483e[_0x388817(0x1e7)] }); } else _0x578a8d['json']({ 'status': _0x388817(0x1d6) }); } }); const _0x2e3dab = (_0x253858, _0x122dbf) => { const _0x5395df = _0x5acffd, { type: _0x1e8f34 } = _0x253858[_0x5395df(0x1e1)], _0x7e1b4e = _0x253858[_0x5395df(0x298)][_0x5395df(0x2c3)]; let _0x75f8a9 = null; if (_0x7e1b4e) { for (const _0xad5627 of sessions[_0x5395df(0x242)]()) { const _0x5561d6 = _0xad5627[_0x5395df(0x28e)][_0x5395df(0x2dd)]; if (_0x5561d6 && _0x7e1b4e[_0x5395df(0x2dc)](_0x5561d6)) { _0x75f8a9 = _0xad5627; break; } } if (!_0x75f8a9) for (const _0x53baee of pendingSessions[_0x5395df(0x242)]()) { const _0x246f4b = _0x53baee[_0x5395df(0x28e)][_0x5395df(0x2dd)]; if (_0x246f4b && _0x7e1b4e[_0x5395df(0x2dc)](_0x246f4b)) { _0x75f8a9 = _0x53baee; break; } } } if (_0x75f8a9) { if (_0x1e8f34 === 'data_update') _0x75f8a9[_0x5395df(0x1d5)](_0x253858[_0x5395df(0x1e1)]); else { if (_0x1e8f34 === _0x5395df(0x246)) _0x75f8a9['destroy']('disconnect\x20command'); } _0x1e8f34 === 'initialization' ? (_0x75f8a9['vc_connected'] = !![], _0x75f8a9[_0x5395df(0x238)](_0x5395df(0x256)), _0x122dbf['status'](0xc8)[_0x5395df(0x220)]({ 'type': 'initialization', 'roomId': _0x75f8a9[_0x5395df(0x2c9)], 'ws_connected': _0x75f8a9['mc_connected'], ..._0x75f8a9[_0x5395df(0x28e)] })) : _0x122dbf[_0x5395df(0x262)](0xc8)['json']({ 'success': !![] }); } else { sessions[_0x5395df(0x2ac)](_0x19660b => { const _0x2de7dd = _0x5395df; if (_0x1e8f34 === _0x2de7dd(0x227)) _0x19660b[_0x2de7dd(0x1d5)](_0x253858['body']); else { if (_0x1e8f34 === _0x2de7dd(0x246)) _0x19660b['destroy'](_0x2de7dd(0x20d)); } }); const _0x117f84 = sessions['values']()['next']()[_0x5395df(0x1d3)] || pendingSessions['values']()[_0x5395df(0x223)]()[_0x5395df(0x1d3)]; _0x117f84 ? _0x1e8f34 === _0x5395df(0x2da) ? (_0x117f84['vc_connected'] = !![], _0x117f84['logInfo'](_0x5395df(0x256)), _0x122dbf[_0x5395df(0x262)](0xc8)['json']({ 'type': _0x5395df(0x2da), 'roomId': _0x117f84['roomId'], 'ws_connected': _0x117f84[_0x5395df(0x2e2)], ..._0x117f84[_0x5395df(0x28e)] })) : _0x122dbf[_0x5395df(0x262)](0xc8)['json']({ 'success': !![] }) : _0x122dbf[_0x5395df(0x262)](0xc8)[_0x5395df(0x220)]({ 'error': _0x5395df(0x1f7) }); } }; _0xd24b8c['post']('/', _0x2e3dab), _0x970128['on'](ServerEvent[_0x5acffd(0x29f)], ({ world: _0xcf6868 }) => { const _0x359e9b = _0x5acffd, _0x5ed649 = _0xcf6868[_0x359e9b(0x296)], _0x3c8580 = _0xcf6868[_0x359e9b(0x2b4)]; let _0x4f865a = Array[_0x359e9b(0x26a)](sessions[_0x359e9b(0x242)]())['find'](_0x74762a => _0x74762a['id'] === _0x5ed649); !_0x4f865a && _0x5ed649 && (_0x4f865a = pendingSessions[_0x359e9b(0x27b)](_0x5ed649)); if (!_0x4f865a && _0x3c8580) { _0x4f865a = Array[_0x359e9b(0x26a)](pendingSessions[_0x359e9b(0x242)]())[_0x359e9b(0x23f)](_0x304961 => { const _0x4bf4bc = _0x359e9b, _0x29dd15 = _0x304961['config'][_0x4bf4bc(0x2dd)]; if (_0x29dd15 && _0x3c8580[_0x4bf4bc(0x2dc)](_0x29dd15)) return !![]; return ![]; }); if (_0x4f865a) { } } if (_0x4f865a) pendingSessions[_0x359e9b(0x25e)](_0x4f865a['id']) && pendingSessions[_0x359e9b(0x26b)](_0x4f865a['id']), sessions[_0x359e9b(0x229)](_0xcf6868, _0x4f865a), _0x4f865a['bindWorld'](_0xcf6868); else { if (_0x3c8580 && INITIAL_CONFIG['sub_domain'] && !_0x3c8580[_0x359e9b(0x2dc)](INITIAL_CONFIG[_0x359e9b(0x2dd)])) { console[_0x359e9b(0x235)](_0x359e9b(0x2ee) + _0x3c8580 + '\x27'); return; } _0x4f865a = new Session(_0xcf6868), sessions['set'](_0xcf6868, _0x4f865a), _0x4f865a['init'](); } }), _0x970128['on'](ServerEvent[_0x5acffd(0x230)], ({ world: _0x2453ad }) => { const _0x5c3c58 = _0x5acffd, _0x680d9d = sessions[_0x5c3c58(0x27b)](_0x2453ad); if (_0x680d9d) { sessions[_0x5c3c58(0x26b)](_0x2453ad); !pendingSessions[_0x5c3c58(0x25e)](_0x680d9d['id']) && pendingSessions['set'](_0x680d9d['id'], _0x680d9d); if (_0x680d9d[_0x5c3c58(0x2b7)]) clearTimeout(_0x680d9d[_0x5c3c58(0x2b7)]); _0x680d9d['pendingTimeout'] = setTimeout(() => { const _0x546c48 = _0x5c3c58; pendingSessions[_0x546c48(0x25e)](_0x680d9d['id']) && _0x680d9d[_0x546c48(0x29a)](_0x546c48(0x1f5)); }, 0x7530); } }), _0x970128['on'](ServerEvent['PlayerChat'], async ({ sender: _0x299de2, message: _0xc16130, world: _0x32f90c }) => { const _0x227b86 = _0x5acffd, _0x4187e4 = sessions['get'](_0x32f90c); if (_0x4187e4) { const [_0x50b103, ..._0x4bebe0] = _0xc16130[_0x227b86(0x213)]('\x20'); if (_0x4187e4[_0x227b86(0x22e)][_0x50b103]) await _0x4187e4[_0x227b86(0x22e)][_0x50b103](_0x32f90c, _0x299de2, _0x4bebe0); } }), _0x970128['on'](ServerEvent[_0x5acffd(0x2e7)], async ({ player: _0x19ed65, world: _0x451585 }) => { const _0x24ce64 = _0x5acffd, _0x35b605 = sessions[_0x24ce64(0x27b)](_0x451585); _0x35b605 && (_0x35b605[_0x24ce64(0x238)]('参加:\x20' + _0x19ed65[_0x24ce64(0x290)]), _0x35b605[_0x24ce64(0x254)][_0x24ce64(0x1d2)](_0x19ed65[_0x24ce64(0x290)]), setTimeout(async () => { const _0x4e9a8b = _0x24ce64; try { const _0x29196d = _0x35b605[_0x4e9a8b(0x260)](_0x19ed65[_0x4e9a8b(0x290)]), { roomId: _0x693732, passwords: _0x2648bf, config: _0x1b93a8 } = _0x35b605; await _0x19ed65['sendMessage'](_0x35b605['t'](_0x4e9a8b(0x25c), { 'roomId': _0x693732, 'vcname': _0x29196d })); if (_0x1b93a8[_0x4e9a8b(0x2e0)]) { if (!_0x2648bf[_0x29196d]) _0x2648bf[_0x29196d] = Math[_0x4e9a8b(0x2ce)](0x3e8 + Math[_0x4e9a8b(0x2c0)]() * 0x2328)[_0x4e9a8b(0x25f)](); await _0x19ed65[_0x4e9a8b(0x23e)](_0x35b605['t'](_0x4e9a8b(0x244), { 'password': _0x2648bf[_0x29196d] })); } } catch (_0x1fc1f8) { } }, 0x1f4)); }), _0x970128['on'](ServerEvent[_0x5acffd(0x1ff)], ({ player: _0x2c3147, world: _0x27f316 }) => { const _0x7b8064 = _0x5acffd, _0x555588 = sessions['get'](_0x27f316); if (_0x555588) { _0x555588[_0x7b8064(0x238)](_0x7b8064(0x1fb) + _0x2c3147[_0x7b8064(0x290)]); _0x2c3147[_0x7b8064(0x290)] === _0x27f316[_0x7b8064(0x2f3)][_0x7b8064(0x290)] && (_0x555588['logInfo'](_0x7b8064(0x232)), _0x555588[_0x7b8064(0x29a)](_0x7b8064(0x2e1))); _0x555588[_0x7b8064(0x254)]['delete'](_0x2c3147[_0x7b8064(0x290)]); const _0x128fa8 = _0x555588[_0x7b8064(0x260)](_0x2c3147[_0x7b8064(0x290)]); delete _0x555588['positions'][_0x128fa8], delete _0x555588[_0x7b8064(0x1eb)][_0x128fa8], delete _0x555588['yRots'][_0x128fa8], delete _0x555588[_0x7b8064(0x26d)][_0x128fa8]; } }), _0x970128['on'](ServerEvent[_0x5acffd(0x241)], ({ player: _0x54b5a8, world: _0x500f7d }) => { const _0x153cd1 = _0x5acffd, _0x4e50fc = sessions[_0x153cd1(0x27b)](_0x500f7d); if (!_0x4e50fc || !_0x54b5a8 || !_0x54b5a8['position']) return; const _0x3d77c8 = _0x4e50fc[_0x153cd1(0x260)](_0x54b5a8[_0x153cd1(0x290)]); _0x4e50fc[_0x153cd1(0x293)][_0x3d77c8] = { 'x': _0x54b5a8['position']['x'], 'y': _0x54b5a8[_0x153cd1(0x25d)]['y'], 'z': _0x54b5a8[_0x153cd1(0x25d)]['z'] }; if (_0x54b5a8[_0x153cd1(0x214)] !== undefined) _0x4e50fc['yRots'][_0x3d77c8] = _0x54b5a8['yRot']; if (_0x54b5a8['dimension'] !== undefined) _0x4e50fc[_0x153cd1(0x1eb)][_0x3d77c8] = _0x54b5a8['dimension']; }); if (!process['argv'][_0x5acffd(0x20b)](_0x5acffd(0x1f8))) try { const _0x493e1d = new Session(null, globalConfig); await _0x493e1d['startWebSession'](), pendingSessions[_0x5acffd(0x229)](_0x493e1d['id'], _0x493e1d); } catch (_0x4d0eae) { console['error']('[Standalone]\x20Failed\x20to\x20start\x20session:', _0x4d0eae); } else try { fs[_0x5acffd(0x2d5)](_0x5acffd(0x2ec), JSON['stringify']({ 'port': _0x3a192e, 'web_port': _0x140f7e }, null, 0x2)); } catch (_0x650532) { console[_0x5acffd(0x26f)]('Failed\x20to\x20write\x20server_info.json:', _0x650532); } } process['on']('SIGINT', () => { const _0x343071 = _0x3afe64; sessions[_0x343071(0x2ac)](_0x47b2a8 => _0x47b2a8['destroy'](_0x343071(0x2e1))), process['exit'](); }), main();