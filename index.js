const _0x11ab8e = _0x2ec5; (function (_0x200b43, _0x3cd190) { const _0x4b0d8a = _0x2ec5, _0x1b3f35 = _0x200b43(); while (!![]) { try { const _0xbb182b = -parseInt(_0x4b0d8a(0x220)) / 0x1 + -parseInt(_0x4b0d8a(0x2ad)) / 0x2 + parseInt(_0x4b0d8a(0x1b3)) / 0x3 * (parseInt(_0x4b0d8a(0x1d1)) / 0x4) + parseInt(_0x4b0d8a(0x2aa)) / 0x5 + parseInt(_0x4b0d8a(0x224)) / 0x6 * (-parseInt(_0x4b0d8a(0x215)) / 0x7) + -parseInt(_0x4b0d8a(0x1f8)) / 0x8 * (parseInt(_0x4b0d8a(0x1c7)) / 0x9) + parseInt(_0x4b0d8a(0x1b8)) / 0xa; if (_0xbb182b === _0x3cd190) break; else _0x1b3f35['push'](_0x1b3f35['shift']()); } catch (_0x2a48ae) { _0x1b3f35['push'](_0x1b3f35['shift']()); } } }(_0xef7e, 0x21dc7)); const { Server, ServerEvent } = require(_0x11ab8e(0x2a2)), WebSocket = require('ws'), fetch = require('node-fetch'), wanakana = require('wanakana'), fs = require('fs'), fsPromises = require('fs')['promises'], JSON5 = require(_0x11ab8e(0x1b5)), getPort = require(_0x11ab8e(0x1b2)), { Client } = require(_0x11ab8e(0x1db)), net = require(_0x11ab8e(0x1a6)), express = require(_0x11ab8e(0x2b2)), http = require(_0x11ab8e(0x1e1)), path = require(_0x11ab8e(0x1ff)), { performance } = require('perf_hooks'), zlib = require(_0x11ab8e(0x239)), msgpack = require(_0x11ab8e(0x2af)), { randomUUID } = require('crypto'), RELAY_SERVER_DOMAIN = _0x11ab8e(0x223), TIMEOUT_THRESHOLD = 0x3, INACTIVITY_TIMEOUT = 0x5 * 0x3c * 0x3e8, MAX_RUNTIME = 0x4 * 0x3c * 0x3c * 0x3e8, configCandidates = [_0x11ab8e(0x260), _0x11ab8e(0x22b), _0x11ab8e(0x231)]; function _0xef7e() { const _0x1f7b6b = ['set', '§cDisabled§r', 'startTimer', 'disabled', 'sendInitMessage', '§c[MCBE\x20Prox\x20VC]\x20時間制限のため終了します。', 'aliveSet', 'setupMcRelayListeners', '❌\x20設定ファイルの更新に失敗しました:', '\x1b[36m[Info]\x1b[0m\x20Webサーバーのポート:\x20', 'data', 'localhost', 'Spectator\x27s\x20VC\x20set\x20to\x20common\x20in\x20all\x20dimensions', 'params', 'minecraft', 'encode', 'string', '\x0aSpectator\x20Split:\x20', 'yRots', 'ROOM\x20ID:\x20', 'searchParams', 'dimension', 'resetTimer', './config.jsonc', 'Proximity\x20Voice\x20Chat\x20Gateway\x20Active', 'localPlayer', 'playersNames', 'filter', 'all', 'ホスト専用コマンド：\x0a\x20!config\x20-\x20現在の設定一覧を表示します\x0a\x20!lang\x20-\x20!lang\x20<ja/en>\x20lang\x20change\x0a\x20!dis\x20-\x20!dis\x20<数値>\x20で声の届く距離を変更できます\x0a\x20!pvc\x20-\x20!pvc\x20<§atrue§r/§cfalse§r>\x20で近接vcを有効/無効にできます', '認証コードを有効にしました', 'sendInitialPayload', 'url', 'handleDirectVcConnection', '\x0a\x20-\x20Spectator\x20Listen:\x20', 'substring', '=======================================================\x0a', 'toRomaji', 'end', 'sendMessage', 'loop', '\x20Error:', 'SIGINT', 'testfor\x20@e[type=player]', 'writeFileSync', 'split', 'startsWith', '\x20!verify\x20-\x20!verify\x20<§atrue§r/§cfalse§r>\x20で認証コードを有効/無効にできます\x0a\x20!spectator\x20-\x20!spectator\x20<§atrue§r/§cfalse§r>\x20でスペクテイターとVCを分けます', '\x22]\x20remove\x20\x22', 'スペクテイター同士の会話を共通にしました', 'Switched\x20to\x20relay\x20mode.\x0aRoom\x20ID:\x20', '\x0aProximity\x20VC:\x20', '\x20HTTP/', 'tag\x20@a[tag=\x22', 'dataUpdate', 'remotePort', 'スペクテイターとVCを分けました', '認証コードを無効にしました', 'PlayerTransform', 'values', '[VC\x20Relay]', 'pvc:', 'distance', 'スペクテイターが他モードプレイヤーの会話を聞けなくなりました', '近接vcを無効にしました', '§l[Current\x20Settings]§r\x0aLanguage:\x20', 'shouldBroadcast', '\x1b[33m[Log][', 'Spectator\x20set\x20to\x20common\x20VC', 'details', 'forEach', 'specDim', 'trim', 'connectToRelayServer', 'clientType', 'tag\x20@a\x20list', 'headers', 'Minecraftから以下のコマンドで接続してください:', 'size', '\x0aYour\x20VCname\x20is\x20', 'WorldRemove', 'web_port', 'log', 'Settings\x20effective\x20only\x20when\x20\x22spectator\x22\x20is\x20true\x20:\x20\x0a\x20!specListen\x20-\x20!specListen\x20<§atrue§r/§cfalse§r>\x20Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players\x0a\x20!specDim\x20-\x20!specDim\x20<§atrue§r/§cfalse§r>\x20Spectator`s\x20VC\x20separated\x20by\x20dimension', 'post', 'find', 'pvcSessionId', 'handleUpgrade', 'toString', './lib/server', 'spectator', 'disconnect_command', 'gunzipSync', 'verify', 'round', 'consecutiveTimeouts', '接続を開始しました\x0a近接vc：', '769630zdOrxP', 'runCommand', '[SSH]中継サーバーを使用します', '197102oYtJSG', 'パスワードは', 'msgpack-lite', 'ready', 'now', 'express', 'host', 'dimensions', 'Proximity\x20VC\x20disabled', 'data_update', 'server_shutdown', 'Password\x20is\x20', '\x22\x5cs*:\x5cs*)(?:\x22.*?\x22|\x5cd+\x5c.?\x5cd*|true|false)', 'partner_connected', 'not_found', 'destroy', 'shift', 'value', 'position', '\x1b[36m[Info][', 'PlayerLeave', 'Host-only\x20command\x20:\x20\x0a\x20!config\x20-\x20Show\x20current\x20settings\x0a\x20!lang\x20-\x20!lang\x20<ja/en>\x20change\x20language\x0a\x20!dis\x20-\x20!dis\x20<Number>\x20set\x20max\x20distance\x0a\x20!pvc\x20-\x20!pvc\x20<§atrue§r/§cfalse§r>\x20enable/disable\x20proximity\x20voice\x20chat', 'Changed\x20max\x20distance\x20to\x20', '\x0a!help\x20でコマンド一覧を確認できます', 'cleanOldTags', 'json', 'setupVcRelayListeners', 'getAllTags', 'stop_roop', 'entries', 'vc_connected', 'initialization', '/connect\x20', 'localAddr', 'message', 'createConnection', '--streamlit', 'testfor\x20@a', 'sub_domain', 'mcSshClient', 'port', 'relayWs', 'createCommands', 'decode', 'tag\x20@s\x20add\x20\x22pvc:roomId=', 'maxRuntimeTimeout', 'directVcClients', 'world', 'password', 'logInfo', '/pvc:connect\x20\x22', 'partner_disconnected', 'utf8', 'close', '--------------------', 'Using\x20Proximity\x20Voice\x20Chat\x0aURL:https://mcproxvc.ovh/connect/\x0aRoomID\x20is\x20', 'keys', 'relayed_vc_data', 'active', 'Participants\x20should\x20access\x20this\x20URL', 'map', 'commands', 'Spectator\x20and\x20VC\x20separated', 'onlinePlayers', 'send', 'net', 'stringify', 'mc_connected', 'victim', 'function', 'No\x20active\x20sessions', '[Config]\x20Error\x20parsing\x20', 'timeout', 'writeFile', 'コマンド一覧：\x0a\x20!help\x20-\x20ヘルプを表示します\x0a\x20!name\x20-\x20VCで使うゲーマータグを確認できます', 'wss://', 'sshClient', 'get-port', '42MbYyUV', ']\x1b[0m\x20', 'json5', 'forwardIn', '❌\x20SSH\x20Error\x20(', '1924070TwJNyI', 'includes', 'readyState', 'http://', '常時接続する場合は以下のコマンドを実行してください:', '/api/session_status/:id', 'roomId', ']\x20最大稼働時間に達しました。', 'Session\x20destroying...\x20Reason:\x20', 'です\x0aあなたのVCnameは', 'Session\x20not\x20found\x20for\x20this\x20domain', 'OPEN', 'connect', 'catch', 'delete', '46269WFVidf', 'logLog', '\x1b[36m[Info]\x1b[0m\x20socket-beサーバーのポート:\x20', 'body', 'Room\x20ID:\x20', '[Config]\x20No\x20configuration\x20file\x20found.\x20Using\x20default\x20settings.', '[Relay]\x20Connected\x20(ID:\x20', 'action', '\x0a\x20-\x20Spectator\x20Dimension:\x20', 'enabled', '36092VtkAyE', '[Standalone]\x20Failed\x20to\x20start\x20session:', 'error', 'parse', 'verify\x20code\x20enabled', '§c無効§r', 'vcSshClient', 'proximity', 'listen', 'useRelay', 'ssh2', 'querytarget\x20@e[type=player]', '§a有効§r', 'リレーモードに切り替わりました。\x0aRoom\x20ID:\x20', '近接vcを有効にしました', 'https://', 'http', 'Spectator\x27s\x20VC\x20separated\x20by\x20dimension', 'Server', 'pipe', 'ended', '[SSH]❌\x20ポートフォワーディング失敗\x20(', 'type', 'startWebSession', '[Connection]\x20Rejected\x20connection\x20for\x20domain\x20\x27', 'from', '[MC\x20Relay]', 'stop', '近接VCを使用中です\x0aURL:https://mcproxvc.ovh/connect/\x0aルームIDは', 'testfor\x20@a[m=spectator]', 'スペクテイターを共通のVCにしました', 'command_result', '\x20!verify\x20-\x20!verify\x20<§atrue§r/§cfalse§r>\x20enable/disable\x20verify\x20code\x0a\x20!spectator\x20-\x20!spectator\x20<§atrue§r/§cfalse§r>\x20separate\x20spectator\x20and\x20VC', 'readFileSync', 'Proximity\x20VC\x20enabled', '/room/', 'Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:', 'localClient', '\x0a=======================================================', '40mNTpHc', 'useResetTimer', 'server_info.json', 'remoteAddr', 'Connection\x20started\x0aProximity\x20voice\x20chat:', '§c[MCBE\x20Prox\x20VC]\x20Time\x20limit\x20reached.', 'broadcastPositions', 'path', 'URL:https://mcproxvc.ovh/connect/\x0aルームIDは', 'WorldAdd', 'userName', '\x0a!help\x20for\x20command\x20list', '[Auto-Stop][', 'PlayerChat', '/api/stop_session', 'length', 'config', 'indexOf', '.tcpexposer.com', 'Command\x20list:\x0a\x20!help\x20-\x20show\x20help\x0a\x20!name\x20-\x20check\x20your\x20VC\x20GamerTag', 'inactivityTimer', '退出:\x20', 'test', '.tcpexposer.com\x22', 'passwords', 'status', '§r\x0aVerify\x20Code:\x20', '§l[現在の設定一覧]§r\x0a言語\x20(Lang):\x20', 'yRot', '7QRZoxU', 'get', 'spectators', 'localClientBuffer', '\x0a近接VC\x20(Proximity):\x20', 'tcpexposer.com', 'name', 'has', 'method', '\x0aMax\x20distance:', 'スペクテイター同士の会話をディメンションごとに分けました', '185023dKeGqT', '\x0a最大距離\x20(Distance):\x20§e', 'connectCommand', 'mcproxvc.fly.dev', '148086oupXwi', 'statusMessage', 'reason', 'ssh_failed', 'positions', 'lang', 'spectatorSet', './config.json5', 'specListen', 'Failed\x20to\x20write\x20server_info.json:', 'run_command', '§aEnabled§r', '<Proximity\x20VC>Language\x20set\x20to\x20English', './config.json', 'existsSync', 'add', 'init', 'verify\x20code\x20disabled', 'players', 'replace', 'に変更しました', 'zlib', 'success', 'Unknown\x20World', 'bindWorld', 'next', 'warn', 'clear', 'worldName', '接続開始', '§r\x0a認証コード\x20(Verify):\x20', 'true', '\x0aMax\x20Distance:\x20§e', 'sshError', '\x0a\x20-\x20ディメンション毎にVCを分ける\x20(Dim):\x20', 'pendingTimeout', 'open']; _0xef7e = function () { return _0x1f7b6b; }; return _0xef7e(); } let globalConfig = {}, configLoaded = ![], configPath = ''; for (const filePath of configCandidates) { if (fs[_0x11ab8e(0x232)](filePath)) try { const fileContent = fs[_0x11ab8e(0x1f2)](filePath, _0x11ab8e(0x199)); globalConfig = JSON5[_0x11ab8e(0x1d4)](fileContent), configLoaded = !![], configPath = filePath; break; } catch (_0x429a22) { console['error'](_0x11ab8e(0x1ac) + filePath + ':', _0x429a22[_0x11ab8e(0x187)]); } } !configLoaded && console[_0x11ab8e(0x23e)](_0x11ab8e(0x1cc)); const DEFAULT_CONFIG = { 'app_id': '', 'secret_key': '', 'username': '', 'sub_domain': '', 'ssh_password': '', 'port': 0x4abc, 'web_port': 0x1f40, 'proximity': !![], 'spectator': !![], 'specListen': !![], 'specDim': ![], 'password': ![], 'verify': undefined, 'distance': 0xa, 'lang': 'en' }, INITIAL_CONFIG = { ...DEFAULT_CONFIG, ...globalConfig }; INITIAL_CONFIG[_0x11ab8e(0x195)] = INITIAL_CONFIG[_0x11ab8e(0x2a6)] ?? INITIAL_CONFIG['password']; const nameCache = new Map(), processName = _0x38acd5 => { const _0x35a85f = _0x11ab8e; if (!nameCache['has'](_0x38acd5)) { const _0x38f3b0 = wanakana[_0x35a85f(0x26e)](_0x38acd5[_0x35a85f(0x237)](/ /g, '_'))['replace'](/n'/g, 'n'); nameCache[_0x35a85f(0x249)](_0x38acd5, _0x38f3b0); } return nameCache[_0x35a85f(0x216)](_0x38acd5); }; async function updateConfigFile(_0x5c98d8, _0x25b7e6) { const _0xaca2c4 = _0x11ab8e; if (!configPath) return; try { let _0x175456 = await fsPromises['readFile'](configPath, _0xaca2c4(0x199)); const _0x472361 = new RegExp('(\x22' + _0x5c98d8 + _0xaca2c4(0x2b9)), _0x1d6983 = typeof _0x25b7e6 === _0xaca2c4(0x259) ? '\x22' + _0x25b7e6 + '\x22' : _0x25b7e6, _0x375469 = _0x175456[_0xaca2c4(0x237)](_0x472361, '$1' + _0x1d6983); _0x375469 !== _0x175456 && await fsPromises[_0xaca2c4(0x1ae)](configPath, _0x375469, _0xaca2c4(0x199)); } catch (_0x7cd363) { console[_0xaca2c4(0x1d3)](_0xaca2c4(0x251), _0x7cd363); } }; const makeRange = (_0x30ac62, _0x2fe5c5) => Array[_0x11ab8e(0x1ea)]({ 'length': _0x2fe5c5 - _0x30ac62 + 0x1 }, (_0xe1338e, _0x19f1c9) => _0x30ac62 + _0x19f1c9); let globalGatewayServer = null; function _0x2ec5(_0x2fc563, _0x5aa4f7) { _0x2fc563 = _0x2fc563 - 0x17f; const _0xef7ee2 = _0xef7e(); let _0x2ec521 = _0xef7ee2[_0x2fc563]; return _0x2ec521; } function startSshTunnel(_0x4617f9, _0xcebbb0, _0xdeafdf) { return new Promise(_0x233498 => { const _0x2a6bec = _0x2ec5, { username: _0x12d5c5, ssh_password: _0x51e990, lang: _0x569bf2 } = _0x4617f9[_0x2a6bec(0x208)]; if (!_0xcebbb0 || !_0x12d5c5 || !_0x51e990) { _0x233498(null); return; } const _0x52ff4d = { 'host': _0x2a6bec(0x21a), 'port': 0x16, 'username': _0x12d5c5, 'password': _0x51e990 }, _0x5edf38 = { 'remoteAddr': _0xcebbb0, 'remotePort': 0x50, 'localAddr': _0x2a6bec(0x254), 'localPort': _0xdeafdf }, _0x5a632a = new Client(); let _0x3f635d = ![]; const _0x45b765 = async _0x4d2a41 => { const _0x9bdb13 = _0x2a6bec; if (_0x3f635d) return; _0x3f635d = !![], console[_0x9bdb13(0x1d3)](_0x9bdb13(0x1b7) + _0xcebbb0 + '):', _0x4d2a41[_0x9bdb13(0x187)]), _0x4617f9[_0x9bdb13(0x245)] = _0x9bdb13(0x227), _0x4617f9[_0x9bdb13(0x196)](_0x9bdb13(0x2ac)), _0x4617f9[_0x9bdb13(0x1be)] = '', await _0x4617f9[_0x9bdb13(0x292)]('mc'), _0x5a632a[_0x9bdb13(0x26f)](), _0x233498(null); }; _0x5a632a['on'](_0x2a6bec(0x2b0), () => { const _0x3e036b = _0x2a6bec; _0x5a632a[_0x3e036b(0x1b6)](_0x5edf38[_0x3e036b(0x1fb)], _0x5edf38[_0x3e036b(0x280)], async _0x2b7953 => { const _0x2e14d3 = _0x3e036b; if (_0x2b7953) { console[_0x2e14d3(0x1d3)](_0x2e14d3(0x1e6) + _0xcebbb0 + '):', _0x2b7953[_0x2e14d3(0x187)]), _0x4617f9[_0x2e14d3(0x196)](_0x2e14d3(0x2ac)), await _0x45b765(_0x2b7953); return; } console[_0x2e14d3(0x29b)](_0x2e14d3(0x1f7)), _0x4617f9[_0x2e14d3(0x1da)] = ![], _0x4617f9[_0x2e14d3(0x183)] = !![], _0x4617f9[_0x2e14d3(0x196)](_0x2e14d3(0x1cb) + _0xcebbb0); if (_0x4617f9[_0x2e14d3(0x208)][_0x2e14d3(0x229)] === 'ja') _0x4617f9[_0x2e14d3(0x196)]('参加者はこのURLにアクセスしてください:'); else _0x4617f9[_0x2e14d3(0x196)](_0x2e14d3(0x1a0)); _0x4617f9[_0x2e14d3(0x196)]('https://mcproxvc.ovh/connect/?roomid=' + _0xcebbb0); if (_0x4617f9[_0x2e14d3(0x208)][_0x2e14d3(0x229)] === 'ja') _0x4617f9['logInfo'](_0x2e14d3(0x296)); else _0x4617f9['logInfo']('Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:'); _0x4617f9[_0x2e14d3(0x196)](_0x2e14d3(0x185) + _0xcebbb0 + _0x2e14d3(0x20a)), _0x4617f9[_0x2e14d3(0x222)] = _0x2e14d3(0x185) + _0xcebbb0 + _0x2e14d3(0x20a); if (_0x569bf2 === 'ja') _0x4617f9[_0x2e14d3(0x196)](_0x2e14d3(0x1bc)); else _0x4617f9['logInfo']('For\x20a\x20persistent\x20connection,\x20run\x20the\x20following\x20command:'); _0x4617f9[_0x2e14d3(0x196)](_0x2e14d3(0x197) + _0xcebbb0 + _0x2e14d3(0x20f)), console[_0x2e14d3(0x29b)]('=======================================================\x0a'), !_0x3f635d && (_0x3f635d = !![], _0x233498(_0x5a632a)); }), _0x5a632a['on']('tcp\x20connection', (_0x34fe27, _0x31979a) => { const _0x5e634f = _0x3e036b, _0x142f39 = _0x31979a(), _0x396295 = net[_0x5e634f(0x188)]({ 'host': _0x5edf38[_0x5e634f(0x186)], 'port': _0x5edf38['localPort'] }); _0x396295['on'](_0x5e634f(0x1c4), () => _0x142f39[_0x5e634f(0x1e4)](_0x396295)['pipe'](_0x142f39)), _0x396295['on'](_0x5e634f(0x1d3), _0x356b74 => { const _0x5d558e = _0x5e634f; _0x142f39[_0x5d558e(0x19a)](); }), _0x142f39['on'](_0x5e634f(0x19a), () => _0x396295[_0x5e634f(0x26f)]()); }); })['on']('error', _0x3ea2c0 => { _0x45b765(_0x3ea2c0); }), _0x5a632a['on'](_0x2a6bec(0x19a), () => { !_0x3f635d && (_0x3f635d = !![], _0x233498(null)); }), _0x5a632a[_0x2a6bec(0x1c4)](_0x52ff4d); }); } function setupGlobalVcWebSocket(_0x572713) { const _0x30e58a = _0x11ab8e; if (globalGatewayServer) return; const _0x11cfb4 = express(), _0x218b51 = http['createServer'](_0x11cfb4), _0x4d047a = new WebSocket[(_0x30e58a(0x1e3))]({ 'noServer': !![] }); _0x11cfb4['use'](express[_0x30e58a(0x2c6)]()), _0x11cfb4[_0x30e58a(0x29d)]('/', (_0x2ac823, _0x115c0c) => { const _0x452507 = _0x30e58a, { type: _0x45deb1 } = _0x2ac823[_0x452507(0x1ca)], _0xbd3cc6 = _0x2ac823[_0x452507(0x295)][_0x452507(0x2b3)]; let _0x37a142 = null; if (_0xbd3cc6) { for (const _0x42ec4c of sessions[_0x452507(0x284)]()) { const _0x2af305 = _0x42ec4c[_0x452507(0x208)][_0x452507(0x18b)]; if (_0x2af305 && _0xbd3cc6[_0x452507(0x277)](_0x2af305)) { _0x37a142 = _0x42ec4c; break; } } if (!_0x37a142) for (const _0x10feff of pendingSessions['values']()) { const _0x3fc355 = _0x10feff[_0x452507(0x208)][_0x452507(0x18b)]; if (_0x3fc355 && _0xbd3cc6['startsWith'](_0x3fc355)) { _0x37a142 = _0x10feff; break; } } } if (_0x37a142) { if (_0x45deb1 === _0x452507(0x2b6)) _0x37a142['dataUpdate'](_0x2ac823[_0x452507(0x1ca)]); else { if (_0x45deb1 === 'disconnect_command') _0x37a142[_0x452507(0x2bc)]('success'); } _0x45deb1 === 'initialization' ? (_0x37a142[_0x452507(0x183)] = !![], _0x37a142[_0x452507(0x196)](_0x452507(0x241)), _0x115c0c[_0x452507(0x211)](0xc8)[_0x452507(0x2c6)]({ 'type': 'initialization', 'roomId': _0x37a142[_0x452507(0x1be)], 'ws_connected': _0x37a142['mc_connected'], ..._0x37a142[_0x452507(0x208)] })) : _0x115c0c[_0x452507(0x211)](0xc8)['json']({ 'success': !![] }); } else _0x115c0c[_0x452507(0x211)](0x194)[_0x452507(0x2c6)]({ 'error': _0x452507(0x1c2) }); }), _0x11cfb4[_0x30e58a(0x216)]('/', (_0x7fcb08, _0x91900d) => { const _0x34541b = _0x30e58a; _0x91900d[_0x34541b(0x1a5)](_0x34541b(0x261)); }), _0x218b51['on']('upgrade', (_0x5ed3df, _0x5a90a9, _0x42affa) => { const _0x5bcd0b = _0x30e58a; let _0xe56185 = null, _0x106e89 = null; try { const _0x45a631 = _0x5ed3df[_0x5bcd0b(0x295)][_0x5bcd0b(0x2b3)] || _0x5bcd0b(0x254); let _0x69701f = _0x5ed3df[_0x5bcd0b(0x269)] || '/'; if (_0x69701f === '//') _0x69701f = '/'; _0x106e89 = new URL(_0x69701f, _0x5bcd0b(0x1bb) + _0x45a631), _0xe56185 = _0x106e89[_0x5bcd0b(0x25d)][_0x5bcd0b(0x216)]('clientType'); } catch (_0x44839d) { _0xe56185 = null; } if (_0xe56185 !== 'vc') { const _0x363e1c = net['createConnection']({ 'port': INITIAL_CONFIG[_0x5bcd0b(0x18d)], 'host': 'localhost' }); _0x363e1c['on'](_0x5bcd0b(0x1c4), () => { const _0x2064d7 = _0x5bcd0b, _0x18209a = _0x5ed3df[_0x2064d7(0x295)]['host'], _0x4f4837 = _0x5ed3df[_0x2064d7(0x21d)], _0x49c31e = _0x5ed3df[_0x2064d7(0x269)], _0x1c15ff = _0x5ed3df['httpVersion']; let _0x266a49 = _0x4f4837 + '\x20' + _0x49c31e + _0x2064d7(0x27d) + _0x1c15ff + '\x0d\x0a'; for (const [_0x304cf3, _0x594b6f] of Object[_0x2064d7(0x182)](_0x5ed3df['headers'])) { _0x266a49 += _0x304cf3 + ':\x20' + _0x594b6f + '\x0d\x0a'; } _0x266a49 += 'x-proxvc-domain:\x20' + _0x18209a + '\x0d\x0a', _0x266a49 += '\x0d\x0a', _0x363e1c['write'](_0x266a49), _0x42affa && _0x42affa[_0x2064d7(0x207)] > 0x0 && _0x363e1c['write'](_0x42affa), _0x5a90a9[_0x2064d7(0x1e4)](_0x363e1c), _0x363e1c[_0x2064d7(0x1e4)](_0x5a90a9); }), _0x363e1c['on'](_0x5bcd0b(0x1d3), _0x535332 => { _0x5a90a9['end'](); }), _0x363e1c['on'](_0x5bcd0b(0x19a), () => { const _0x5b7c82 = _0x5bcd0b; _0x5a90a9[_0x5b7c82(0x26f)](); }), _0x5a90a9['on'](_0x5bcd0b(0x1d3), _0xd9bb75 => { const _0x540ec4 = _0x5bcd0b; _0x363e1c[_0x540ec4(0x26f)](); }), _0x5a90a9['on'](_0x5bcd0b(0x19a), () => { const _0x51e76f = _0x5bcd0b; _0x363e1c[_0x51e76f(0x26f)](); }); } else _0x4d047a[_0x5bcd0b(0x2a0)](_0x5ed3df, _0x5a90a9, _0x42affa, _0x1dba6f => { const _0x443828 = _0x5bcd0b, _0xe86041 = _0x5ed3df[_0x443828(0x295)][_0x443828(0x2b3)]; let _0x1a3490 = null; if (_0xe86041) { for (const _0x1a84fc of sessions['values']()) { const _0xd927ed = _0x1a84fc[_0x443828(0x208)]['sub_domain']; if (_0xd927ed && _0xe86041[_0x443828(0x277)](_0xd927ed)) { _0x1a3490 = _0x1a84fc; break; } } if (!_0x1a3490) for (const _0x4fa1cc of pendingSessions[_0x443828(0x284)]()) { const _0x352208 = _0x4fa1cc[_0x443828(0x208)][_0x443828(0x18b)]; if (_0x352208 && _0xe86041[_0x443828(0x277)](_0x352208)) { _0x1a3490 = _0x4fa1cc; break; } } } if (_0x1a3490) _0x1a3490[_0x443828(0x26a)](_0x1dba6f); else { const _0x1bec8b = sessions['values']()['next']()[_0x443828(0x2be)] || pendingSessions[_0x443828(0x284)]()[_0x443828(0x23d)]()['value']; if (_0x1bec8b) _0x1bec8b[_0x443828(0x26a)](_0x1dba6f); else _0x1dba6f[_0x443828(0x19a)](); } }); }), _0x218b51[_0x30e58a(0x1d9)](_0x572713, () => { }), globalGatewayServer = _0x218b51; }; class Session { constructor(_0x2b70ca, _0xa90e2b = {}) { const _0x1b97ab = _0x11ab8e; this['id'] = randomUUID(), this[_0x1b97ab(0x194)] = _0x2b70ca, this['worldName'] = _0x2b70ca ? _0x2b70ca['name'] || _0x1b97ab(0x23b) : 'Pending\x20Session', this[_0x1b97ab(0x208)] = { ...INITIAL_CONFIG, ..._0xa90e2b }, this[_0x1b97ab(0x1be)] = this[_0x1b97ab(0x208)][_0x1b97ab(0x18b)], this['connectCommand'] = '', this[_0x1b97ab(0x210)] = {}, this[_0x1b97ab(0x228)] = {}, this[_0x1b97ab(0x25b)] = {}, this[_0x1b97ab(0x2b4)] = {}, this[_0x1b97ab(0x217)] = {}, this[_0x1b97ab(0x1a4)] = new Set(), this['shouldBroadcast'] = !![], this[_0x1b97ab(0x183)] = ![], this[_0x1b97ab(0x1a8)] = ![], this[_0x1b97ab(0x181)] = ![], this[_0x1b97ab(0x1da)] = ![], this[_0x1b97ab(0x1f9)] = ![], this[_0x1b97ab(0x18e)] = null, this['localClient'] = null, this[_0x1b97ab(0x193)] = new Set(), this[_0x1b97ab(0x1b1)] = null, this['sshError'] = null, this[_0x1b97ab(0x20c)] = null, this[_0x1b97ab(0x2a8)] = 0x0, this['pendingTimeout'] = null, this['commands'] = this[_0x1b97ab(0x18f)](); } [_0x11ab8e(0x196)](_0x53b2b5) { const _0x521cc2 = _0x11ab8e; console[_0x521cc2(0x29b)](_0x521cc2(0x2c0) + this['id'][_0x521cc2(0x26c)](0x0, 0x6) + _0x521cc2(0x1b4) + _0x53b2b5); } [_0x11ab8e(0x1c8)](_0x30a625) { const _0xfa01d7 = _0x11ab8e; console[_0xfa01d7(0x29b)](_0xfa01d7(0x28c) + this['id'][_0xfa01d7(0x26c)](0x0, 0x6) + _0xfa01d7(0x1b4) + _0x30a625); } [_0x11ab8e(0x26a)](_0x481d7d) { const _0x3acd40 = _0x11ab8e; this[_0x3acd40(0x193)][_0x3acd40(0x233)](_0x481d7d), this['vc_connected'] = !![], this['sendInitialPayload'](_0x481d7d), _0x481d7d['on'](_0x3acd40(0x187), async _0x4b5877 => { const _0x4537cc = _0x3acd40; try { let _0x343185; try { _0x343185 = msgpack['decode'](_0x4b5877); } catch (_0x522cb7) { try { _0x343185 = JSON[_0x4537cc(0x1d4)](_0x4b5877); } catch (_0x55db6f) { } } if (_0x343185) { if (_0x343185['userName'] && _0x343185['position']) this[_0x4537cc(0x228)][_0x343185[_0x4537cc(0x202)]] = _0x343185[_0x4537cc(0x2bf)]; if (_0x343185['action'] === _0x4537cc(0x22e) && typeof _0x343185[_0x4537cc(0x2be)] === _0x4537cc(0x259)) { if (this[_0x4537cc(0x194)]) { const _0x417dcb = await this[_0x4537cc(0x194)]['runCommand'](_0x343185[_0x4537cc(0x2be)]); _0x481d7d[_0x4537cc(0x1a5)](JSON['stringify']({ 'type': _0x4537cc(0x1f0), 'payload': _0x417dcb })); } } } } catch (_0x1f3b73) { } }), _0x481d7d['on'](_0x3acd40(0x19a), () => { const _0x2e9410 = _0x3acd40; this[_0x2e9410(0x193)][_0x2e9410(0x1c6)](_0x481d7d); }); } async[_0x11ab8e(0x1e8)]() { const _0x2377b1 = _0x11ab8e, { sub_domain: _0xffdb75, username: _0x2caf14, ssh_password: _0x4d6beb } = this[_0x2377b1(0x208)]; if (_0x2caf14 && _0x4d6beb && _0xffdb75) this[_0x2377b1(0x1b1)] = await startSshTunnel(this, _0xffdb75, INITIAL_CONFIG['web_port']); else this[_0x2377b1(0x292)]('mc'); } [_0x11ab8e(0x23c)](_0x20a047) { const _0x1f5efc = _0x11ab8e; this[_0x1f5efc(0x247)] && (clearTimeout(this[_0x1f5efc(0x247)]), this[_0x1f5efc(0x247)] = null), this['world'] = _0x20a047, this[_0x1f5efc(0x240)] = _0x20a047['name'] || _0x1f5efc(0x23b), this[_0x1f5efc(0x234)](); } async[_0x11ab8e(0x234)]() { const _0x3858ea = _0x11ab8e; if (!this[_0x3858ea(0x194)] && !this[_0x3858ea(0x247)]) return; if (!this[_0x3858ea(0x1da)] && !this[_0x3858ea(0x1b1)]) { const { sub_domain: _0x34c215, username: _0x4c5fe2, ssh_password: _0x2ec8d4 } = this[_0x3858ea(0x208)]; if (_0x4c5fe2 && _0x2ec8d4 && _0x34c215) this[_0x3858ea(0x1b1)] = await startSshTunnel(this, _0x34c215, INITIAL_CONFIG['web_port']); else { if (!_0x34c215) this[_0x3858ea(0x292)]('mc'); } } this[_0x3858ea(0x1a8)] = !![], this[_0x3858ea(0x181)] = ![], this[_0x3858ea(0x196)](_0x3858ea(0x241)); if (this['world']) { try { this['cleanOldTags'](), this['world'][_0x3858ea(0x2ab)]('tag\x20@s\x20add\x20\x22pvc:roomId=' + this[_0x3858ea(0x1be)] + '\x22'), this[_0x3858ea(0x24d)](); } catch (_0x53eca5) { } this[_0x3858ea(0x271)](); } } async[_0x11ab8e(0x2c5)]() { const _0x5ce4e6 = _0x11ab8e; if (!this['world']) return; try { const _0x5c1214 = await this['getAllTags'](), _0x404961 = _0x5c1214[_0x5ce4e6(0x264)](_0xf97005 => _0xf97005[_0x5ce4e6(0x277)](_0x5ce4e6(0x286))); for (const _0x5d50c5 of _0x404961) { this[_0x5ce4e6(0x194)][_0x5ce4e6(0x2ab)](_0x5ce4e6(0x27e) + _0x5d50c5 + _0x5ce4e6(0x279) + _0x5d50c5 + '\x22'); } const _0x3e9c00 = await this['world'][_0x5ce4e6(0x2ab)](_0x5ce4e6(0x18a)); this['onlinePlayers'][_0x5ce4e6(0x23f)](); if (_0x3e9c00[_0x5ce4e6(0x1a9)]) _0x3e9c00[_0x5ce4e6(0x1a9)][_0x5ce4e6(0x28f)](_0x41f370 => this['onlinePlayers'][_0x5ce4e6(0x233)](_0x41f370)); } catch (_0x213239) { } } [_0x11ab8e(0x24d)]() { const _0x52cbde = _0x11ab8e; if (!this['world']) return; const { proximity: _0x71f5dc, distance: _0x556103, lang: _0x37e942 } = this['config']; if (_0x37e942 == 'ja') { let _0x36f837 = _0x71f5dc ? '有効' : '無効'; this[_0x52cbde(0x194)][_0x52cbde(0x270)](_0x52cbde(0x2a9) + _0x36f837 + '\x0a声の届く距離：' + _0x556103 + _0x52cbde(0x2c4))[_0x52cbde(0x1c5)](_0x53e2d8 => { }); } else { let _0x3c4eb3 = _0x71f5dc ? _0x52cbde(0x1d0) : 'disabled'; this[_0x52cbde(0x194)]['sendMessage'](_0x52cbde(0x1fc) + _0x3c4eb3 + _0x52cbde(0x21e) + _0x556103 + _0x52cbde(0x203))[_0x52cbde(0x1c5)](_0x41874a => { }); } } [_0x11ab8e(0x25f)]() { const _0x6cccce = _0x11ab8e; this[_0x6cccce(0x1f9)] = !![], clearTimeout(this[_0x6cccce(0x20c)]), this[_0x6cccce(0x20c)] = setTimeout(() => { const _0xa9bfea = _0x6cccce; this[_0xa9bfea(0x2bc)](_0xa9bfea(0x1ad)); }, INACTIVITY_TIMEOUT); } [_0x11ab8e(0x24b)]() { const _0x170211 = _0x11ab8e; setTimeout(() => { const _0x5b5701 = _0x2ec5; if (this[_0x5b5701(0x194)]) this['world'][_0x5b5701(0x270)](this['config'][_0x5b5701(0x229)] === 'ja' ? _0x5b5701(0x24e) : _0x5b5701(0x1fd))[_0x5b5701(0x1c5)](() => { }); console[_0x5b5701(0x29b)]('\x0a======================================================='), console[_0x5b5701(0x29b)](_0x5b5701(0x204) + this['worldName'] + _0x5b5701(0x1bf)), console[_0x5b5701(0x29b)](_0x5b5701(0x26d)), setTimeout(() => this[_0x5b5701(0x2bc)]('timeout'), 0x1388); }, MAX_RUNTIME), this[_0x170211(0x25f)](); } async['loop']() { const _0x9c0563 = _0x11ab8e; if (this[_0x9c0563(0x181)] || !this[_0x9c0563(0x194)]) return; try { if (this['useResetTimer']) this[_0x9c0563(0x25f)](); let _0x5c2bcd = { 'playersNames': [], 'aliveSet': new Set(), 'spectatorSet': new Set(), 'details': [] }; if (this['config'][_0x9c0563(0x1d8)]) { const [_0x10ea42, _0x457535, _0x2e9b51, _0x21e646, _0x5e0c7b] = await Promise[_0x9c0563(0x265)]([this[_0x9c0563(0x194)]['runCommand']('list'), this[_0x9c0563(0x194)]['runCommand'](_0x9c0563(0x274)), this[_0x9c0563(0x194)]['runCommand'](_0x9c0563(0x1ee)), this['world'][_0x9c0563(0x2ab)](_0x9c0563(0x1dc)), this[_0x9c0563(0x180)]()]); if (_0x10ea42['statusCode'] <= -0x1) { this[_0x9c0563(0x2a8)]++; if (this[_0x9c0563(0x2a8)] >= TIMEOUT_THRESHOLD) { this[_0x9c0563(0x2bc)](_0x9c0563(0x23a)); return; } } else this[_0x9c0563(0x2a8)] = 0x0; _0x10ea42['statusCode'] === 0x0 && typeof _0x10ea42[_0x9c0563(0x236)] === 'string' && (_0x5c2bcd[_0x9c0563(0x263)] = _0x10ea42[_0x9c0563(0x236)]['split'](',')[_0x9c0563(0x1a1)](_0x12b07d => _0x12b07d['trim']())[_0x9c0563(0x264)](_0x2c8b42 => _0x2c8b42['length'] > 0x0)); if (_0x457535[_0x9c0563(0x1a9)]) _0x457535[_0x9c0563(0x1a9)][_0x9c0563(0x28f)](_0x1ee45c => _0x5c2bcd[_0x9c0563(0x24f)][_0x9c0563(0x233)](_0x1ee45c)); if (_0x2e9b51[_0x9c0563(0x1a9)]) _0x2e9b51['victim'][_0x9c0563(0x28f)](_0x5e26ac => _0x5c2bcd['spectatorSet'][_0x9c0563(0x233)](_0x5e26ac)); try { _0x5c2bcd['details'] = JSON[_0x9c0563(0x1d4)](_0x21e646[_0x9c0563(0x28e)] || '[]'); } catch (_0xce4f3c) { _0x5c2bcd[_0x9c0563(0x28e)] = []; } } const _0x2ca6db = Array[_0x9c0563(0x1ea)](_0x5c2bcd[_0x9c0563(0x24f)]); _0x5c2bcd[_0x9c0563(0x263)][_0x9c0563(0x28f)](_0x279d51 => { const _0x13dcd9 = _0x9c0563, _0x4473e4 = processName(_0x279d51), _0x20c480 = _0x5c2bcd[_0x13dcd9(0x22a)]['has'](_0x279d51); this[_0x13dcd9(0x217)][_0x4473e4] = _0x20c480; if (!this['config']['proximity']) this['positions'][_0x4473e4] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; else { if (!_0x5c2bcd['aliveSet']['has'](_0x279d51)) this[_0x13dcd9(0x228)][_0x4473e4] = { 'x': 0x0, 'y': 0x4e20, 'z': 0x0 }; else { if (this[_0x13dcd9(0x208)][_0x13dcd9(0x2a3)] && _0x20c480) { if (this[_0x13dcd9(0x208)][_0x13dcd9(0x22c)] === !![]) { const _0x2aa4b3 = _0x2ca6db[_0x13dcd9(0x209)](_0x279d51); if (_0x2aa4b3 !== -0x1 && _0x5c2bcd[_0x13dcd9(0x28e)][_0x2aa4b3]) { this['positions'][_0x4473e4] = _0x5c2bcd[_0x13dcd9(0x28e)][_0x2aa4b3][_0x13dcd9(0x2bf)]; if (this['config'][_0x13dcd9(0x290)] === !![]) this[_0x13dcd9(0x2b4)][_0x4473e4] = _0x5c2bcd['details'][_0x2aa4b3][_0x13dcd9(0x25e)]; } else this[_0x13dcd9(0x228)][_0x4473e4] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; } else this['positions'][_0x4473e4] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; } else { const _0x1b6eea = _0x2ca6db['indexOf'](_0x279d51); if (_0x1b6eea !== -0x1 && _0x5c2bcd[_0x13dcd9(0x28e)][_0x1b6eea]) this['positions'][_0x4473e4] = _0x5c2bcd[_0x13dcd9(0x28e)][_0x1b6eea][_0x13dcd9(0x2bf)], this[_0x13dcd9(0x25b)][_0x4473e4] = _0x5c2bcd['details'][_0x1b6eea][_0x13dcd9(0x214)], this[_0x13dcd9(0x2b4)][_0x4473e4] = _0x5c2bcd['details'][_0x1b6eea]['dimension']; else this[_0x13dcd9(0x228)][_0x4473e4] = { 'x': 0x0, 'y': 0x7530, 'z': 0x0 }; } } } }), this[_0x9c0563(0x28b)] = !![], this[_0x9c0563(0x1fe)](); } catch (_0x2b51ca) { console['error']('Error\x20handling\x20world\x20loop\x20[' + this[_0x9c0563(0x240)] + ']:', _0x2b51ca); } if (!this[_0x9c0563(0x181)]) setTimeout(() => this[_0x9c0563(0x271)](), 0x0); } async[_0x11ab8e(0x180)]() { const _0x406bd4 = _0x11ab8e; if (!this['world']) return []; try { const _0x20f98f = await this['world'][_0x406bd4(0x2ab)](_0x406bd4(0x294)); if (_0x20f98f['statusCode'] !== 0x0 || !_0x20f98f[_0x406bd4(0x225)]) return []; let _0x209bd0 = []; const _0x3b1893 = _0x20f98f['statusMessage'][_0x406bd4(0x276)](/\r\n|\n|\r/); for (const _0x1fa2d5 of _0x3b1893) { if (!_0x1fa2d5[_0x406bd4(0x291)]()) continue; const _0x639909 = _0x1fa2d5[_0x406bd4(0x237)](/§./g, ''), _0x20e511 = _0x639909['indexOf'](':'); _0x20e511 !== -0x1 && (_0x209bd0 = _0x209bd0['concat'](_0x639909[_0x406bd4(0x26c)](_0x20e511 + 0x1)[_0x406bd4(0x276)](',')[_0x406bd4(0x1a1)](_0xf662a4 => _0xf662a4[_0x406bd4(0x291)]()))); } return _0x209bd0; } catch (_0x268617) { return []; } } [_0x11ab8e(0x1fe)]() { const _0x3d2899 = _0x11ab8e; if (!this[_0x3d2899(0x28b)]) return; const _0x5742c6 = {}; for (const [_0x5acb49, _0x5723cd] of Object[_0x3d2899(0x182)](this[_0x3d2899(0x228)])) { if (_0x5723cd) _0x5742c6[_0x5acb49] = [Math[_0x3d2899(0x2a7)](_0x5723cd['x'] * 0x64) / 0x64, Math[_0x3d2899(0x2a7)](_0x5723cd['y'] * 0x64) / 0x64, Math[_0x3d2899(0x2a7)](_0x5723cd['z'] * 0x64) / 0x64]; } const _0x23a246 = { 'spec': this['config'][_0x3d2899(0x2a3)], 'spLis': this['config']['specListen'], 'spDim': this['config']['specDim'], 't': 'wu', 'pos': _0x5742c6, 'dis': this[_0x3d2899(0x208)]['distance'], 'dim': this['dimensions'], 'yr': this['yRots'], 'spPos': this[_0x3d2899(0x217)], 'prox': this[_0x3d2899(0x208)]['proximity'] ? 0x1 : 0x0 }, _0x37f30a = msgpack['encode'](_0x23a246); if (this[_0x3d2899(0x18e)] && this[_0x3d2899(0x18e)]['readyState'] === WebSocket[_0x3d2899(0x1c3)]) this[_0x3d2899(0x18e)][_0x3d2899(0x1a5)](_0x37f30a); this[_0x3d2899(0x193)][_0x3d2899(0x28f)](_0x9a831f => { const _0x14ce24 = _0x3d2899; if (_0x9a831f[_0x14ce24(0x1ba)] === WebSocket[_0x14ce24(0x1c3)]) _0x9a831f[_0x14ce24(0x1a5)](_0x37f30a); }); } async[_0x11ab8e(0x292)](_0x3139a3) { const _0x462288 = _0x11ab8e, _0x24fc5d = _0x3139a3 === 'mc', _0x3986b2 = _0x24fc5d ? _0x462288(0x1eb) : _0x462288(0x285); try { if (!this['roomId']) { const _0x29483a = await fetch(_0x462288(0x1e0) + RELAY_SERVER_DOMAIN + '/create-room'), _0x40fd37 = await _0x29483a[_0x462288(0x2c6)](); this[_0x462288(0x1be)] = _0x40fd37[_0x462288(0x1be)]; if (this['world']) { this[_0x462288(0x2c5)](), this[_0x462288(0x194)]['runCommand'](_0x462288(0x191) + this[_0x462288(0x1be)] + '\x22')[_0x462288(0x1c5)](() => { }); if (this[_0x462288(0x208)][_0x462288(0x229)] === 'ja') await this[_0x462288(0x194)]['sendMessage'](_0x462288(0x1de) + this[_0x462288(0x1be)]); else await this['world'][_0x462288(0x270)](_0x462288(0x27b) + this[_0x462288(0x1be)]); } } else { if (!this[_0x462288(0x1da)]) { if (this['world']) { if (this[_0x462288(0x208)][_0x462288(0x229)] === 'ja') await this[_0x462288(0x194)]['sendMessage']('リレーモードに切り替わりました。\x0aRoom\x20ID:\x20' + this[_0x462288(0x1be)]); else await this[_0x462288(0x194)][_0x462288(0x270)](_0x462288(0x27b) + this['roomId']); } } } this[_0x462288(0x1da)] = !![]; if (_0x24fc5d) { console['log'](_0x462288(0x1f7)); if (this[_0x462288(0x208)][_0x462288(0x229)] === 'ja') this[_0x462288(0x196)](_0x462288(0x296)); else this['logInfo'](_0x462288(0x1f5)); this[_0x462288(0x196)](_0x462288(0x185) + RELAY_SERVER_DOMAIN + '/room/' + this[_0x462288(0x1be)]), this['connectCommand'] = _0x462288(0x185) + RELAY_SERVER_DOMAIN + _0x462288(0x1f4) + this[_0x462288(0x1be)]; } else { this[_0x462288(0x196)](_0x462288(0x25c) + this[_0x462288(0x1be)]); if (this[_0x462288(0x208)][_0x462288(0x229)] === 'ja') this[_0x462288(0x196)]('参加者はこのURLにアクセスしてください:'); else this[_0x462288(0x196)](_0x462288(0x1a0)); this[_0x462288(0x196)]('https://mcproxvc.ovh/connect/?roomid=' + this['roomId']), console[_0x462288(0x29b)](_0x462288(0x26d)); } this[_0x462288(0x24b)](); let _0x4743cd; if (this[_0x462288(0x18e)]) { _0x4743cd = this['relayWs']; if (_0x4743cd['readyState'] !== WebSocket[_0x462288(0x1c3)]) { } } else _0x4743cd = new WebSocket(_0x462288(0x1b0) + RELAY_SERVER_DOMAIN + '/room/' + this[_0x462288(0x1be)] + '?clientType=server_script'), this['relayWs'] = _0x4743cd, _0x4743cd['on'](_0x462288(0x248), () => this[_0x462288(0x196)](_0x462288(0x1cd) + this[_0x462288(0x1be)] + ')')), _0x4743cd['on'](_0x462288(0x19a), () => { const _0x41ec8e = _0x462288; if (this[_0x41ec8e(0x18e)] === _0x4743cd) this['relayWs'] = null; }), _0x4743cd['on']('error', _0x499642 => console['error'](_0x3986b2 + _0x462288(0x272), _0x499642)); _0x24fc5d ? (this[_0x462288(0x1a8)] = !![], this[_0x462288(0x250)](_0x4743cd), this[_0x462288(0x292)]('vc')) : (this['vc_connected'] = !![], this[_0x462288(0x17f)](_0x4743cd)); } catch (_0x56c1cc) { console[_0x462288(0x1d3)](_0x3986b2 + _0x462288(0x272), _0x56c1cc); } } [_0x11ab8e(0x268)](_0xd2e27d) { const _0x4333aa = _0x11ab8e, { app_id: _0x44aa1e, secret_key: _0x2fa058, proximity: _0x432504, distance: _0x458074, spectator: _0x3b9591, specListen: _0x148b64, specDim: _0xf88553, verify: _0x2def7d, password: _0x1c78b7 } = this['config']; _0xd2e27d[_0x4333aa(0x1a5)](msgpack[_0x4333aa(0x258)]({ 'password': !!(_0x2def7d || _0x1c78b7), 'passwords': this[_0x4333aa(0x210)], 'app_id': _0x44aa1e, 'secret_key': _0x2fa058, 'proximity': _0x432504, 'distance': _0x458074, 'spectator': _0x3b9591, 'specListen': _0x148b64, 'specDim': _0xf88553 })); } [_0x11ab8e(0x17f)](_0x393258) { _0x393258['on']('message', async _0x502eaf => { const _0x3ea0c5 = _0x2ec5; try { const _0x279859 = JSON[_0x3ea0c5(0x1d4)](_0x502eaf[_0x3ea0c5(0x2a1)]()); if (_0x279859[_0x3ea0c5(0x1e7)] === 'partner_connected') { this[_0x3ea0c5(0x268)](_0x393258); return; } if (_0x279859[_0x3ea0c5(0x1ce)] === _0x3ea0c5(0x22e)) { if (this[_0x3ea0c5(0x194)]) await this['world'][_0x3ea0c5(0x2ab)](_0x279859[_0x3ea0c5(0x2be)]); } } catch (_0x58c5ab) { } }); } [_0x11ab8e(0x250)](_0x2e78b0) { const _0x5063eb = _0x11ab8e; _0x2e78b0['on'](_0x5063eb(0x187), async _0x5904d1 => { const _0x169437 = _0x5063eb; let _0x443f8b = _0x5904d1; try { Buffer['isBuffer'](_0x5904d1) && _0x5904d1[_0x169437(0x207)] > 0x2 && _0x5904d1[0x0] === 0x1f && _0x5904d1[0x1] === 0x8b && (_0x443f8b = zlib[_0x169437(0x2a5)](_0x5904d1)); } catch (_0x36c1ed) { } try { const _0x1b3611 = JSON[_0x169437(0x1d4)](_0x443f8b[_0x169437(0x2a1)]()); if (_0x1b3611[_0x169437(0x1e7)] === _0x169437(0x2ba)) { const _0x4ae084 = _0x1b3611[_0x169437(0x293)] || _0x169437(0x257); _0x4ae084 === _0x169437(0x257) ? (this[_0x169437(0x1f6)] = new WebSocket('ws://127.0.0.1:' + this[_0x169437(0x208)][_0x169437(0x18d)], { 'headers': { 'x-proxvc-session': this['id'] } }), this['localClientBuffer'] = [], this[_0x169437(0x1f6)]['on'](_0x169437(0x248), () => { const _0x50958b = _0x169437; while (this[_0x50958b(0x218)][_0x50958b(0x207)] > 0x0) { const _0x548ba6 = this[_0x50958b(0x218)][_0x50958b(0x2bd)](); this['localClient']['send'](_0x548ba6); } }), this[_0x169437(0x1f6)]['on'](_0x169437(0x187), _0x1ecbc8 => _0x2e78b0[_0x169437(0x1ba)] === WebSocket[_0x169437(0x1c3)] && _0x2e78b0[_0x169437(0x1a5)](_0x1ecbc8)), this[_0x169437(0x1f6)]['on'](_0x169437(0x19a), (_0x5f5c33, _0x2fdb0e) => { const _0x231682 = _0x169437; if (_0x2e78b0[_0x231682(0x1ba)] === WebSocket[_0x231682(0x1c3)]) _0x2e78b0[_0x231682(0x19a)](); }), this[_0x169437(0x1f6)]['on'](_0x169437(0x1d3), _0x1170b7 => console[_0x169437(0x1d3)]('[Local\x20Client\x20Error]\x20' + _0x1170b7[_0x169437(0x187)]))) : this[_0x169437(0x268)](_0x2e78b0); return; } else { if (_0x1b3611['type'] === _0x169437(0x198)) { this['localClient'] && (this[_0x169437(0x1f6)][_0x169437(0x19a)](), this[_0x169437(0x1f6)] = null); return; } else { if (_0x1b3611[_0x169437(0x1e7)] === _0x169437(0x19e)) { console['log'](_0x169437(0x20e)); try { let _0x1e60e3 = _0x1b3611[_0x169437(0x253)]; _0x1e60e3 && _0x1e60e3[_0x169437(0x1e7)] === 'Buffer' && (_0x1e60e3 = Buffer[_0x169437(0x1ea)](_0x1e60e3[_0x169437(0x253)])); try { const _0x535c96 = msgpack[_0x169437(0x190)](_0x1e60e3); if (_0x535c96) { if (_0x535c96['action'] === 'run_command' && typeof _0x535c96[_0x169437(0x2be)] === _0x169437(0x259)) { if (this['world']) this[_0x169437(0x194)]['runCommand'](_0x535c96[_0x169437(0x2be)])['catch'](() => { }); } else { if (_0x535c96[_0x169437(0x202)] && _0x535c96[_0x169437(0x2bf)]) this['positions'][_0x535c96[_0x169437(0x202)]] = _0x535c96[_0x169437(0x2bf)]; else _0x535c96[_0x169437(0x1e7)] === _0x169437(0x2ba) && this[_0x169437(0x268)](_0x2e78b0); } } } catch (_0xf7dc7f) { const _0x1929de = JSON[_0x169437(0x1d4)](_0x1e60e3['toString']()); if (_0x1929de[_0x169437(0x1ce)] === _0x169437(0x22e)) { if (this[_0x169437(0x194)]) this[_0x169437(0x194)][_0x169437(0x2ab)](_0x1929de[_0x169437(0x2be)])[_0x169437(0x1c5)](() => { }); } } } catch (_0x4d282b) { } return; } } } if (_0x1b3611[_0x169437(0x1e7)] === _0x169437(0x2b6)) this[_0x169437(0x27f)](_0x1b3611); } catch (_0x2f3b35) { } if (this['localClient']?.[_0x169437(0x1ba)] === WebSocket[_0x169437(0x1c3)]) this[_0x169437(0x1f6)][_0x169437(0x1a5)](_0x443f8b); else this['localClient']?.['readyState'] === WebSocket['CONNECTING'] && this[_0x169437(0x218)]['push'](_0x443f8b); }), _0x2e78b0['on'](_0x5063eb(0x19a), () => this[_0x5063eb(0x1f6)]?.[_0x5063eb(0x19a)]()); } [_0x11ab8e(0x18f)]() { const _0x287b02 = _0x11ab8e, _0x310772 = (_0x53def6, _0x5f2690, _0x1a8f1f) => async (_0x27b2ee, _0x12b5ad, _0x58c2d6) => { const _0x275b75 = _0x2ec5; if (_0x12b5ad[_0x275b75(0x21b)] !== _0x27b2ee[_0x275b75(0x262)][_0x275b75(0x21b)]) return; if (_0x58c2d6[0x0] !== _0x275b75(0x243) && _0x58c2d6[0x0] !== 'false') return; const _0x2b5f9e = _0x58c2d6[0x0] === 'true'; this['config'][_0x53def6] = _0x2b5f9e; if (_0x53def6 === _0x275b75(0x2a6)) this[_0x275b75(0x208)]['password'] = _0x2b5f9e; updateConfigFile(_0x53def6, _0x2b5f9e); const _0x162dfb = this[_0x275b75(0x208)]['lang'] === 'ja' ? _0x2b5f9e ? _0x5f2690['enabled'] : _0x5f2690[_0x275b75(0x24c)] : _0x2b5f9e ? _0x1a8f1f[_0x275b75(0x1d0)] : _0x1a8f1f[_0x275b75(0x24c)]; await _0x27b2ee[_0x275b75(0x270)](_0x162dfb); }; return { '!dis': async (_0x134bca, _0xe715fd, _0x591c3c) => { const _0x556742 = _0x2ec5; if (_0xe715fd[_0x556742(0x21b)] !== _0x134bca['localPlayer'][_0x556742(0x21b)]) return; const _0x343067 = Number(_0x591c3c[0x0]); if (!isNaN(_0x343067)) { this[_0x556742(0x208)][_0x556742(0x287)] = _0x343067, updateConfigFile(_0x556742(0x287), _0x343067); const _0x559d92 = this[_0x556742(0x208)][_0x556742(0x229)] === 'ja' ? '声の最大距離を' + _0x343067 + _0x556742(0x238) : _0x556742(0x2c3) + _0x343067; await _0x134bca[_0x556742(0x270)](_0x559d92); } }, '!name': async (_0x2929a3, _0x4d5941) => { const _0x5ef370 = _0x2ec5, _0x58b069 = processName(_0x4d5941['name']), _0x1e4443 = _0x5ef370(0x200) + this['roomId'] + _0x5ef370(0x1c1) + _0x58b069 + 'です', _0x238cbc = 'URL:https://mcproxvc.ovh/connect/\x0aRoomID\x20is\x20' + this[_0x5ef370(0x1be)] + _0x5ef370(0x298) + _0x58b069; await _0x4d5941[_0x5ef370(0x270)](this['config'][_0x5ef370(0x229)] === 'ja' ? _0x1e4443 : _0x238cbc); }, '!password': _0x310772(_0x287b02(0x195), { 'enabled': _0x287b02(0x267), 'disabled': _0x287b02(0x282) }, { 'enabled': _0x287b02(0x1d5), 'disabled': _0x287b02(0x235) }), '!verify': _0x310772(_0x287b02(0x195), { 'enabled': _0x287b02(0x267), 'disabled': _0x287b02(0x282) }, { 'enabled': 'verify\x20code\x20enabled', 'disabled': _0x287b02(0x235) }), '!pvc': _0x310772(_0x287b02(0x1d8), { 'enabled': _0x287b02(0x1df), 'disabled': _0x287b02(0x289) }, { 'enabled': _0x287b02(0x1f3), 'disabled': _0x287b02(0x2b5) }), '!spectator': _0x310772('spectator', { 'enabled': _0x287b02(0x281), 'disabled': _0x287b02(0x1ef) }, { 'enabled': _0x287b02(0x1a3), 'disabled': _0x287b02(0x28d) }), '!specListen': _0x310772(_0x287b02(0x22c), { 'enabled': 'スペクテイターが他モードプレイヤーの会話を聞けるようになりました', 'disabled': _0x287b02(0x288) }, { 'enabled': 'Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players', 'disabled': 'Spectator\x20cannot\x20listen\x20to\x20other\x20gamemode\x20players' }), '!specDim': _0x310772(_0x287b02(0x290), { 'enabled': _0x287b02(0x21f), 'disabled': _0x287b02(0x27a) }, { 'enabled': _0x287b02(0x1e2), 'disabled': _0x287b02(0x255) }), '!lang': async (_0x3813a3, _0x3d9117, _0x558214) => { const _0x550afe = _0x287b02; if (_0x3d9117[_0x550afe(0x21b)] !== _0x3813a3[_0x550afe(0x262)][_0x550afe(0x21b)]) return; const _0x502a80 = _0x558214[0x0] === 'ja' ? 'ja' : 'en'; this[_0x550afe(0x208)][_0x550afe(0x229)] = _0x502a80, updateConfigFile('lang', _0x502a80), await _0x3813a3['sendMessage'](_0x502a80 === 'ja' ? '<近接VC>言語を日本語に設定しました' : _0x550afe(0x230)); }, '!config': async (_0x565d79, _0x5581d3) => { const _0x40e57b = _0x287b02; if (_0x5581d3[_0x40e57b(0x21b)] !== _0x565d79[_0x40e57b(0x262)][_0x40e57b(0x21b)]) return; const { proximity: _0x44b300, distance: _0x2f15a7, password: _0x3dff25, spectator: _0x400843, specListen: _0x57bfe1, specDim: _0x4dff16, lang: _0x36dc56 } = this[_0x40e57b(0x208)], _0x390ec8 = _0x36dc56 === 'ja' ? _0x40e57b(0x1dd) : _0x40e57b(0x22f), _0x498556 = _0x36dc56 === 'ja' ? _0x40e57b(0x1d6) : _0x40e57b(0x24a), _0x36bc83 = _0x433f31 => _0x433f31 ? _0x390ec8 : _0x498556; let _0xd92fe6 = _0x36dc56 === 'ja' ? _0x40e57b(0x213) + _0x36dc56 + _0x40e57b(0x219) + _0x36bc83(_0x44b300) + _0x40e57b(0x221) + _0x2f15a7 + _0x40e57b(0x242) + _0x36bc83(_0x3dff25) + '\x0aスペクテイター分離\x20(Spectator):\x20' + _0x36bc83(_0x400843) + '\x0a\x20-\x20スペクテイター以外の声を聞ける\x20(Listen):\x20' + _0x36bc83(_0x57bfe1) + _0x40e57b(0x246) + _0x36bc83(_0x4dff16) : _0x40e57b(0x28a) + _0x36dc56 + _0x40e57b(0x27c) + _0x36bc83(_0x44b300) + _0x40e57b(0x244) + _0x2f15a7 + _0x40e57b(0x212) + _0x36bc83(_0x3dff25) + _0x40e57b(0x25a) + _0x36bc83(_0x400843) + _0x40e57b(0x26b) + _0x36bc83(_0x57bfe1) + _0x40e57b(0x1cf) + _0x36bc83(_0x4dff16); await _0x5581d3[_0x40e57b(0x270)](_0xd92fe6); }, '!help': async (_0xea22a8, _0x3a7834) => { const _0x5e67c = _0x287b02, { lang: _0x5912a2 } = this['config']; await _0x3a7834[_0x5e67c(0x270)](_0x5e67c(0x19b)), _0x5912a2 == 'ja' ? (await _0x3a7834[_0x5e67c(0x270)](_0x5e67c(0x1af)), _0x3a7834[_0x5e67c(0x21b)] == _0xea22a8[_0x5e67c(0x262)][_0x5e67c(0x21b)] && (await _0x3a7834[_0x5e67c(0x270)](_0x5e67c(0x266)), await _0x3a7834[_0x5e67c(0x270)](_0x5e67c(0x278)), await _0x3a7834[_0x5e67c(0x270)]('spectatorが有効の場合のみ有効：\x0a\x20!specListen\x20-\x20!specListen\x20<§atrue§r/§cfalse§r>\x20でスペクテイターが他モードプレイヤーの会話を聞けるようになります\x20\x0a\x20!specDim\x20-\x20!specDim\x20<§atrue§r/§cfalse§r>\x20でスペクテイター同士の会話をディメンションごとに分けます'))) : (await _0x3a7834[_0x5e67c(0x270)](_0x5e67c(0x20b)), _0x3a7834[_0x5e67c(0x21b)] == _0xea22a8[_0x5e67c(0x262)][_0x5e67c(0x21b)] && (await _0x3a7834[_0x5e67c(0x270)](_0x5e67c(0x2c2)), await _0x3a7834[_0x5e67c(0x270)](_0x5e67c(0x1f1)), await _0x3a7834[_0x5e67c(0x270)](_0x5e67c(0x29c)))), await _0x3a7834['sendMessage'](_0x5e67c(0x19b)); } }; } [_0x11ab8e(0x27f)](_0x4c2cf1) { const _0x735cd2 = _0x11ab8e; if (this['vc_connected']) this[_0x735cd2(0x1fe)](); if (this[_0x735cd2(0x1f9)]) this[_0x735cd2(0x25f)](); for (const [_0x5aaaed, _0x32c9ee] of Object[_0x735cd2(0x182)](_0x4c2cf1)) { if (_0x5aaaed === _0x735cd2(0x1e7)) continue; if ([_0x735cd2(0x228), 'proximity', _0x735cd2(0x287), 'spectator', _0x735cd2(0x217), 'specListen', _0x735cd2(0x290), _0x735cd2(0x2b4), 'yRots', _0x735cd2(0x195), 'lang']['includes'](_0x5aaaed)) { if ([_0x735cd2(0x228), _0x735cd2(0x217), _0x735cd2(0x2b4), _0x735cd2(0x25b)][_0x735cd2(0x1b9)](_0x5aaaed)) this[_0x5aaaed] = _0x32c9ee; else this[_0x735cd2(0x208)][_0x5aaaed] = _0x32c9ee; } } } [_0x11ab8e(0x23c)](_0x29ff7c) { const _0x2ce197 = _0x11ab8e; this[_0x2ce197(0x194)] = _0x29ff7c, this[_0x2ce197(0x234)](), this[_0x2ce197(0x247)] && (clearTimeout(this[_0x2ce197(0x247)]), this['pendingTimeout'] = null), this['useRelay'] && this[_0x2ce197(0x1be)] && this[_0x2ce197(0x194)][_0x2ce197(0x2ab)](_0x2ce197(0x191) + this[_0x2ce197(0x1be)] + '\x22')[_0x2ce197(0x1c5)](() => { }); } [_0x11ab8e(0x2bc)](_0x5d3a6c = _0x11ab8e(0x23a)) { const _0x2ad15c = _0x11ab8e, _0x2a2f3c = this[_0x2ad15c(0x240)]; this['logInfo'](_0x2ad15c(0x1c0) + _0x5d3a6c), this['stop_roop'] = !![]; this['pendingTimeout'] && (clearTimeout(this[_0x2ad15c(0x247)]), this[_0x2ad15c(0x247)] = null); this[_0x2ad15c(0x192)] && (clearTimeout(this[_0x2ad15c(0x192)]), this[_0x2ad15c(0x192)] = null); const _0x20669 = msgpack['encode']({ 't': _0x2ad15c(0x1ec), 'type': _0x2ad15c(0x2b7) }); this[_0x2ad15c(0x18e)] && (this[_0x2ad15c(0x18e)]['send'](_0x20669), this['relayWs'][_0x2ad15c(0x19a)](), this[_0x2ad15c(0x18e)] = null); this[_0x2ad15c(0x1f6)] && (this['localClient']['close'](), this[_0x2ad15c(0x1f6)] = null); this[_0x2ad15c(0x1b1)] && (this[_0x2ad15c(0x1b1)]['end'](), this[_0x2ad15c(0x1b1)] = null); this[_0x2ad15c(0x1d7)] = null, this[_0x2ad15c(0x18c)] = null, this['directVcClients'][_0x2ad15c(0x28f)](_0x48bf09 => _0x48bf09['close']()), this[_0x2ad15c(0x193)][_0x2ad15c(0x23f)](); if (typeof this['cleanOldTags'] === _0x2ad15c(0x1aa)) this['cleanOldTags']()['then'](() => { const _0x52a2cf = _0x2ad15c; sessionHistory[_0x52a2cf(0x249)](this['id'], { 'reason': _0x5d3a6c, 'timestamp': Date[_0x52a2cf(0x2b1)]() }), sessions['delete'](this['world']), pendingSessions[_0x52a2cf(0x1c6)](this['id']); }); else { sessionHistory[_0x2ad15c(0x249)](this['id'], { 'reason': _0x5d3a6c, 'timestamp': Date[_0x2ad15c(0x2b1)]() }); if (sessionHistory[_0x2ad15c(0x297)] > 0x64) { const _0x5d066e = sessionHistory[_0x2ad15c(0x19d)]()[_0x2ad15c(0x23d)]()[_0x2ad15c(0x2be)]; sessionHistory[_0x2ad15c(0x1c6)](_0x5d066e); } sessions['delete'](this['world']), pendingSessions[_0x2ad15c(0x1c6)](this['id']); } } } const sessions = new Map(), pendingSessions = new Map(), sessionHistory = new Map(); async function main() { const _0x5af337 = _0x11ab8e; let _0x1ca575 = INITIAL_CONFIG['port'], _0x1d7ffd = INITIAL_CONFIG[_0x5af337(0x29a)]; _0x1ca575 = await getPort({ 'port': [_0x1ca575, ...makeRange(0x4abd, 0x4b20)] }), _0x1d7ffd = await getPort({ 'port': [_0x1d7ffd, ...makeRange(0x1f41, 0x1fa4)] }), console[_0x5af337(0x29b)](_0x5af337(0x1c9) + _0x1ca575), console[_0x5af337(0x29b)](_0x5af337(0x252) + _0x1d7ffd), INITIAL_CONFIG[_0x5af337(0x18d)] = _0x1ca575, INITIAL_CONFIG['web_port'] = _0x1d7ffd, globalConfig['port'] = _0x1ca575, globalConfig[_0x5af337(0x29a)] = _0x1d7ffd, setupGlobalVcWebSocket(_0x1d7ffd); const _0x4d23dc = express(), _0x55cedf = http['createServer'](_0x4d23dc); _0x55cedf[_0x5af337(0x1d9)](_0x1ca575); const _0x1272fd = new Server({ 'webSocketOptions': { 'server': _0x55cedf } }); _0x4d23dc['use'](express['json']()), _0x4d23dc[_0x5af337(0x29d)]('/api/start_session', async (_0x88b8f9, _0x2e7112) => { const _0x561aba = _0x5af337; try { const _0xafc4ab = _0x88b8f9['body']['config'] || {}, _0x3d0870 = new Session(null, _0xafc4ab); await _0x3d0870[_0x561aba(0x1e8)](), pendingSessions[_0x561aba(0x249)](_0x3d0870['id'], _0x3d0870), _0x2e7112[_0x561aba(0x2c6)]({ 'sessionId': _0x3d0870['id'], 'roomId': _0x3d0870[_0x561aba(0x1be)], 'connectCommand': _0x3d0870['connectCommand'] }), _0x3d0870[_0x561aba(0x24b)](); } catch (_0x3e3828) { console[_0x561aba(0x1d3)](_0x3e3828), _0x2e7112[_0x561aba(0x211)](0x1f4)['json']({ 'error': _0x3e3828[_0x561aba(0x187)] }); } }), _0x4d23dc[_0x5af337(0x29d)](_0x5af337(0x206), (_0x25ac95, _0x33a6d8) => { const _0x5b1208 = _0x5af337, { sessionId: _0x498e03 } = _0x25ac95['body'], _0x54b8fe = pendingSessions[_0x5b1208(0x216)](_0x498e03) || Array[_0x5b1208(0x1ea)](sessions[_0x5b1208(0x284)]())[_0x5b1208(0x29e)](_0x1b292a => _0x1b292a['id'] === _0x498e03); _0x54b8fe ? (_0x54b8fe[_0x5b1208(0x2bc)](_0x5b1208(0x23a)), _0x33a6d8[_0x5b1208(0x2c6)]({ 'success': !![] })) : _0x33a6d8['status'](0x194)['json']({ 'error': 'Session\x20not\x20found' }); }), _0x4d23dc[_0x5af337(0x216)](_0x5af337(0x1bd), (_0x5c940b, _0x3a354e) => { const _0x505ee5 = _0x5af337, _0x164467 = _0x5c940b[_0x505ee5(0x256)]['id'], _0x17757f = pendingSessions[_0x505ee5(0x216)](_0x164467) || Array[_0x505ee5(0x1ea)](sessions['values']())[_0x505ee5(0x29e)](_0x765178 => _0x765178['id'] === _0x164467); if (_0x17757f) _0x3a354e[_0x505ee5(0x2c6)]({ 'status': _0x505ee5(0x19f), 'sshError': _0x17757f[_0x505ee5(0x245)] }); else { if (sessionHistory[_0x505ee5(0x21c)](_0x164467)) { const _0x14ee3a = sessionHistory[_0x505ee5(0x216)](_0x164467); _0x3a354e['json']({ 'status': _0x505ee5(0x1e5), 'reason': _0x14ee3a[_0x505ee5(0x226)], 'timestamp': _0x14ee3a['timestamp'] }); } else _0x3a354e[_0x505ee5(0x2c6)]({ 'status': _0x505ee5(0x2bb) }); } }); const _0x54ddb2 = (_0x4d598b, _0x3808e4) => { const _0x241099 = _0x5af337, { type: _0x2243c5 } = _0x4d598b[_0x241099(0x1ca)], _0x375413 = _0x4d598b[_0x241099(0x295)][_0x241099(0x2b3)]; let _0x56dbd0 = null; if (_0x375413) { for (const _0x5ae5ae of sessions[_0x241099(0x284)]()) { const _0x5ed73b = _0x5ae5ae[_0x241099(0x208)]['sub_domain']; if (_0x5ed73b && _0x375413[_0x241099(0x277)](_0x5ed73b)) { _0x56dbd0 = _0x5ae5ae; break; } } if (!_0x56dbd0) for (const _0x3fc815 of pendingSessions[_0x241099(0x284)]()) { const _0x3a2f9e = _0x3fc815['config'][_0x241099(0x18b)]; if (_0x3a2f9e && _0x375413[_0x241099(0x277)](_0x3a2f9e)) { _0x56dbd0 = _0x3fc815; break; } } } if (_0x56dbd0) { if (_0x2243c5 === _0x241099(0x2b6)) _0x56dbd0[_0x241099(0x27f)](_0x4d598b[_0x241099(0x1ca)]); else { if (_0x2243c5 === 'disconnect_command') _0x56dbd0['destroy'](_0x241099(0x23a)); } _0x2243c5 === _0x241099(0x184) ? (_0x56dbd0[_0x241099(0x183)] = !![], _0x56dbd0[_0x241099(0x196)](_0x241099(0x241)), _0x3808e4[_0x241099(0x211)](0xc8)[_0x241099(0x2c6)]({ 'type': _0x241099(0x184), 'roomId': _0x56dbd0[_0x241099(0x1be)], 'ws_connected': _0x56dbd0[_0x241099(0x1a8)], ..._0x56dbd0[_0x241099(0x208)] })) : _0x3808e4[_0x241099(0x211)](0xc8)[_0x241099(0x2c6)]({ 'success': !![] }); } else { sessions[_0x241099(0x28f)](_0x349d8e => { const _0xd87c6d = _0x241099; if (_0x2243c5 === 'data_update') _0x349d8e[_0xd87c6d(0x27f)](_0x4d598b[_0xd87c6d(0x1ca)]); else { if (_0x2243c5 === _0xd87c6d(0x2a4)) _0x349d8e['destroy'](_0xd87c6d(0x23a)); } }); const _0x436edb = sessions['values']()[_0x241099(0x23d)]()[_0x241099(0x2be)] || pendingSessions[_0x241099(0x284)]()[_0x241099(0x23d)]()[_0x241099(0x2be)]; _0x436edb ? _0x2243c5 === 'initialization' ? (_0x436edb['vc_connected'] = !![], _0x436edb['logInfo'](_0x241099(0x241)), _0x3808e4['status'](0xc8)[_0x241099(0x2c6)]({ 'type': _0x241099(0x184), 'roomId': _0x436edb[_0x241099(0x1be)], 'ws_connected': _0x436edb['mc_connected'], ..._0x436edb[_0x241099(0x208)] })) : _0x3808e4[_0x241099(0x211)](0xc8)[_0x241099(0x2c6)]({ 'success': !![] }) : _0x3808e4[_0x241099(0x211)](0xc8)[_0x241099(0x2c6)]({ 'error': _0x241099(0x1ab) }); } }; _0x4d23dc['post']('/', _0x54ddb2), _0x1272fd['on'](ServerEvent[_0x5af337(0x201)], ({ world: _0x21b2b2 }) => { const _0x87f77b = _0x5af337, _0x316079 = _0x21b2b2[_0x87f77b(0x29f)], _0x50c2ce = _0x21b2b2['pvcDomain']; let _0x4d73b6 = Array[_0x87f77b(0x1ea)](sessions[_0x87f77b(0x284)]())[_0x87f77b(0x29e)](_0x273fcf => _0x273fcf['id'] === _0x316079); !_0x4d73b6 && _0x316079 && (_0x4d73b6 = pendingSessions[_0x87f77b(0x216)](_0x316079)); if (!_0x4d73b6 && _0x50c2ce) { _0x4d73b6 = Array[_0x87f77b(0x1ea)](pendingSessions[_0x87f77b(0x284)]())[_0x87f77b(0x29e)](_0x35733d => { const _0x2885ce = _0x87f77b, _0xebe286 = _0x35733d[_0x2885ce(0x208)][_0x2885ce(0x18b)]; if (_0xebe286 && _0x50c2ce['startsWith'](_0xebe286)) return !![]; return ![]; }); if (_0x4d73b6) { } } if (_0x4d73b6) pendingSessions[_0x87f77b(0x21c)](_0x4d73b6['id']) && pendingSessions['delete'](_0x4d73b6['id']), sessions[_0x87f77b(0x249)](_0x21b2b2, _0x4d73b6), _0x4d73b6[_0x87f77b(0x23c)](_0x21b2b2); else { if (_0x50c2ce && INITIAL_CONFIG[_0x87f77b(0x18b)] && !_0x50c2ce['startsWith'](INITIAL_CONFIG[_0x87f77b(0x18b)])) { console['warn'](_0x87f77b(0x1e9) + _0x50c2ce + '\x27'); return; } _0x4d73b6 = new Session(_0x21b2b2), sessions[_0x87f77b(0x249)](_0x21b2b2, _0x4d73b6), _0x4d73b6[_0x87f77b(0x234)](); } }), _0x1272fd['on'](ServerEvent[_0x5af337(0x299)], ({ world: _0x1d0b22 }) => { const _0x4e86c9 = _0x5af337, _0x26ca1a = sessions[_0x4e86c9(0x216)](_0x1d0b22); if (_0x26ca1a) { sessions[_0x4e86c9(0x1c6)](_0x1d0b22); !pendingSessions[_0x4e86c9(0x21c)](_0x26ca1a['id']) && pendingSessions['set'](_0x26ca1a['id'], _0x26ca1a); if (_0x26ca1a[_0x4e86c9(0x247)]) clearTimeout(_0x26ca1a[_0x4e86c9(0x247)]); _0x26ca1a['pendingTimeout'] = setTimeout(() => { const _0x4f0844 = _0x4e86c9; pendingSessions[_0x4f0844(0x21c)](_0x26ca1a['id']) && _0x26ca1a['destroy'](_0x4f0844(0x23a)); }, 0x7530); } }), _0x1272fd['on'](ServerEvent[_0x5af337(0x205)], async ({ sender: _0x26c344, message: _0x41c090, world: _0x55aea9 }) => { const _0x3cf6b7 = _0x5af337, _0x4622c3 = sessions[_0x3cf6b7(0x216)](_0x55aea9); if (_0x4622c3) { const [_0x514a06, ..._0x1835db] = _0x41c090[_0x3cf6b7(0x276)]('\x20'); if (_0x4622c3[_0x3cf6b7(0x1a2)][_0x514a06]) await _0x4622c3[_0x3cf6b7(0x1a2)][_0x514a06](_0x55aea9, _0x26c344, _0x1835db); } }), _0x1272fd['on'](ServerEvent['PlayerLoad'], async ({ player: _0x2bb7c3, world: _0x44931e }) => { const _0x4ca902 = _0x5af337, _0x8d791 = sessions['get'](_0x44931e); _0x8d791 && (_0x8d791[_0x4ca902(0x196)]('参加:\x20' + _0x2bb7c3[_0x4ca902(0x21b)]), _0x8d791[_0x4ca902(0x1a4)][_0x4ca902(0x233)](_0x2bb7c3[_0x4ca902(0x21b)]), setTimeout(async () => { const _0x43d1d8 = _0x4ca902; try { const _0x4f9a0b = processName(_0x2bb7c3[_0x43d1d8(0x21b)]), { roomId: _0x5dc3ba, passwords: _0xf05900, config: _0x133963 } = _0x8d791, _0x32ac76 = _0x43d1d8(0x1ed) + _0x5dc3ba + _0x43d1d8(0x1c1) + _0x4f9a0b + 'です', _0x140f43 = _0x43d1d8(0x19c) + _0x5dc3ba + '\x0aYour\x20VCname\x20is\x20' + _0x4f9a0b; await _0x2bb7c3[_0x43d1d8(0x270)](_0x133963[_0x43d1d8(0x229)] === 'ja' ? _0x32ac76 : _0x140f43); if (_0x133963['password']) { if (!_0xf05900[_0x4f9a0b]) _0xf05900[_0x4f9a0b] = Math['floor'](0x3e8 + Math['random']() * 0x2328)[_0x43d1d8(0x2a1)](); const _0x5340c9 = _0x133963[_0x43d1d8(0x229)] === 'ja' ? _0x43d1d8(0x2ae) + _0xf05900[_0x4f9a0b] + 'です' : _0x43d1d8(0x2b8) + _0xf05900[_0x4f9a0b]; await _0x2bb7c3[_0x43d1d8(0x270)](_0x5340c9); } } catch (_0x32d5f3) { } }, 0x1f4)); }), _0x1272fd['on'](ServerEvent[_0x5af337(0x2c1)], ({ player: _0xb2938e, world: _0xca2070 }) => { const _0x2ca77e = _0x5af337, _0x2b56ef = sessions[_0x2ca77e(0x216)](_0xca2070); if (_0x2b56ef) { _0x2b56ef[_0x2ca77e(0x196)](_0x2ca77e(0x20d) + _0xb2938e[_0x2ca77e(0x21b)]); _0xb2938e[_0x2ca77e(0x21b)] === _0xca2070['localPlayer'][_0x2ca77e(0x21b)] && (_0x2b56ef[_0x2ca77e(0x196)]('Host\x20left.\x20Handing\x20stop\x20signal...'), _0x2b56ef['destroy'](_0x2ca77e(0x23a))); _0x2b56ef[_0x2ca77e(0x1a4)][_0x2ca77e(0x1c6)](_0xb2938e[_0x2ca77e(0x21b)]); const _0x5c006e = processName(_0xb2938e[_0x2ca77e(0x21b)]); delete _0x2b56ef[_0x2ca77e(0x228)][_0x5c006e], delete _0x2b56ef['dimensions'][_0x5c006e], delete _0x2b56ef['yRots'][_0x5c006e], delete _0x2b56ef['spectators'][_0x5c006e]; } }), _0x1272fd['on'](ServerEvent[_0x5af337(0x283)], ({ player: _0x5e6772, world: _0x4d915c }) => { const _0x335880 = _0x5af337, _0x2091b4 = sessions[_0x335880(0x216)](_0x4d915c); if (!_0x2091b4 || !_0x5e6772 || !_0x5e6772[_0x335880(0x2bf)]) return; const _0x218dc7 = processName(_0x5e6772['name']); _0x2091b4[_0x335880(0x228)][_0x218dc7] = { 'x': _0x5e6772['position']['x'], 'y': _0x5e6772[_0x335880(0x2bf)]['y'], 'z': _0x5e6772[_0x335880(0x2bf)]['z'] }; if (_0x5e6772[_0x335880(0x214)] !== undefined) _0x2091b4[_0x335880(0x25b)][_0x218dc7] = _0x5e6772[_0x335880(0x214)]; if (_0x5e6772[_0x335880(0x25e)] !== undefined) _0x2091b4[_0x335880(0x2b4)][_0x218dc7] = _0x5e6772['dimension']; }); if (!process['argv'][_0x5af337(0x1b9)](_0x5af337(0x189))) try { const _0x56ea6f = new Session(null, globalConfig); await _0x56ea6f['startWebSession'](), pendingSessions[_0x5af337(0x249)](_0x56ea6f['id'], _0x56ea6f); } catch (_0x487047) { console[_0x5af337(0x1d3)](_0x5af337(0x1d2), _0x487047); } else try { fs[_0x5af337(0x275)](_0x5af337(0x1fa), JSON[_0x5af337(0x1a7)]({ 'port': _0x1ca575, 'web_port': _0x1d7ffd }, null, 0x2)); } catch (_0x121567) { console[_0x5af337(0x1d3)](_0x5af337(0x22d), _0x121567); } } process['on'](_0x11ab8e(0x273), () => { const _0x5cac08 = _0x11ab8e; sessions[_0x5cac08(0x28f)](_0x592ee4 => _0x592ee4[_0x5cac08(0x2bc)]()), process['exit'](); }), main();