const _0x228674 = _0x3932; (function (_0x387158, _0x98baf9) { const _0x3d2d9a = _0x3932, _0x22adc2 = _0x387158(); while (!![]) { try { const _0x37c69d = parseInt(_0x3d2d9a(0x1cc)) / 0x1 * (parseInt(_0x3d2d9a(0x13f)) / 0x2) + parseInt(_0x3d2d9a(0x1ee)) / 0x3 * (parseInt(_0x3d2d9a(0x12a)) / 0x4) + parseInt(_0x3d2d9a(0x11b)) / 0x5 * (-parseInt(_0x3d2d9a(0x1bf)) / 0x6) + -parseInt(_0x3d2d9a(0x247)) / 0x7 + parseInt(_0x3d2d9a(0x10c)) / 0x8 * (parseInt(_0x3d2d9a(0x18a)) / 0x9) + -parseInt(_0x3d2d9a(0x1d0)) / 0xa * (parseInt(_0x3d2d9a(0x1eb)) / 0xb) + -parseInt(_0x3d2d9a(0x193)) / 0xc * (-parseInt(_0x3d2d9a(0x21c)) / 0xd); if (_0x37c69d === _0x98baf9) break; else _0x22adc2['push'](_0x22adc2['shift']()); } catch (_0x5edf83) { _0x22adc2['push'](_0x22adc2['shift']()); } } }(_0x16d6, 0xeb90f)); const { Server, ServerEvent, Player } = require(_0x228674(0x1a8)), WebSocket = require('ws'), fetch = require(_0x228674(0x20a)), wanakana = require(_0x228674(0x13c)), fs = require('fs'), fsPromises = require('fs')[_0x228674(0x170)], JSON5 = require('json5'), getPort = require(_0x228674(0x12d)), express = require('express'), http = require(_0x228674(0x235)), zlib = require(_0x228674(0x157)), msgpack = require(_0x228674(0x158)), { randomUUID } = require('crypto'); let sshHandler = null; try { fs['existsSync']('./tcpexposer/tcpexposer_handler.js') && (sshHandler = require(_0x228674(0x1d8))); } catch (_0x293678) { } const RELAY_SERVER_DOMAIN = _0x228674(0x1be), TIMEOUT_THRESHOLD = 0x3, INACTIVITY_TIMEOUT = 0x5 * 0x3c * 0x3e8, MAX_RUNTIME = 0x4 * 0x3c * 0x3c * 0x3e8, configCandidates = [_0x228674(0x205), './config.json5', _0x228674(0x241)]; let globalConfig = {}, configLoaded = ![], configPath = ''; for (const filePath of configCandidates) { if (fs[_0x228674(0x225)](filePath)) try { const fileContent = fs[_0x228674(0x243)](filePath, _0x228674(0x10d)); globalConfig = JSON5[_0x228674(0x14c)](fileContent), configLoaded = !![], configPath = filePath; break; } catch (_0xf108d6) { console['error']('[Config]\x20Error\x20parsing\x20' + filePath + ':', _0xf108d6['message']); } } !configLoaded && console['warn'](_0x228674(0x233)); function _0x16d6() { const _0x4fa07d = ['clientType', 'name', 'maxRuntimeTimeout', 'localhost', 'url', '近接VCを使用中です\x0aURL:https://mcproxvc.ovh/connect/\x0aルームIDは', '近接vcを無効にしました', 'position', 'enabled', 'commands', 'length', 'Verify\x20code\x20is\x20', '\x0a!help\x20でコマンド一覧を確認できます', '5766007hVMUlL', '\x0a\x20-\x20ディメンション毎にVCを分ける\x20(Dim):\x20', '\x0a!help\x20for\x20command\x20list', 'reason', '§a有効§r', 'use', '\x22\x5cs*:\x5cs*)(?:\x22.*?\x22|\x5cd+\x5c.?\x5cd*|true|false)', 'filter', 'true', 'existsSync', 'keys', 'Spectator\x27s\x20VC\x20separated\x20by\x20dimension', 'vcSshClient', 'userName', '認証コードを有効にしました', 'passwords', 'world', 'OPEN', '\x0aOutput:\x20', 'createServer', 'handleTcpUpgrade', '\x0aMax\x20Distance:\x20§e', 'Proximity\x20VC\x20enabled', '[Config]\x20No\x20configuration\x20file\x20found.\x20Using\x20default\x20settings.', 'wss://', 'http', 'success', 'createCommands', 'https://', 'json', 'value', 'roomId', 'concat', 'size', 'pvcSessionId', 'Unknown\x20World', 'config', './config.json', '§r\x0a認証コード\x20(Verify):\x20', 'readFileSync', 'Host-only\x20command\x20:\x20\x0a\x20!config\x20-\x20Show\x20current\x20settings\x0a\x20!lang\x20-\x20!lang\x20<ja/en>\x20言語の変更\x0a\x20!dis\x20-\x20!dis\x20<Number>\x20set\x20max\x20distance\x0a\x20!pvc\x20-\x20!pvc\x20<§atrue§r/§cfalse§r>\x20enable/disable\x20proximity\x20voice\x20chat', 'test', 'pvc:roomId=', '4324005LbvpPS', 'handleUpgrade', 'sendInitMessage', '\x0a=======================================================', 'loop', 'body', 'argv', '参加者はこのURLにアクセスしてください:', 'bindWorld', '\x0a声の届く距離：', '<近接VC>言語を日本語に設定しました', 'push', 'CONNECTING', '8ydGtwZ', 'utf8', '§c[MCBE\x20Prox\x20VC]\x20時間制限のため終了します。', 'stringify', 'server_info.json', '/api/stop_session', 'timestamp', 'リレーモードに切り替わりました。\x0aRoom\x20ID:\x20', 'resetTimer', 'init', 'stop', 'inactivityTimer', 'worldName', 'aliveSet', 'useResetTimer', '6990185SOiPvP', 'スペクテイターを共通のVCにしました', '<近接VC>', 'disconnect_command', 'Switched\x20to\x20relay\x20mode.\x0aRoom\x20ID:\x20', 'yRot', 'warn', '?clientType=server_script', '<Proximity\x20VC>Changed\x20max\x20distance\x20to\x20', 'proximity', 'Output\x20enabled', '参加:\x20', '[TCPExposer]\x20TCPExposerハンドラーが見つからないため、接続をスキップします。リレーサーバーを使用します。', 'playersNames', '[Auto-Stop][', '28Rvyvio', 'verify\x20code\x20disabled', 'relayed_vc_data', 'get-port', 'dimension', 'shift', 'yRots', '\x0a近接VC\x20(Proximity):\x20', 'next', '出力を無効にしました', 'victim', 'Buffer', 'partner_disconnected', 'data_update', '--------------------', 'ws://127.0.0.1:', 'initialization', 'です\x0aあなたのVCnameは', 'wanakana', '=======================================================\x0a', 'pvc:', '63598JUXTZb', 'Spectator\x20set\x20to\x20common\x20VC', '§c無効§r', 'positions', '\x20Error:', 'distance', '§l[Current\x20Settings]§r\x0aLanguage:\x20', 'setupVcRelayListeners', 'run_command', '\x1b[36m[Info]\x1b[0m\x20socket-beサーバーのポート:\x20', 'logInfo', 'log', 'destroy', 'parse', 'map', 'values', 'getAllTags', 'Proximity\x20Voice\x20Chat\x20Gateway\x20Active', 'localPlayer', 'Spectator\x20and\x20VC\x20separated', 'details', 'Session\x20destroying...\x20Reason:\x20', 'Session\x20not\x20found\x20for\x20this\x20domain', 'split', 'zlib', 'msgpack-lite', '<Proximity\x20VC>Language\x20set\x20to\x20English', 'toString', 'testfor\x20@a[tag=pvc:req_cmd]', '接続を開始しました\x0a近接vc：', 'message', '接続開始', 'Command\x20list:\x0a\x20!help\x20-\x20show\x20help\x0a\x20!name\x20-\x20check\x20your\x20VC\x20GamerTag', 'https://mcproxvc.ovh/connect/?roomid=', 'Pending\x20Session', 'Proximity\x20VC\x20disabled', 'スペクテイター同士の会話を共通にしました', 'connectCommand', 'close', 'stop_roop', 'WorldRemove', '\x0aProximity\x20VC:\x20', 'trim', '[Connection]\x20Rejected\x20connection\x20for\x20domain\x20\x27', 'players', 'startWebSession', '/connect\x20', 'relayWs', 'Error\x20handling\x20world\x20loop\x20[', 'promises', 'Using\x20Proximity\x20Voice\x20Chat\x0aURL:https://mcproxvc.ovh/connect/\x0aRoomID\x20is\x20', 'includes', 'forEach', '[Local\x20Client\x20Error]\x20', '<近接VC>声の最大距離を', 'URL:https://mcproxvc.ovh/connect/\x0aルームIDは', '\x20!output\x20-\x20!output\x20<§atrue§r/§cfalse§r>\x20minecraftチャットへの出力を有効/無効にできます\x0a\x20!verify\x20-\x20!verify\x20<§atrue§r/§cfalse§r>\x20認証コードを有効/無効にできます\x0a\x20!spectator\x20-\x20!spectator\x20<§atrue§r/§cfalse§r>\x20スペクテイターとVCを分けます', 'host', '§cDisabled§r', 'gunzipSync', 'dataUpdate', 'sshClient', 'lang', 'querytarget\x20@e[type=player]', 'startTimer', 'に変更しました', 'processTagCommands', 'Connection\x20started\x0aProximity\x20voice\x20chat:', 'WorldAdd', 'mcSshClient', '\x22]\x20remove\x20\x22', 'startsWith', 'verify\x20code\x20enabled', 'listen', 'testfor\x20@a[m=spectator]', '709326HDbJTU', 'sub_domain', 'PlayerLoad', ']\x1b[0m\x20', 'スペクテイター同士の会話をディメンションごとに分けました', 'list', 'string', '[Standalone]\x20Failed\x20to\x20start\x20session:', '\x0aMax\x20distance:', '72NMtPup', 'statusMessage', 'indexOf', 'spectator', 'output', 'web_port', 'headers', 'localClient', 'partner_connected', 'tag\x20@s\x20add\x20\x22pvc:roomId=', 'encode', '\x0aSpectator\x20Split:\x20', 'directVcClients', 'password', 'tag\x20@a[tag=\x22', 'now', 'sshError', 'all', 'data', 'vc_connected', 'port', './lib/server', 'pendingTimeout', 'specListen', 'spectatorSet', 'type', 'sendMessage', 'floor', 'add', 'localClientBuffer', 'from', 'setupMcRelayListeners', 'exit', 'has', 'spectators', 'random', 'mc_connected', 'Minecraftから以下のコマンドで接続してください:', 'minecraft', '[Relay]\x20Connected\x20(ID:\x20', 'find', '\x0a最大距離\x20(Distance):\x20§e', 'runCommand', 'mcproxvc.fly.dev', '6hGxEFp', 'error', 'get', '認証コードは', 'disabled', 'Participants\x20should\x20access\x20this\x20URL', 'replace', '\x0aYour\x20VCname\x20is\x20', '§r\x0aVerify\x20Code:\x20', 'action', 'startTcpexposer', 'Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:', 'ホスト専用コマンド：\x0a\x20!config\x20-\x20現在の設定一覧を表示します\x0a\x20!lang\x20-\x20!lang\x20<ja/en>\x20lang\x20change\x0a\x20!dis\x20-\x20!dis\x20<数値>\x20声の届く距離を変更できます\x0a\x20!pvc\x20-\x20!pvc\x20<§atrue§r/§cfalse§r>\x20近接vcを有効/無効にできます', '38wbNNMd', 'set', 'active', 'ended', '10CbKrNT', 'timeout', ']\x20最大稼働時間に達しました。', 'substring', 'useRelay', 'finally', 'tag\x20@a\x20list', 'decode', './tcpexposer/tcpexposer_handler.js', 'status', '出力を有効にしました', 'Failed\x20to\x20write\x20server_info.json:', 'verify', '\x20!output\x20-\x20!output\x20<§atrue§r/§cfalse§r>\x20enable/disable\x20information\x20output\x20to\x20minecraft\x20chat\x0a\x20!verify\x20-\x20!verify\x20<§atrue§r/§cfalse§r>\x20enable/disable\x20verify\x20code\x0a\x20!spectator\x20-\x20!spectator\x20<§atrue§r/§cfalse§r>\x20separate\x20spectator\x20and\x20VC', 'upgrade', 'function', 'round', 'dimensions', 'testfor\x20@a', 'testfor\x20@e[type=player]', 'post', 'isProcessingTags', 'connectToRelayServer', 'processName', 'send', 'consecutiveTimeouts', 'shouldBroadcast', '18678363qZqxEn', '--streamlit', 'specDim', '312966qJvUkK', '\x0a出力\x20(Output):\x20', 'statusCode', 'パスワードは', 'Spectator\x27s\x20VC\x20set\x20to\x20common\x20in\x20all\x20dimensions', '[VC\x20Relay]', 'delete', 'entries', '\x1b[33m[Log][', '近接vcを有効にしました', 'handleDirectVcConnection', 'catch', 'then', '\x1b[36m[Info]\x1b[0m\x20Webサーバーのポート:\x20', 'Host\x20left.\x20Handing\x20stop\x20signal...', 'readyState', 'sendInitialPayload', '\x0a\x20-\x20Spectator\x20Dimension:\x20', '認証コードを無効にしました', '§c[MCBE\x20Prox\x20VC]\x20Time\x20limit\x20reached.', 'isBuffer', 'nameCache', '§l[現在の設定一覧]§r\x0a言語\x20(Lang):\x20', './config.jsonc', 'Tag\x20processing\x20error:', 'スペクテイターとVCを分けました', 'onlinePlayers', '/room/', 'node-fetch', 'broadcastPositions', 'writeFile', 'tag\x20@a\x20remove\x20\x22', 'cleanOldTags']; _0x16d6 = function () { return _0x4fa07d; }; return _0x16d6(); } const DEFAULT_CONFIG = { 'app_id': '', 'secret_key': '', 'username': '', 'sub_domain': '', 'ssh_password': '', 'port': 0x4abc, 'web_port': 0x1f40, 'proximity': !![], 'spectator': !![], 'specListen': !![], 'specDim': ![], 'password': ![], 'verify': undefined, 'output': !![], 'distance': 0xa, 'lang': 'en' }, INITIAL_CONFIG = { ...DEFAULT_CONFIG, ...globalConfig }; function _0x3932(_0x55ad25, _0x4af31f) { _0x55ad25 = _0x55ad25 - 0x106; const _0x16d653 = _0x16d6(); let _0x393255 = _0x16d653[_0x55ad25]; return _0x393255; } INITIAL_CONFIG['password'] = INITIAL_CONFIG[_0x228674(0x1dc)] ?? INITIAL_CONFIG[_0x228674(0x1a0)]; async function updateConfigFile(_0x4c4080, _0x1280df) { const _0x574c96 = _0x228674; if (!configPath) return; try { let _0x1b4bfb = await fsPromises['readFile'](configPath, 'utf8'); const _0x1ed7ff = new RegExp('(\x22' + _0x4c4080 + _0x574c96(0x222)), _0x4febb2 = typeof _0x1280df === _0x574c96(0x190) ? '\x22' + _0x1280df + '\x22' : _0x1280df, _0x103d47 = _0x1b4bfb[_0x574c96(0x1c5)](_0x1ed7ff, '$1' + _0x4febb2); _0x103d47 !== _0x1b4bfb && await fsPromises[_0x574c96(0x20c)](configPath, _0x103d47, _0x574c96(0x10d)); } catch (_0x422607) { console[_0x574c96(0x1c0)]('❌\x20設定ファイルの更新に失敗しました:', _0x422607); } }; const makeRange = (_0x3fa138, _0x28304a) => Array[_0x228674(0x1b1)]({ 'length': _0x28304a - _0x3fa138 + 0x1 }, (_0x218983, _0x591059) => _0x3fa138 + _0x591059); let globalGatewayServer = null; async function startTcpexposer(_0x4a2d1d, _0x7a9494, _0x462d36) { const _0x63af7f = _0x228674; return sshHandler && typeof sshHandler[_0x63af7f(0x1c9)] === _0x63af7f(0x1df) ? await sshHandler[_0x63af7f(0x1c9)](_0x4a2d1d, _0x7a9494, _0x462d36) : (_0x4a2d1d[_0x63af7f(0x149)](_0x63af7f(0x127)), _0x4a2d1d[_0x63af7f(0x23b)] = '', await _0x4a2d1d[_0x63af7f(0x1e6)]('mc'), null); } function setupGlobalVcWebSocket(_0x2b02e0) { const _0x332e51 = _0x228674; if (globalGatewayServer) return; const _0x1df411 = express(), _0x2c9aeb = http[_0x332e51(0x22f)](_0x1df411), _0x2c57f9 = new WebSocket['Server']({ 'noServer': !![] }); _0x1df411[_0x332e51(0x221)](express['json']()), _0x1df411['post']('/', (_0x499d0c, _0xacc1ee) => { const _0x3c59c8 = _0x332e51, { type: _0x5e83ac } = _0x499d0c[_0x3c59c8(0x24c)], _0x3ae003 = _0x499d0c[_0x3c59c8(0x199)][_0x3c59c8(0x178)]; let _0x36f830 = null; if (_0x3ae003) { for (const _0x6bbbc3 of sessions[_0x3c59c8(0x14e)]()) { const _0x1a9be1 = _0x6bbbc3[_0x3c59c8(0x240)][_0x3c59c8(0x18b)]; if (_0x1a9be1 && _0x3ae003['startsWith'](_0x1a9be1)) { _0x36f830 = _0x6bbbc3; break; } } if (!_0x36f830) for (const _0xddd591 of pendingSessions['values']()) { const _0x4299ff = _0xddd591[_0x3c59c8(0x240)][_0x3c59c8(0x18b)]; if (_0x4299ff && _0x3ae003['startsWith'](_0x4299ff)) { _0x36f830 = _0xddd591; break; } } } if (_0x36f830) { if (_0x5e83ac === _0x3c59c8(0x137)) _0x36f830[_0x3c59c8(0x17b)](_0x499d0c[_0x3c59c8(0x24c)]); else { if (_0x5e83ac === _0x3c59c8(0x11e)) _0x36f830['destroy']('success'); } _0x5e83ac === _0x3c59c8(0x13a) ? (_0x36f830[_0x3c59c8(0x1a6)] = !![], _0x36f830[_0x3c59c8(0x149)](_0x3c59c8(0x15e)), _0xacc1ee[_0x3c59c8(0x1d9)](0xc8)[_0x3c59c8(0x239)]({ 'type': 'initialization', 'roomId': _0x36f830[_0x3c59c8(0x23b)], 'ws_connected': _0x36f830[_0x3c59c8(0x1b7)], ..._0x36f830['config'] })) : _0xacc1ee[_0x3c59c8(0x1d9)](0xc8)[_0x3c59c8(0x239)]({ 'success': !![] }); } else _0xacc1ee[_0x3c59c8(0x1d9)](0x194)[_0x3c59c8(0x239)]({ 'error': _0x3c59c8(0x155) }); }), _0x1df411[_0x332e51(0x1c1)]('/', (_0x57a43d, _0x5af427) => { const _0x43901e = _0x332e51; _0x5af427['send'](_0x43901e(0x150)); }), _0x2c9aeb['on'](_0x332e51(0x1de), (_0x313946, _0x504f7a, _0x589fb8) => { const _0x59e28d = _0x332e51; let _0x1aa437 = null, _0x4a0693 = null; try { const _0x448eaf = _0x313946[_0x59e28d(0x199)][_0x59e28d(0x178)] || _0x59e28d(0x212); let _0xd3ad27 = _0x313946[_0x59e28d(0x213)] || '/'; if (_0xd3ad27 === '//') _0xd3ad27 = '/'; _0x4a0693 = new URL(_0xd3ad27, 'http://' + _0x448eaf), _0x1aa437 = _0x4a0693['searchParams']['get']('clientType'); } catch (_0x171b5c) { _0x1aa437 = null; } _0x1aa437 !== 'vc' ? sshHandler && typeof sshHandler[_0x59e28d(0x230)] === _0x59e28d(0x1df) ? sshHandler[_0x59e28d(0x230)](_0x313946, _0x504f7a, _0x589fb8, INITIAL_CONFIG[_0x59e28d(0x1a7)]) : _0x504f7a[_0x59e28d(0x14b)]() : _0x2c57f9[_0x59e28d(0x248)](_0x313946, _0x504f7a, _0x589fb8, _0x333646 => { const _0x1d1e5c = _0x59e28d, _0x836b46 = _0x313946[_0x1d1e5c(0x199)][_0x1d1e5c(0x178)]; let _0x2c70af = null; if (_0x836b46) { for (const _0x2eb8ca of sessions[_0x1d1e5c(0x14e)]()) { const _0x42e7dc = _0x2eb8ca[_0x1d1e5c(0x240)]['sub_domain']; if (_0x42e7dc && _0x836b46[_0x1d1e5c(0x186)](_0x42e7dc)) { _0x2c70af = _0x2eb8ca; break; } } if (!_0x2c70af) for (const _0x41c5a6 of pendingSessions[_0x1d1e5c(0x14e)]()) { const _0x3edfac = _0x41c5a6[_0x1d1e5c(0x240)]['sub_domain']; if (_0x3edfac && _0x836b46[_0x1d1e5c(0x186)](_0x3edfac)) { _0x2c70af = _0x41c5a6; break; } } } if (_0x2c70af) _0x2c70af[_0x1d1e5c(0x1f8)](_0x333646); else { const _0x9a8874 = sessions[_0x1d1e5c(0x14e)]()[_0x1d1e5c(0x132)]()[_0x1d1e5c(0x23a)] || pendingSessions['values']()['next']()[_0x1d1e5c(0x23a)]; if (_0x9a8874) _0x9a8874[_0x1d1e5c(0x1f8)](_0x333646); else _0x333646[_0x1d1e5c(0x165)](); } }); }), _0x2c9aeb[_0x332e51(0x188)](_0x2b02e0, () => { }), globalGatewayServer = _0x2c9aeb; }; class Session { constructor(_0xd45888, _0xdcab00 = {}) { const _0x3879b0 = _0x228674; this['id'] = randomUUID(), this['world'] = _0xd45888, this[_0x3879b0(0x118)] = _0xd45888 ? _0xd45888[_0x3879b0(0x210)] || 'Unknown\x20World' : _0x3879b0(0x161), this[_0x3879b0(0x203)] = new Map(), this[_0x3879b0(0x240)] = { ...INITIAL_CONFIG, ..._0xdcab00 }, this[_0x3879b0(0x23b)] = this[_0x3879b0(0x240)][_0x3879b0(0x18b)], this['connectCommand'] = '', this['passwords'] = {}, this[_0x3879b0(0x142)] = {}, this[_0x3879b0(0x130)] = {}, this[_0x3879b0(0x1e1)] = {}, this['spectators'] = {}, this[_0x3879b0(0x208)] = new Set(), this[_0x3879b0(0x1ea)] = !![], this[_0x3879b0(0x1a6)] = ![], this[_0x3879b0(0x1b7)] = ![], this[_0x3879b0(0x166)] = ![], this['useRelay'] = ![], this['useResetTimer'] = ![], this[_0x3879b0(0x16e)] = null, this['localClient'] = null, this['directVcClients'] = new Set(), this[_0x3879b0(0x17c)] = null, this[_0x3879b0(0x1a3)] = null, this[_0x3879b0(0x117)] = null, this[_0x3879b0(0x1e9)] = 0x0, this[_0x3879b0(0x1a9)] = null, this['commands'] = this['createCommands'](); } [_0x228674(0x149)](_0x29a3eb) { const _0x187651 = _0x228674; console['log']('\x1b[36m[Info][' + this['id'][_0x187651(0x1d3)](0x0, 0x6) + _0x187651(0x18d) + _0x29a3eb); } ['logLog'](_0x28c141) { const _0x54f605 = _0x228674; console[_0x54f605(0x14a)](_0x54f605(0x1f6) + this['id'][_0x54f605(0x1d3)](0x0, 0x6) + _0x54f605(0x18d) + _0x28c141); } ['processName'](_0x45ee24) { const _0x2bc982 = _0x228674; if (!this['nameCache']['has'](_0x45ee24)) { const _0x5c446e = wanakana['toRomaji'](_0x45ee24[_0x2bc982(0x1c5)](/ /g, '_'))[_0x2bc982(0x1c5)](/n'/g, 'n'); this[_0x2bc982(0x203)][_0x2bc982(0x1cd)](_0x45ee24, _0x5c446e); } return this[_0x2bc982(0x203)][_0x2bc982(0x1c1)](_0x45ee24); } [_0x228674(0x1f8)](_0x192dea) { const _0x5a5800 = _0x228674; this[_0x5a5800(0x19f)]['add'](_0x192dea), this[_0x5a5800(0x1a6)] = !![], this['sendInitialPayload'](_0x192dea), _0x192dea['on'](_0x5a5800(0x15d), async _0x2f2c80 => { const _0x51fc63 = _0x5a5800; try { let _0xd1a475; try { _0xd1a475 = msgpack[_0x51fc63(0x1d7)](_0x2f2c80); } catch (_0x426875) { try { _0xd1a475 = JSON['parse'](_0x2f2c80); } catch (_0x2e0de5) { } } if (_0xd1a475) { if (_0xd1a475[_0x51fc63(0x229)] && _0xd1a475[_0x51fc63(0x216)]) this['positions'][_0xd1a475[_0x51fc63(0x229)]] = _0xd1a475['position']; if (_0xd1a475[_0x51fc63(0x1c8)] === _0x51fc63(0x147) && typeof _0xd1a475[_0x51fc63(0x23a)] === _0x51fc63(0x190)) { if (this[_0x51fc63(0x22c)]) { const _0x2e9a1b = await this[_0x51fc63(0x22c)][_0x51fc63(0x1bd)](_0xd1a475[_0x51fc63(0x23a)]); _0x192dea[_0x51fc63(0x1e8)](JSON[_0x51fc63(0x10f)]({ 'type': 'command_result', 'payload': _0x2e9a1b })); } } } } catch (_0x5bfdca) { } }), _0x192dea['on']('close', () => { const _0x2b729b = _0x5a5800; this[_0x2b729b(0x19f)]['delete'](_0x192dea); }); } async[_0x228674(0x16c)]() { const _0xfef89 = _0x228674, { sub_domain: _0x45341b, username: _0x3cb0ec, ssh_password: _0x41400b } = this[_0xfef89(0x240)]; _0x3cb0ec && _0x41400b && _0x45341b ? this[_0xfef89(0x17c)] = await startTcpexposer(this, _0x45341b, INITIAL_CONFIG[_0xfef89(0x198)]) : (this[_0xfef89(0x23b)] = '', await this[_0xfef89(0x1e6)]('mc')); } ['bindWorld'](_0x139172) { const _0x272a53 = _0x228674; this[_0x272a53(0x1a9)] && (clearTimeout(this[_0x272a53(0x1a9)]), this['pendingTimeout'] = null), this[_0x272a53(0x22c)] = _0x139172, this['worldName'] = _0x139172[_0x272a53(0x210)] || _0x272a53(0x23f), this[_0x272a53(0x115)](); } async[_0x228674(0x115)]() { const _0x31442e = _0x228674; if (!this['world'] && !this['pendingTimeout']) return; if (!this[_0x31442e(0x1d4)] && !this[_0x31442e(0x17c)]) { const { sub_domain: _0x20be57, username: _0x1605c1, ssh_password: _0x24161d } = this[_0x31442e(0x240)]; if (_0x1605c1 && _0x24161d && _0x20be57) { this[_0x31442e(0x17c)] = await startTcpexposer(this, _0x20be57, INITIAL_CONFIG[_0x31442e(0x198)]); if (!this[_0x31442e(0x17c)]) { if (!this[_0x31442e(0x1d4)]) await this[_0x31442e(0x1e6)]('mc'); } } else { if (!_0x20be57) await this[_0x31442e(0x1e6)]('mc'); } } this[_0x31442e(0x1b7)] = !![], this['stop_roop'] = ![], this[_0x31442e(0x149)](_0x31442e(0x15e)); if (this[_0x31442e(0x22c)]) { try { await this['cleanOldTags'](), this[_0x31442e(0x22c)]['runCommand'](_0x31442e(0x19c) + this[_0x31442e(0x23b)] + '\x22'), this[_0x31442e(0x249)](); } catch (_0x12eac7) { } this[_0x31442e(0x24b)](); } } async[_0x228674(0x20e)]() { const _0x4f0ad4 = _0x228674; if (!this[_0x4f0ad4(0x22c)]) return; try { const _0x1d784b = await this[_0x4f0ad4(0x14f)](); for (const _0x18303e of _0x1d784b) { await this[_0x4f0ad4(0x22c)][_0x4f0ad4(0x1bd)](_0x4f0ad4(0x1a1) + _0x18303e + _0x4f0ad4(0x185) + _0x18303e + '\x22'); } const _0x3477d6 = await this[_0x4f0ad4(0x22c)][_0x4f0ad4(0x1bd)](_0x4f0ad4(0x1e2)); this[_0x4f0ad4(0x208)]['clear'](); if (_0x3477d6[_0x4f0ad4(0x134)]) _0x3477d6[_0x4f0ad4(0x134)]['forEach'](_0x4b60c9 => this[_0x4f0ad4(0x208)][_0x4f0ad4(0x1af)](_0x4b60c9)); } catch (_0x352d88) { } } [_0x228674(0x249)]() { const _0x549378 = _0x228674; if (!this[_0x549378(0x22c)]) return; const { proximity: _0x29d615, distance: _0xa1aa8f, lang: _0x5baf5e } = this[_0x549378(0x240)]; if (_0x5baf5e == 'ja') { let _0x547073 = _0x29d615 ? '有効' : '無効'; this[_0x549378(0x22c)][_0x549378(0x1ad)](_0x549378(0x15c) + _0x547073 + _0x549378(0x108) + _0xa1aa8f + _0x549378(0x21b))['catch'](_0x4bfafe => { }); } else { let _0x347608 = _0x29d615 ? 'enabled' : 'disabled'; this[_0x549378(0x22c)]['sendMessage'](_0x549378(0x182) + _0x347608 + _0x549378(0x192) + _0xa1aa8f + _0x549378(0x21e))[_0x549378(0x1f9)](_0x38b768 => { }); } } [_0x228674(0x114)]() { const _0x134236 = _0x228674; this['useResetTimer'] = !![], clearTimeout(this[_0x134236(0x117)]), this['inactivityTimer'] = setTimeout(() => { const _0x2b6a19 = _0x134236; this[_0x2b6a19(0x14b)](_0x2b6a19(0x1d1)); }, INACTIVITY_TIMEOUT); } [_0x228674(0x17f)]() { const _0x4c4004 = _0x228674; if (this['maxRuntimeTimeout']) return; this[_0x4c4004(0x211)] = setTimeout(() => { const _0x365bff = _0x4c4004; if (this[_0x365bff(0x22c)]) this['world'][_0x365bff(0x1ad)](this[_0x365bff(0x240)][_0x365bff(0x17d)] === 'ja' ? _0x365bff(0x10e) : _0x365bff(0x201))[_0x365bff(0x1f9)](() => { }); console[_0x365bff(0x14a)](_0x365bff(0x24a)), console[_0x365bff(0x14a)](_0x365bff(0x129) + this[_0x365bff(0x118)] + _0x365bff(0x1d2)), console['log'](_0x365bff(0x13d)), setTimeout(() => this['destroy'](_0x365bff(0x1d1)), 0x1388); }, MAX_RUNTIME), this[_0x4c4004(0x114)](); } async[_0x228674(0x24b)]() { const _0x379367 = _0x228674; if (this[_0x379367(0x166)] || !this[_0x379367(0x22c)]) return; try { if (this[_0x379367(0x11a)]) this['resetTimer'](); let _0x41739c = { 'playersNames': [], 'aliveSet': new Set(), 'spectatorSet': new Set(), 'details': [] }, _0x51da3a = { 'statusCode': -0x1 }; if (this['config']['proximity']) { const [_0xd82d9d, _0x1f0b0e, _0x5bd20f, _0x1de913, _0x51bf9d] = await Promise['all']([this['world'][_0x379367(0x1bd)](_0x379367(0x18f)), this[_0x379367(0x22c)]['runCommand'](_0x379367(0x1e3)), this[_0x379367(0x22c)]['runCommand'](_0x379367(0x189)), this[_0x379367(0x22c)][_0x379367(0x1bd)](_0x379367(0x17e)), this[_0x379367(0x22c)][_0x379367(0x1bd)](_0x379367(0x15b))]); _0x51da3a = _0x51bf9d; if (_0xd82d9d['statusCode'] <= -0x1) { this[_0x379367(0x1e9)]++; if (this[_0x379367(0x1e9)] >= TIMEOUT_THRESHOLD) { this[_0x379367(0x14b)](_0x379367(0x236)); return; } } else this[_0x379367(0x1e9)] = 0x0; _0xd82d9d['statusCode'] === 0x0 && typeof _0xd82d9d[_0x379367(0x16b)] === 'string' && (_0x41739c[_0x379367(0x128)] = _0xd82d9d[_0x379367(0x16b)][_0x379367(0x156)](',')[_0x379367(0x14d)](_0x293ab3 => _0x293ab3[_0x379367(0x169)]())[_0x379367(0x223)](_0x90d1ec => _0x90d1ec['length'] > 0x0)); if (_0x1f0b0e[_0x379367(0x134)]) _0x1f0b0e['victim']['forEach'](_0x107713 => _0x41739c[_0x379367(0x119)]['add'](_0x107713)); if (_0x5bd20f[_0x379367(0x134)]) _0x5bd20f['victim']['forEach'](_0x45328f => _0x41739c[_0x379367(0x1ab)]['add'](_0x45328f)); try { _0x41739c[_0x379367(0x153)] = JSON[_0x379367(0x14c)](_0x1de913[_0x379367(0x153)] || '[]'); } catch (_0x581c24) { _0x41739c[_0x379367(0x153)] = []; } } else { const [_0x3d7a38, _0x51da22] = await Promise[_0x379367(0x1a4)]([this['world'][_0x379367(0x1bd)]('list'), this[_0x379367(0x22c)][_0x379367(0x1bd)](_0x379367(0x15b))]); _0x51da3a = _0x51da22; if (_0x3d7a38[_0x379367(0x1f0)] <= -0x1) { this[_0x379367(0x1e9)]++; if (this[_0x379367(0x1e9)] >= TIMEOUT_THRESHOLD) { this[_0x379367(0x14b)](_0x379367(0x236)); return; } } else this[_0x379367(0x1e9)] = 0x0; } const _0x151d13 = Array[_0x379367(0x1b1)](_0x41739c[_0x379367(0x119)]); _0x41739c['playersNames'][_0x379367(0x173)](_0x3e3350 => { const _0x5bb3be = _0x379367, _0x92e774 = this[_0x5bb3be(0x1e7)](_0x3e3350), _0x5b20de = _0x41739c[_0x5bb3be(0x1ab)][_0x5bb3be(0x1b4)](_0x3e3350); this[_0x5bb3be(0x1b5)][_0x92e774] = _0x5b20de; if (!this['config'][_0x5bb3be(0x124)]) this[_0x5bb3be(0x142)][_0x92e774] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; else { if (!_0x41739c[_0x5bb3be(0x119)][_0x5bb3be(0x1b4)](_0x3e3350)) this[_0x5bb3be(0x142)][_0x92e774] = { 'x': 0x0, 'y': 0x4e20, 'z': 0x0 }; else { if (this[_0x5bb3be(0x240)][_0x5bb3be(0x196)] && _0x5b20de) { if (this[_0x5bb3be(0x240)]['specListen'] === !![]) { const _0x120eba = _0x151d13['indexOf'](_0x3e3350); if (_0x120eba !== -0x1 && _0x41739c[_0x5bb3be(0x153)][_0x120eba]) { this[_0x5bb3be(0x142)][_0x92e774] = _0x41739c[_0x5bb3be(0x153)][_0x120eba][_0x5bb3be(0x216)]; if (this[_0x5bb3be(0x240)][_0x5bb3be(0x1ed)] === !![]) this[_0x5bb3be(0x1e1)][_0x92e774] = _0x41739c[_0x5bb3be(0x153)][_0x120eba][_0x5bb3be(0x12e)]; } else this[_0x5bb3be(0x142)][_0x92e774] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; } else this[_0x5bb3be(0x142)][_0x92e774] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; } else { const _0x301696 = _0x151d13[_0x5bb3be(0x195)](_0x3e3350); if (_0x301696 !== -0x1 && _0x41739c['details'][_0x301696]) this['positions'][_0x92e774] = _0x41739c['details'][_0x301696]['position'], this[_0x5bb3be(0x130)][_0x92e774] = _0x41739c[_0x5bb3be(0x153)][_0x301696][_0x5bb3be(0x120)], this[_0x5bb3be(0x1e1)][_0x92e774] = _0x41739c[_0x5bb3be(0x153)][_0x301696][_0x5bb3be(0x12e)]; else this['positions'][_0x92e774] = { 'x': 0x0, 'y': 0x7530, 'z': 0x0 }; } } } }), this['shouldBroadcast'] = !![], this[_0x379367(0x20b)](); if (_0x51da3a[_0x379367(0x1f0)] === 0x0 && !this['isProcessingTags']) { this['isProcessingTags'] = !![]; const _0xbc2e57 = _0x51da3a['victim'][0x0]; this[_0x379367(0x181)](_0xbc2e57)[_0x379367(0x1f9)](_0x2cdeac => { const _0x14a44c = _0x379367; console[_0x14a44c(0x1c0)](_0x14a44c(0x206), _0x2cdeac); })[_0x379367(0x1d5)](() => { const _0x11678c = _0x379367; this[_0x11678c(0x1e5)] = ![]; }); } } catch (_0x1a4cb3) { console[_0x379367(0x1c0)](_0x379367(0x16f) + this[_0x379367(0x118)] + ']:', _0x1a4cb3); } if (!this[_0x379367(0x166)]) setTimeout(() => this[_0x379367(0x24b)](), 0x0); } async[_0x228674(0x181)](_0x59941c) { const _0x4c859d = _0x228674, _0x31a99c = await this[_0x4c859d(0x22c)]['runCommand']('tag\x20@a[tag=pvc:req_cmd]\x20list'); if (_0x31a99c['statusCode'] === 0x0 && _0x31a99c[_0x4c859d(0x194)]) { let _0x407976 = []; const _0x1e5bd1 = new Player(this[_0x4c859d(0x22c)], _0x59941c), _0x42bd73 = _0x31a99c[_0x4c859d(0x194)][_0x4c859d(0x156)](/\r\n|\n|\r/); for (const _0x44461f of _0x42bd73) { if (!_0x44461f['trim']()) continue; const _0x4ce72f = _0x44461f['replace'](/§./g, ''), _0x4fa045 = _0x4ce72f[_0x4c859d(0x195)](':'); _0x4fa045 !== -0x1 && (_0x407976 = _0x407976[_0x4c859d(0x23c)](_0x4ce72f[_0x4c859d(0x1d3)](_0x4fa045 + 0x1)['split'](',')[_0x4c859d(0x14d)](_0x2a1e5d => _0x2a1e5d[_0x4c859d(0x169)]())['filter'](_0x93e59 => _0x93e59['startsWith'](_0x4c859d(0x13e))))); for (const _0x270f30 of _0x407976) { if (_0x270f30 === 'pvc:req_cmd' || _0x270f30[_0x4c859d(0x186)](_0x4c859d(0x246))) continue; const _0x4dc768 = _0x270f30['startsWith'](_0x4c859d(0x13e)) ? _0x270f30['substring'](_0x4c859d(0x13e)[_0x4c859d(0x219)]) : _0x270f30; let [_0x40f941, ..._0xbc4275] = _0x4dc768[_0x4c859d(0x156)](':'); _0x40f941 = '!' + _0x40f941, this[_0x4c859d(0x218)][_0x40f941] && (await this['commands'][_0x40f941](this[_0x4c859d(0x22c)], _0x1e5bd1, _0xbc4275), this['world']['runCommand'](_0x4c859d(0x20d) + _0x270f30 + '\x22')); } } await this[_0x4c859d(0x22c)][_0x4c859d(0x1bd)]('tag\x20@a[tag=pvc:req_cmd]\x20remove\x20pvc:req_cmd'); } } async[_0x228674(0x14f)]() { const _0x11892c = _0x228674; if (!this[_0x11892c(0x22c)]) return []; try { const _0x466769 = await this['world'][_0x11892c(0x1bd)](_0x11892c(0x1d6)); if (_0x466769[_0x11892c(0x1f0)] !== 0x0 || !_0x466769['statusMessage']) return []; let _0x382704 = []; const _0x1a4483 = _0x466769[_0x11892c(0x194)][_0x11892c(0x156)](/\r\n|\n|\r/); for (const _0x2b48b5 of _0x1a4483) { if (!_0x2b48b5[_0x11892c(0x169)]()) continue; const _0x1fbbda = _0x2b48b5[_0x11892c(0x1c5)](/§./g, ''), _0x2af178 = _0x1fbbda[_0x11892c(0x195)](':'); _0x2af178 !== -0x1 && (_0x382704 = _0x382704[_0x11892c(0x23c)](_0x1fbbda[_0x11892c(0x1d3)](_0x2af178 + 0x1)[_0x11892c(0x156)](',')['map'](_0x459795 => _0x459795[_0x11892c(0x169)]())[_0x11892c(0x223)](_0x12aed6 => _0x12aed6[_0x11892c(0x186)]('pvc:')))); } return _0x382704; } catch (_0xd8697e) { return []; } } ['broadcastPositions']() { const _0x199643 = _0x228674; if (!this['shouldBroadcast']) return; const _0x37a6aa = {}; for (const [_0x2d8c9c, _0x57d038] of Object[_0x199643(0x1f5)](this[_0x199643(0x142)])) { if (_0x57d038) _0x37a6aa[_0x2d8c9c] = [Math[_0x199643(0x1e0)](_0x57d038['x'] * 0x64) / 0x64, Math[_0x199643(0x1e0)](_0x57d038['y'] * 0x64) / 0x64, Math[_0x199643(0x1e0)](_0x57d038['z'] * 0x64) / 0x64]; } const _0xb920bc = { 'spec': this[_0x199643(0x240)][_0x199643(0x196)], 'spLis': this[_0x199643(0x240)][_0x199643(0x1aa)], 'spDim': this[_0x199643(0x240)][_0x199643(0x1ed)], 't': 'wu', 'pos': _0x37a6aa, 'dis': this['config'][_0x199643(0x144)], 'pssws': this[_0x199643(0x22b)], 'dim': this[_0x199643(0x1e1)], 'yr': this[_0x199643(0x130)], 'spPos': this[_0x199643(0x1b5)], 'prox': this[_0x199643(0x240)][_0x199643(0x124)] ? 0x1 : 0x0 }, _0x1dd21c = msgpack[_0x199643(0x19d)](_0xb920bc); if (this[_0x199643(0x16e)] && this[_0x199643(0x16e)]['readyState'] === WebSocket[_0x199643(0x22d)]) this[_0x199643(0x16e)][_0x199643(0x1e8)](_0x1dd21c); this[_0x199643(0x19f)]['forEach'](_0x48ccac => { const _0xbd1688 = _0x199643; if (_0x48ccac['readyState'] === WebSocket[_0xbd1688(0x22d)]) _0x48ccac['send'](_0x1dd21c); }); } async[_0x228674(0x1e6)](_0x5e7abf) { const _0x50b1e8 = _0x228674, _0x2bd482 = _0x5e7abf === 'mc', _0x3d23cf = _0x2bd482 ? '[MC\x20Relay]' : _0x50b1e8(0x1f3); try { if (!this[_0x50b1e8(0x23b)]) { const _0x51c99f = await fetch(_0x50b1e8(0x238) + RELAY_SERVER_DOMAIN + '/create-room?roomid=' + this[_0x50b1e8(0x240)][_0x50b1e8(0x18b)]), _0x3e406c = await _0x51c99f[_0x50b1e8(0x239)](); this['roomId'] = _0x3e406c[_0x50b1e8(0x23b)]; if (this[_0x50b1e8(0x22c)]) { this['cleanOldTags'](), this[_0x50b1e8(0x22c)][_0x50b1e8(0x1bd)](_0x50b1e8(0x19c) + this[_0x50b1e8(0x23b)] + '\x22')[_0x50b1e8(0x1f9)](() => { }); if (this[_0x50b1e8(0x240)][_0x50b1e8(0x17d)] === 'ja') await this['world'][_0x50b1e8(0x1ad)](_0x50b1e8(0x113) + this[_0x50b1e8(0x23b)]); else await this['world'][_0x50b1e8(0x1ad)](_0x50b1e8(0x11f) + this['roomId']); } } else { if (!this[_0x50b1e8(0x1d4)]) { if (this[_0x50b1e8(0x22c)]) { if (this[_0x50b1e8(0x240)]['lang'] === 'ja') await this['world'][_0x50b1e8(0x1ad)](_0x50b1e8(0x113) + this[_0x50b1e8(0x23b)]); else await this[_0x50b1e8(0x22c)][_0x50b1e8(0x1ad)](_0x50b1e8(0x11f) + this['roomId']); } } } this[_0x50b1e8(0x1d4)] = !![]; if (_0x2bd482) { console[_0x50b1e8(0x14a)](_0x50b1e8(0x24a)); if (this[_0x50b1e8(0x240)]['lang'] === 'ja') this[_0x50b1e8(0x149)](_0x50b1e8(0x1b8)); else this[_0x50b1e8(0x149)](_0x50b1e8(0x1ca)); this['logInfo'](_0x50b1e8(0x16d) + RELAY_SERVER_DOMAIN + _0x50b1e8(0x209) + this['roomId']), this[_0x50b1e8(0x164)] = '/connect\x20' + RELAY_SERVER_DOMAIN + _0x50b1e8(0x209) + this[_0x50b1e8(0x23b)]; } else { this[_0x50b1e8(0x149)]('ROOM\x20ID:\x20' + this[_0x50b1e8(0x23b)]); if (this[_0x50b1e8(0x240)][_0x50b1e8(0x17d)] === 'ja') this[_0x50b1e8(0x149)](_0x50b1e8(0x106)); else this[_0x50b1e8(0x149)](_0x50b1e8(0x1c4)); this[_0x50b1e8(0x149)](_0x50b1e8(0x160) + this['roomId']), console[_0x50b1e8(0x14a)](_0x50b1e8(0x13d)); } this[_0x50b1e8(0x17f)](); let _0x7c47ab; if (this[_0x50b1e8(0x16e)]) { _0x7c47ab = this[_0x50b1e8(0x16e)]; if (_0x7c47ab['readyState'] !== WebSocket[_0x50b1e8(0x22d)]) { } } else _0x7c47ab = new WebSocket(_0x50b1e8(0x234) + RELAY_SERVER_DOMAIN + _0x50b1e8(0x209) + this[_0x50b1e8(0x23b)] + _0x50b1e8(0x122)), this[_0x50b1e8(0x16e)] = _0x7c47ab, _0x7c47ab['on']('open', () => this['logInfo'](_0x50b1e8(0x1ba) + this[_0x50b1e8(0x23b)] + ')')), _0x7c47ab['on'](_0x50b1e8(0x165), () => { const _0x84ba76 = _0x50b1e8; if (this[_0x84ba76(0x16e)] === _0x7c47ab) this['relayWs'] = null; }), _0x7c47ab['on'](_0x50b1e8(0x1c0), _0xc78418 => console[_0x50b1e8(0x1c0)](_0x3d23cf + '\x20Error:', _0xc78418)); _0x2bd482 ? (this[_0x50b1e8(0x1b7)] = !![], this[_0x50b1e8(0x1b2)](_0x7c47ab), this[_0x50b1e8(0x1e6)]('vc')) : (this[_0x50b1e8(0x1a6)] = !![], this[_0x50b1e8(0x146)](_0x7c47ab)); } catch (_0x5d646f) { console['error'](_0x3d23cf + _0x50b1e8(0x143), _0x5d646f); } } [_0x228674(0x1fe)](_0x3fd4ec) { const _0x370d39 = _0x228674, { app_id: _0x2d4561, secret_key: _0x31dbd7, proximity: _0x4d4c46, distance: _0x42399, spectator: _0x5de141, specListen: _0x411ebc, specDim: _0x54f9d8, verify: _0x515e86, password: _0x1f5930 } = this[_0x370d39(0x240)]; _0x3fd4ec[_0x370d39(0x1e8)](msgpack['encode']({ 'password': !!(_0x515e86 || _0x1f5930), 'passwords': this[_0x370d39(0x22b)], 'app_id': _0x2d4561, 'secret_key': _0x31dbd7, 'proximity': _0x4d4c46, 'distance': _0x42399, 'spectator': _0x5de141, 'specListen': _0x411ebc, 'specDim': _0x54f9d8 })); } [_0x228674(0x146)](_0x4d84be) { const _0xdfff39 = _0x228674; _0x4d84be['on'](_0xdfff39(0x15d), async _0x6642e4 => { const _0x4443be = _0xdfff39; try { const _0x39b15a = JSON[_0x4443be(0x14c)](_0x6642e4['toString']()); if (_0x39b15a[_0x4443be(0x1ac)] === 'partner_connected') { this['sendInitialPayload'](_0x4d84be); return; } if (_0x39b15a[_0x4443be(0x1c8)] === 'run_command') { if (this[_0x4443be(0x22c)]) await this[_0x4443be(0x22c)][_0x4443be(0x1bd)](_0x39b15a[_0x4443be(0x23a)]); } } catch (_0x579962) { } }); } [_0x228674(0x1b2)](_0x32dd09) { const _0x2493d7 = _0x228674; _0x32dd09['on'](_0x2493d7(0x15d), async _0x2d9820 => { const _0x3d2201 = _0x2493d7; let _0x10127b = _0x2d9820; try { Buffer[_0x3d2201(0x202)](_0x2d9820) && _0x2d9820[_0x3d2201(0x219)] > 0x2 && _0x2d9820[0x0] === 0x1f && _0x2d9820[0x1] === 0x8b && (_0x10127b = zlib[_0x3d2201(0x17a)](_0x2d9820)); } catch (_0x4d98fb) { } try { const _0xd763fa = JSON[_0x3d2201(0x14c)](_0x10127b[_0x3d2201(0x15a)]()); if (_0xd763fa[_0x3d2201(0x1ac)] === _0x3d2201(0x19b)) { const _0x3a5086 = _0xd763fa[_0x3d2201(0x20f)] || 'minecraft'; _0x3a5086 === _0x3d2201(0x1b9) ? (this['localClient'] = new WebSocket(_0x3d2201(0x139) + this[_0x3d2201(0x240)]['port'], { 'headers': { 'x-proxvc-session': this['id'] } }), this[_0x3d2201(0x1b0)] = [], this[_0x3d2201(0x19a)]['on']('open', () => { const _0x420890 = _0x3d2201; while (this['localClientBuffer']['length'] > 0x0) { const _0x329e11 = this[_0x420890(0x1b0)][_0x420890(0x12f)](); this[_0x420890(0x19a)][_0x420890(0x1e8)](_0x329e11); } }), this['localClient']['on']('message', _0x70b27e => _0x32dd09[_0x3d2201(0x1fd)] === WebSocket[_0x3d2201(0x22d)] && _0x32dd09[_0x3d2201(0x1e8)](_0x70b27e)), this['localClient']['on'](_0x3d2201(0x165), (_0xcfd28d, _0x14455b) => { const _0x3456f6 = _0x3d2201; if (_0x32dd09['readyState'] === WebSocket[_0x3456f6(0x22d)]) _0x32dd09[_0x3456f6(0x165)](); }), this['localClient']['on']('error', _0x17cfc8 => console['error'](_0x3d2201(0x174) + _0x17cfc8[_0x3d2201(0x15d)]))) : this['sendInitialPayload'](_0x32dd09); return; } else { if (_0xd763fa[_0x3d2201(0x1ac)] === _0x3d2201(0x136)) { this[_0x3d2201(0x19a)] && (this[_0x3d2201(0x19a)][_0x3d2201(0x165)](), this[_0x3d2201(0x19a)] = null); return; } else { if (_0xd763fa['type'] === _0x3d2201(0x12c)) { console['log'](_0x3d2201(0x245)); try { let _0x28df59 = _0xd763fa['data']; _0x28df59 && _0x28df59['type'] === _0x3d2201(0x135) && (_0x28df59 = Buffer[_0x3d2201(0x1b1)](_0x28df59[_0x3d2201(0x1a5)])); try { const _0x456e79 = msgpack[_0x3d2201(0x1d7)](_0x28df59); if (_0x456e79) { if (_0x456e79[_0x3d2201(0x1c8)] === _0x3d2201(0x147) && typeof _0x456e79[_0x3d2201(0x23a)] === _0x3d2201(0x190)) { if (this[_0x3d2201(0x22c)]) this[_0x3d2201(0x22c)][_0x3d2201(0x1bd)](_0x456e79[_0x3d2201(0x23a)])[_0x3d2201(0x1f9)](() => { }); } else { if (_0x456e79[_0x3d2201(0x229)] && _0x456e79[_0x3d2201(0x216)]) this[_0x3d2201(0x142)][_0x456e79[_0x3d2201(0x229)]] = _0x456e79[_0x3d2201(0x216)]; else _0x456e79[_0x3d2201(0x1ac)] === _0x3d2201(0x19b) && this[_0x3d2201(0x1fe)](_0x32dd09); } } } catch (_0x477776) { const _0x477fcf = JSON[_0x3d2201(0x14c)](_0x28df59['toString']()); if (_0x477fcf[_0x3d2201(0x1c8)] === _0x3d2201(0x147)) { if (this[_0x3d2201(0x22c)]) this['world'][_0x3d2201(0x1bd)](_0x477fcf[_0x3d2201(0x23a)])[_0x3d2201(0x1f9)](() => { }); } } } catch (_0x4e2655) { } return; } } } if (_0xd763fa[_0x3d2201(0x1ac)] === _0x3d2201(0x137)) this[_0x3d2201(0x17b)](_0xd763fa); } catch (_0x501b16) { } if (this[_0x3d2201(0x19a)]?.[_0x3d2201(0x1fd)] === WebSocket[_0x3d2201(0x22d)]) this['localClient']['send'](_0x10127b); else this[_0x3d2201(0x19a)]?.[_0x3d2201(0x1fd)] === WebSocket[_0x3d2201(0x10b)] && this[_0x3d2201(0x1b0)][_0x3d2201(0x10a)](_0x10127b); }), _0x32dd09['on'](_0x2493d7(0x165), () => this[_0x2493d7(0x19a)]?.['close']()); } [_0x228674(0x237)]() { const _0x33c497 = _0x228674, _0x5a9cea = (_0x253cf1, _0x225f59, _0x1eaf01) => async (_0x58a218, _0x1f586b, _0x48d1b4) => { const _0x5a3893 = _0x3932; if (_0x1f586b[_0x5a3893(0x210)] !== _0x58a218['localPlayer']['name']) return; if (_0x48d1b4[0x0] !== 'true' && _0x48d1b4[0x0] !== 'false') return; const _0x37c9f6 = _0x48d1b4[0x0] === _0x5a3893(0x224); this[_0x5a3893(0x240)][_0x253cf1] = _0x37c9f6; if (_0x253cf1 === _0x5a3893(0x1dc)) this[_0x5a3893(0x240)]['password'] = _0x37c9f6; updateConfigFile(_0x253cf1, _0x37c9f6); const _0xc397b8 = this[_0x5a3893(0x240)][_0x5a3893(0x17d)] === 'ja' ? _0x37c9f6 ? _0x225f59[_0x5a3893(0x217)] : _0x225f59[_0x5a3893(0x1c3)] : _0x37c9f6 ? _0x1eaf01[_0x5a3893(0x217)] : _0x1eaf01[_0x5a3893(0x1c3)], _0x1d0a4d = this[_0x5a3893(0x240)][_0x5a3893(0x17d)] === 'ja' ? _0x5a3893(0x11d) : '<Proximity\x20VC>'; if (this[_0x5a3893(0x240)]['output']) await _0x58a218[_0x5a3893(0x1ad)](_0x1d0a4d + _0xc397b8); }; return { '!dis': async (_0x4578aa, _0x481787, _0x3cdd52) => { const _0x177249 = _0x3932; if (_0x481787[_0x177249(0x210)] !== _0x4578aa[_0x177249(0x151)][_0x177249(0x210)]) return; const _0x222e6b = Number(_0x3cdd52[0x0]); if (!isNaN(_0x222e6b)) { this[_0x177249(0x240)][_0x177249(0x144)] = _0x222e6b, updateConfigFile(_0x177249(0x144), _0x222e6b); const _0x4a8426 = this['config']['lang'] === 'ja' ? _0x177249(0x175) + _0x222e6b + _0x177249(0x180) : _0x177249(0x123) + _0x222e6b; if (this['config'][_0x177249(0x197)]) await _0x4578aa[_0x177249(0x1ad)](_0x4a8426); } }, '!name': async (_0x582f97, _0x37ce9b) => { const _0xba85b7 = _0x3932, _0x12f604 = this[_0xba85b7(0x1e7)](_0x37ce9b['name']), _0x1c8f21 = _0xba85b7(0x176) + this[_0xba85b7(0x23b)] + _0xba85b7(0x13b) + _0x12f604 + 'です', _0x38b5a6 = 'URL:https://mcproxvc.ovh/connect/\x0aRoomID\x20is\x20' + this['roomId'] + _0xba85b7(0x1c6) + _0x12f604; await _0x37ce9b['sendMessage'](this[_0xba85b7(0x240)][_0xba85b7(0x17d)] === 'ja' ? _0x1c8f21 : _0x38b5a6); if (this['config'][_0xba85b7(0x1a0)]) { !this[_0xba85b7(0x22b)][_0x12f604] && (this['passwords'][_0x12f604] = Math[_0xba85b7(0x1ae)](0x3e8 + Math[_0xba85b7(0x1b6)]() * 0x2328)[_0xba85b7(0x15a)]()); const _0xcd372c = this[_0xba85b7(0x240)]['lang'] === 'ja' ? _0xba85b7(0x1c2) + this[_0xba85b7(0x22b)][_0x12f604] + 'です' : _0xba85b7(0x21a) + this[_0xba85b7(0x22b)][_0x12f604]; await _0x37ce9b[_0xba85b7(0x1ad)](_0xcd372c); } }, '!output': _0x5a9cea('output', { 'enabled': _0x33c497(0x1da), 'disabled': _0x33c497(0x133) }, { 'enabled': _0x33c497(0x125), 'disabled': 'Output\x20disabled' }), '!password': _0x5a9cea(_0x33c497(0x1dc), { 'enabled': _0x33c497(0x22a), 'disabled': _0x33c497(0x200) }, { 'enabled': _0x33c497(0x187), 'disabled': 'verify\x20code\x20disabled' }), '!verify': _0x5a9cea(_0x33c497(0x1dc), { 'enabled': _0x33c497(0x22a), 'disabled': _0x33c497(0x200) }, { 'enabled': _0x33c497(0x187), 'disabled': _0x33c497(0x12b) }), '!pvc': _0x5a9cea(_0x33c497(0x124), { 'enabled': _0x33c497(0x1f7), 'disabled': _0x33c497(0x215) }, { 'enabled': _0x33c497(0x232), 'disabled': _0x33c497(0x162) }), '!spectator': _0x5a9cea('spectator', { 'enabled': _0x33c497(0x207), 'disabled': _0x33c497(0x11c) }, { 'enabled': _0x33c497(0x152), 'disabled': _0x33c497(0x140) }), '!specListen': _0x5a9cea(_0x33c497(0x1aa), { 'enabled': 'スペクテイターが他モードプレイヤーの会話を聞けるようになりました', 'disabled': 'スペクテイターが他モードプレイヤーの会話を聞けなくなりました' }, { 'enabled': 'Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players', 'disabled': 'Spectator\x20cannot\x20listen\x20to\x20other\x20gamemode\x20players' }), '!specDim': _0x5a9cea(_0x33c497(0x1ed), { 'enabled': _0x33c497(0x18e), 'disabled': _0x33c497(0x163) }, { 'enabled': _0x33c497(0x227), 'disabled': _0x33c497(0x1f2) }), '!lang': async (_0x4eead6, _0x5e1dd8, _0x41ae82) => { const _0x34b49e = _0x33c497; if (_0x5e1dd8[_0x34b49e(0x210)] !== _0x4eead6[_0x34b49e(0x151)][_0x34b49e(0x210)]) return; const _0x5df0ad = _0x41ae82[0x0] === 'ja' ? 'ja' : 'en'; this[_0x34b49e(0x240)][_0x34b49e(0x17d)] = _0x5df0ad, updateConfigFile('lang', _0x5df0ad), await _0x4eead6[_0x34b49e(0x1ad)](_0x5df0ad === 'ja' ? _0x34b49e(0x109) : _0x34b49e(0x159)); }, '!config': async (_0x1e134a, _0x518100) => { const _0x4bad01 = _0x33c497; if (_0x518100[_0x4bad01(0x210)] !== _0x1e134a[_0x4bad01(0x151)][_0x4bad01(0x210)]) return; const { proximity: _0x52321d, distance: _0x132293, password: _0x528311, spectator: _0xe207f2, specListen: _0xf0f78f, specDim: _0x3ed848, lang: _0x4a3737, output: _0x435495 } = this[_0x4bad01(0x240)], _0xa579f3 = _0x4a3737 === 'ja' ? _0x4bad01(0x220) : '§aEnabled§r', _0x47644e = _0x4a3737 === 'ja' ? _0x4bad01(0x141) : _0x4bad01(0x179), _0x37be31 = _0x2d258b => _0x2d258b ? _0xa579f3 : _0x47644e; let _0xe79865 = _0x4a3737 === 'ja' ? _0x4bad01(0x204) + _0x4a3737 + _0x4bad01(0x131) + _0x37be31(_0x52321d) + _0x4bad01(0x1bc) + _0x132293 + _0x4bad01(0x242) + _0x37be31(_0x528311) + _0x4bad01(0x1ef) + _0x37be31(_0x435495) + '\x0aスペクテイター分離\x20(Spectator):\x20' + _0x37be31(_0xe207f2) + '\x0a\x20-\x20スペクテイター以外の声を聞ける\x20(Listen):\x20' + _0x37be31(_0xf0f78f) + _0x4bad01(0x21d) + _0x37be31(_0x3ed848) : _0x4bad01(0x145) + _0x4a3737 + _0x4bad01(0x168) + _0x37be31(_0x52321d) + _0x4bad01(0x231) + _0x132293 + _0x4bad01(0x1c7) + _0x37be31(_0x528311) + _0x4bad01(0x22e) + _0x37be31(_0x435495) + _0x4bad01(0x19e) + _0x37be31(_0xe207f2) + '\x0a\x20-\x20Spectator\x20Listen:\x20' + _0x37be31(_0xf0f78f) + _0x4bad01(0x1ff) + _0x37be31(_0x3ed848); await _0x518100['sendMessage'](_0xe79865); }, '!help': async (_0x53d86c, _0x2ffe0a) => { const _0x47b1e4 = _0x33c497, { lang: _0x5814f6 } = this[_0x47b1e4(0x240)]; await _0x2ffe0a['sendMessage'](_0x47b1e4(0x138)), _0x5814f6 == 'ja' ? (await _0x2ffe0a[_0x47b1e4(0x1ad)]('コマンド一覧：\x0a\x20!help\x20-\x20ヘルプを表示します\x0a\x20!name\x20-\x20VCで使うゲーマータグを確認できます'), _0x2ffe0a['name'] == _0x53d86c[_0x47b1e4(0x151)][_0x47b1e4(0x210)] && (await _0x2ffe0a[_0x47b1e4(0x1ad)](_0x47b1e4(0x1cb)), await _0x2ffe0a['sendMessage'](_0x47b1e4(0x177)), await _0x2ffe0a[_0x47b1e4(0x1ad)]('spectatorが有効の場合のみ有効：\x0a\x20!specListen\x20-\x20!specListen\x20<§atrue§r/§cfalse§r>\x20スペクテイターが他モードプレイヤーの会話を聞けるようになります\x20\x0a\x20!specDim\x20-\x20!specDim\x20<§atrue§r/§cfalse§r>\x20スペクテイター同士の会話をディメンションごとに分けます'))) : (await _0x2ffe0a[_0x47b1e4(0x1ad)](_0x47b1e4(0x15f)), _0x2ffe0a[_0x47b1e4(0x210)] == _0x53d86c[_0x47b1e4(0x151)][_0x47b1e4(0x210)] && (await _0x2ffe0a['sendMessage'](_0x47b1e4(0x244)), await _0x2ffe0a[_0x47b1e4(0x1ad)](_0x47b1e4(0x1dd)), await _0x2ffe0a[_0x47b1e4(0x1ad)]('Settings\x20effective\x20only\x20when\x20\x22spectator\x22\x20is\x20true\x20:\x20\x0a\x20!specListen\x20-\x20!specListen\x20<§atrue§r/§cfalse§r>\x20Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players\x0a\x20!specDim\x20-\x20!specDim\x20<§atrue§r/§cfalse§r>\x20Spectator`s\x20VC\x20separated\x20by\x20dimension'))), await _0x2ffe0a['sendMessage'](_0x47b1e4(0x138)); } }; } [_0x228674(0x17b)](_0x54d139) { const _0x349e35 = _0x228674; if (this['vc_connected']) this[_0x349e35(0x20b)](); if (this[_0x349e35(0x11a)]) this[_0x349e35(0x114)](); for (const [_0x3f4c5f, _0x5bad8f] of Object['entries'](_0x54d139)) { if (_0x3f4c5f === _0x349e35(0x1ac)) continue; if ([_0x349e35(0x142), _0x349e35(0x124), _0x349e35(0x144), _0x349e35(0x196), 'spectators', _0x349e35(0x1aa), _0x349e35(0x1ed), 'dimensions', _0x349e35(0x130), _0x349e35(0x1a0), _0x349e35(0x17d)][_0x349e35(0x172)](_0x3f4c5f)) { if (['positions', _0x349e35(0x1b5), 'dimensions', _0x349e35(0x130)]['includes'](_0x3f4c5f)) this[_0x3f4c5f] = _0x5bad8f; else this[_0x349e35(0x240)][_0x3f4c5f] = _0x5bad8f; } } } [_0x228674(0x107)](_0x143d2b) { const _0x187e08 = _0x228674; this[_0x187e08(0x22c)] = _0x143d2b, this[_0x187e08(0x115)](), this['pendingTimeout'] && (clearTimeout(this[_0x187e08(0x1a9)]), this['pendingTimeout'] = null), this[_0x187e08(0x1d4)] && this[_0x187e08(0x23b)] && this[_0x187e08(0x22c)][_0x187e08(0x1bd)](_0x187e08(0x19c) + this[_0x187e08(0x23b)] + '\x22')['catch'](() => { }); } [_0x228674(0x14b)](_0x13ea51 = _0x228674(0x236)) { const _0x46df2c = _0x228674, _0x6c7b53 = this[_0x46df2c(0x118)]; this[_0x46df2c(0x149)](_0x46df2c(0x154) + _0x13ea51), this[_0x46df2c(0x166)] = !![]; this[_0x46df2c(0x1a9)] && (clearTimeout(this['pendingTimeout']), this[_0x46df2c(0x1a9)] = null); this['maxRuntimeTimeout'] && (clearTimeout(this[_0x46df2c(0x211)]), this[_0x46df2c(0x211)] = null); const _0x1043df = msgpack[_0x46df2c(0x19d)]({ 't': _0x46df2c(0x116), 'type': 'server_shutdown' }); this[_0x46df2c(0x16e)] && (this[_0x46df2c(0x16e)]['send'](_0x1043df), this['relayWs'][_0x46df2c(0x165)](), this[_0x46df2c(0x16e)] = null); this['localClient'] && (this['localClient'][_0x46df2c(0x165)](), this[_0x46df2c(0x19a)] = null); this[_0x46df2c(0x17c)] && (this[_0x46df2c(0x17c)]['end'](), this[_0x46df2c(0x17c)] = null); this[_0x46df2c(0x228)] = null, this[_0x46df2c(0x184)] = null, this[_0x46df2c(0x19f)][_0x46df2c(0x173)](_0x597e76 => _0x597e76['close']()), this[_0x46df2c(0x19f)]['clear'](); if (typeof this['cleanOldTags'] === _0x46df2c(0x1df)) this[_0x46df2c(0x20e)]()[_0x46df2c(0x1fa)](() => { const _0x484694 = _0x46df2c; sessionHistory[_0x484694(0x1cd)](this['id'], { 'reason': _0x13ea51, 'timestamp': Date[_0x484694(0x1a2)]() }), sessions[_0x484694(0x1f4)](this['world']), pendingSessions['delete'](this['id']); }); else { sessionHistory[_0x46df2c(0x1cd)](this['id'], { 'reason': _0x13ea51, 'timestamp': Date[_0x46df2c(0x1a2)]() }); if (sessionHistory[_0x46df2c(0x23d)] > 0x64) { const _0x147f41 = sessionHistory[_0x46df2c(0x226)]()[_0x46df2c(0x132)]()[_0x46df2c(0x23a)]; sessionHistory[_0x46df2c(0x1f4)](_0x147f41); } sessions[_0x46df2c(0x1f4)](this[_0x46df2c(0x22c)]), pendingSessions[_0x46df2c(0x1f4)](this['id']); } } } const sessions = new Map(), pendingSessions = new Map(), sessionHistory = new Map(); async function main() { const _0x5e4f2c = _0x228674; let _0x2e7d67 = INITIAL_CONFIG['port'], _0x5c80ea = INITIAL_CONFIG[_0x5e4f2c(0x198)]; _0x2e7d67 = await getPort({ 'port': [_0x2e7d67, ...makeRange(0x4abd, 0x4b20)] }), _0x5c80ea = await getPort({ 'port': [_0x5c80ea, ...makeRange(0x1f41, 0x1fa4)] }), console[_0x5e4f2c(0x14a)](_0x5e4f2c(0x148) + _0x2e7d67), console['log'](_0x5e4f2c(0x1fb) + _0x5c80ea), INITIAL_CONFIG[_0x5e4f2c(0x1a7)] = _0x2e7d67, INITIAL_CONFIG[_0x5e4f2c(0x198)] = _0x5c80ea, globalConfig[_0x5e4f2c(0x1a7)] = _0x2e7d67, globalConfig['web_port'] = _0x5c80ea, setupGlobalVcWebSocket(_0x5c80ea); const _0x2102f6 = express(), _0x308caf = http[_0x5e4f2c(0x22f)](_0x2102f6); _0x308caf[_0x5e4f2c(0x188)](_0x2e7d67); const _0x5c7b5a = new Server({ 'webSocketOptions': { 'server': _0x308caf } }); _0x2102f6[_0x5e4f2c(0x221)](express[_0x5e4f2c(0x239)]()), _0x2102f6[_0x5e4f2c(0x1e4)]('/api/start_session', async (_0x15eefb, _0xf98902) => { const _0x4b146f = _0x5e4f2c; try { const _0xe316e5 = _0x15eefb[_0x4b146f(0x24c)][_0x4b146f(0x240)] || {}, _0x5b5d1a = new Session(null, _0xe316e5); await _0x5b5d1a['startWebSession'](), pendingSessions[_0x4b146f(0x1cd)](_0x5b5d1a['id'], _0x5b5d1a), _0xf98902[_0x4b146f(0x239)]({ 'sessionId': _0x5b5d1a['id'], 'roomId': _0x5b5d1a[_0x4b146f(0x23b)], 'connectCommand': _0x5b5d1a['connectCommand'] }), _0x5b5d1a[_0x4b146f(0x17f)](); } catch (_0x24470c) { console[_0x4b146f(0x1c0)](_0x24470c), _0xf98902[_0x4b146f(0x1d9)](0x1f4)[_0x4b146f(0x239)]({ 'error': _0x24470c[_0x4b146f(0x15d)] }); } }), _0x2102f6[_0x5e4f2c(0x1e4)](_0x5e4f2c(0x111), (_0x1f393f, _0x2cd589) => { const _0x58ae46 = _0x5e4f2c, { sessionId: _0x5318c2 } = _0x1f393f['body'], _0x39a843 = pendingSessions[_0x58ae46(0x1c1)](_0x5318c2) || Array[_0x58ae46(0x1b1)](sessions[_0x58ae46(0x14e)]())[_0x58ae46(0x1bb)](_0x56d0ec => _0x56d0ec['id'] === _0x5318c2); _0x39a843 ? (_0x39a843[_0x58ae46(0x14b)](_0x58ae46(0x236)), _0x2cd589['json']({ 'success': !![] })) : _0x2cd589[_0x58ae46(0x1d9)](0x194)['json']({ 'error': 'Session\x20not\x20found' }); }), _0x2102f6[_0x5e4f2c(0x1c1)]('/api/session_status/:id', (_0xdefc3c, _0x3da9d5) => { const _0x275384 = _0x5e4f2c, _0x433494 = _0xdefc3c['params']['id'], _0x4bfd22 = pendingSessions[_0x275384(0x1c1)](_0x433494) || Array[_0x275384(0x1b1)](sessions[_0x275384(0x14e)]())[_0x275384(0x1bb)](_0x5d0bf7 => _0x5d0bf7['id'] === _0x433494); if (_0x4bfd22) _0x3da9d5[_0x275384(0x239)]({ 'status': _0x275384(0x1ce), 'sshError': _0x4bfd22[_0x275384(0x1a3)] }); else { if (sessionHistory[_0x275384(0x1b4)](_0x433494)) { const _0x57ce85 = sessionHistory[_0x275384(0x1c1)](_0x433494); _0x3da9d5['json']({ 'status': _0x275384(0x1cf), 'reason': _0x57ce85[_0x275384(0x21f)], 'timestamp': _0x57ce85[_0x275384(0x112)] }); } else _0x3da9d5[_0x275384(0x239)]({ 'status': 'not_found' }); } }); const _0x437529 = (_0x28c560, _0xf975dc) => { const _0x4f5fae = _0x5e4f2c, { type: _0xbe079e } = _0x28c560[_0x4f5fae(0x24c)], _0x1ea98a = _0x28c560[_0x4f5fae(0x199)][_0x4f5fae(0x178)]; let _0xfaeadb = null; if (_0x1ea98a) { for (const _0x2d563f of sessions[_0x4f5fae(0x14e)]()) { const _0xe676ff = _0x2d563f[_0x4f5fae(0x240)]['sub_domain']; if (_0xe676ff && _0x1ea98a[_0x4f5fae(0x186)](_0xe676ff)) { _0xfaeadb = _0x2d563f; break; } } if (!_0xfaeadb) for (const _0xf13435 of pendingSessions[_0x4f5fae(0x14e)]()) { const _0x50d5a3 = _0xf13435['config'][_0x4f5fae(0x18b)]; if (_0x50d5a3 && _0x1ea98a[_0x4f5fae(0x186)](_0x50d5a3)) { _0xfaeadb = _0xf13435; break; } } } if (_0xfaeadb) { if (_0xbe079e === _0x4f5fae(0x137)) _0xfaeadb[_0x4f5fae(0x17b)](_0x28c560[_0x4f5fae(0x24c)]); else { if (_0xbe079e === _0x4f5fae(0x11e)) _0xfaeadb[_0x4f5fae(0x14b)](_0x4f5fae(0x236)); } _0xbe079e === _0x4f5fae(0x13a) ? (_0xfaeadb[_0x4f5fae(0x1a6)] = !![], _0xfaeadb[_0x4f5fae(0x149)]('接続開始'), _0xf975dc[_0x4f5fae(0x1d9)](0xc8)[_0x4f5fae(0x239)]({ 'type': _0x4f5fae(0x13a), 'roomId': _0xfaeadb[_0x4f5fae(0x23b)], 'ws_connected': _0xfaeadb[_0x4f5fae(0x1b7)], ..._0xfaeadb[_0x4f5fae(0x240)] })) : _0xf975dc[_0x4f5fae(0x1d9)](0xc8)['json']({ 'success': !![] }); } else { sessions[_0x4f5fae(0x173)](_0x39ea53 => { const _0x58db3f = _0x4f5fae; if (_0xbe079e === 'data_update') _0x39ea53[_0x58db3f(0x17b)](_0x28c560[_0x58db3f(0x24c)]); else { if (_0xbe079e === _0x58db3f(0x11e)) _0x39ea53[_0x58db3f(0x14b)](_0x58db3f(0x236)); } }); const _0x2dcdc0 = sessions['values']()[_0x4f5fae(0x132)]()['value'] || pendingSessions[_0x4f5fae(0x14e)]()['next']()[_0x4f5fae(0x23a)]; _0x2dcdc0 ? _0xbe079e === _0x4f5fae(0x13a) ? (_0x2dcdc0['vc_connected'] = !![], _0x2dcdc0[_0x4f5fae(0x149)](_0x4f5fae(0x15e)), _0xf975dc['status'](0xc8)['json']({ 'type': 'initialization', 'roomId': _0x2dcdc0['roomId'], 'ws_connected': _0x2dcdc0[_0x4f5fae(0x1b7)], ..._0x2dcdc0[_0x4f5fae(0x240)] })) : _0xf975dc['status'](0xc8)[_0x4f5fae(0x239)]({ 'success': !![] }) : _0xf975dc[_0x4f5fae(0x1d9)](0xc8)['json']({ 'error': 'No\x20active\x20sessions' }); } }; _0x2102f6[_0x5e4f2c(0x1e4)]('/', _0x437529), _0x5c7b5a['on'](ServerEvent[_0x5e4f2c(0x183)], ({ world: _0x5df9a5 }) => { const _0x1b9d4b = _0x5e4f2c, _0xd5e965 = _0x5df9a5[_0x1b9d4b(0x23e)], _0x2aa936 = _0x5df9a5['pvcDomain']; let _0x10e6d2 = Array[_0x1b9d4b(0x1b1)](sessions['values']())[_0x1b9d4b(0x1bb)](_0x18d1fa => _0x18d1fa['id'] === _0xd5e965); !_0x10e6d2 && _0xd5e965 && (_0x10e6d2 = pendingSessions[_0x1b9d4b(0x1c1)](_0xd5e965)); if (!_0x10e6d2 && _0x2aa936) { _0x10e6d2 = Array['from'](pendingSessions[_0x1b9d4b(0x14e)]())['find'](_0x513448 => { const _0x144f90 = _0x1b9d4b, _0x526638 = _0x513448['config'][_0x144f90(0x18b)]; if (_0x526638 && _0x2aa936[_0x144f90(0x186)](_0x526638)) return !![]; return ![]; }); if (_0x10e6d2) { } } if (_0x10e6d2) pendingSessions[_0x1b9d4b(0x1b4)](_0x10e6d2['id']) && pendingSessions['delete'](_0x10e6d2['id']), sessions[_0x1b9d4b(0x1cd)](_0x5df9a5, _0x10e6d2), _0x10e6d2[_0x1b9d4b(0x107)](_0x5df9a5); else { if (_0x2aa936 && INITIAL_CONFIG[_0x1b9d4b(0x18b)] && !_0x2aa936['startsWith'](INITIAL_CONFIG['sub_domain'])) { console[_0x1b9d4b(0x121)](_0x1b9d4b(0x16a) + _0x2aa936 + '\x27'); return; } _0x10e6d2 = new Session(_0x5df9a5), sessions[_0x1b9d4b(0x1cd)](_0x5df9a5, _0x10e6d2), _0x10e6d2[_0x1b9d4b(0x115)](); } }), _0x5c7b5a['on'](ServerEvent[_0x5e4f2c(0x167)], ({ world: _0x2500df }) => { const _0xc972e = _0x5e4f2c, _0x5124ed = sessions['get'](_0x2500df); if (_0x5124ed) { sessions[_0xc972e(0x1f4)](_0x2500df); !pendingSessions[_0xc972e(0x1b4)](_0x5124ed['id']) && pendingSessions['set'](_0x5124ed['id'], _0x5124ed); if (_0x5124ed[_0xc972e(0x1a9)]) clearTimeout(_0x5124ed[_0xc972e(0x1a9)]); _0x5124ed[_0xc972e(0x1a9)] = setTimeout(() => { const _0x13f227 = _0xc972e; pendingSessions['has'](_0x5124ed['id']) && _0x5124ed[_0x13f227(0x14b)](_0x13f227(0x236)); }, 0x7530); } }), _0x5c7b5a['on'](ServerEvent['PlayerChat'], async ({ sender: _0x527458, message: _0x20ee1b, world: _0x5208f4 }) => { const _0x3616bd = _0x5e4f2c, _0x17482c = sessions[_0x3616bd(0x1c1)](_0x5208f4); if (_0x17482c) { const [_0x3f3761, ..._0x201385] = _0x20ee1b[_0x3616bd(0x156)]('\x20'); if (_0x17482c[_0x3616bd(0x218)][_0x3f3761]) await _0x17482c[_0x3616bd(0x218)][_0x3f3761](_0x5208f4, _0x527458, _0x201385); } }), _0x5c7b5a['on'](ServerEvent[_0x5e4f2c(0x18c)], async ({ player: _0xcebaa9, world: _0x16fc06 }) => { const _0x3ee267 = _0x5e4f2c, _0x5f6e5 = sessions['get'](_0x16fc06); _0x5f6e5 && (_0x5f6e5[_0x3ee267(0x149)](_0x3ee267(0x126) + _0xcebaa9[_0x3ee267(0x210)]), _0x5f6e5[_0x3ee267(0x208)][_0x3ee267(0x1af)](_0xcebaa9[_0x3ee267(0x210)]), setTimeout(async () => { const _0x55a629 = _0x3ee267; try { const _0x308d9e = _0x5f6e5[_0x55a629(0x1e7)](_0xcebaa9[_0x55a629(0x210)]), { roomId: _0x496ec1, passwords: _0x394925, config: _0x397b35 } = _0x5f6e5, _0x5af2b6 = _0x55a629(0x214) + _0x496ec1 + _0x55a629(0x13b) + _0x308d9e + 'です', _0x12926d = _0x55a629(0x171) + _0x496ec1 + _0x55a629(0x1c6) + _0x308d9e; await _0xcebaa9[_0x55a629(0x1ad)](_0x397b35[_0x55a629(0x17d)] === 'ja' ? _0x5af2b6 : _0x12926d); if (_0x397b35[_0x55a629(0x1a0)]) { if (!_0x394925[_0x308d9e]) _0x394925[_0x308d9e] = Math['floor'](0x3e8 + Math[_0x55a629(0x1b6)]() * 0x2328)['toString'](); const _0x5d8417 = _0x397b35[_0x55a629(0x17d)] === 'ja' ? _0x55a629(0x1f1) + _0x394925[_0x308d9e] + 'です' : 'Password\x20is\x20' + _0x394925[_0x308d9e]; await _0xcebaa9[_0x55a629(0x1ad)](_0x5d8417); } } catch (_0x379c02) { } }, 0x1f4)); }), _0x5c7b5a['on'](ServerEvent['PlayerLeave'], ({ player: _0x4d04af, world: _0x5c3d94 }) => { const _0x4395ae = _0x5e4f2c, _0x46515d = sessions[_0x4395ae(0x1c1)](_0x5c3d94); if (_0x46515d) { _0x46515d[_0x4395ae(0x149)]('退出:\x20' + _0x4d04af[_0x4395ae(0x210)]); _0x4d04af[_0x4395ae(0x210)] === _0x5c3d94[_0x4395ae(0x151)][_0x4395ae(0x210)] && (_0x46515d[_0x4395ae(0x149)](_0x4395ae(0x1fc)), _0x46515d['destroy'](_0x4395ae(0x236))); _0x46515d[_0x4395ae(0x208)][_0x4395ae(0x1f4)](_0x4d04af[_0x4395ae(0x210)]); const _0x362df5 = _0x46515d[_0x4395ae(0x1e7)](_0x4d04af[_0x4395ae(0x210)]); delete _0x46515d[_0x4395ae(0x142)][_0x362df5], delete _0x46515d[_0x4395ae(0x1e1)][_0x362df5], delete _0x46515d[_0x4395ae(0x130)][_0x362df5], delete _0x46515d['spectators'][_0x362df5]; } }), _0x5c7b5a['on'](ServerEvent['PlayerTransform'], ({ player: _0x1b524e, world: _0x1109dd }) => { const _0x58a5f6 = _0x5e4f2c, _0x3e3a40 = sessions[_0x58a5f6(0x1c1)](_0x1109dd); if (!_0x3e3a40 || !_0x1b524e || !_0x1b524e['position']) return; const _0xff6238 = _0x3e3a40[_0x58a5f6(0x1e7)](_0x1b524e['name']); _0x3e3a40[_0x58a5f6(0x142)][_0xff6238] = { 'x': _0x1b524e[_0x58a5f6(0x216)]['x'], 'y': _0x1b524e[_0x58a5f6(0x216)]['y'], 'z': _0x1b524e[_0x58a5f6(0x216)]['z'] }; if (_0x1b524e[_0x58a5f6(0x120)] !== undefined) _0x3e3a40['yRots'][_0xff6238] = _0x1b524e['yRot']; if (_0x1b524e[_0x58a5f6(0x12e)] !== undefined) _0x3e3a40['dimensions'][_0xff6238] = _0x1b524e['dimension']; }); if (!process[_0x5e4f2c(0x24d)][_0x5e4f2c(0x172)](_0x5e4f2c(0x1ec))) try { const _0x1f0ac2 = new Session(null, globalConfig); await _0x1f0ac2['startWebSession'](), pendingSessions[_0x5e4f2c(0x1cd)](_0x1f0ac2['id'], _0x1f0ac2); } catch (_0x2e246f) { console[_0x5e4f2c(0x1c0)](_0x5e4f2c(0x191), _0x2e246f); } else try { fs['writeFileSync'](_0x5e4f2c(0x110), JSON['stringify']({ 'port': _0x2e7d67, 'web_port': _0x5c80ea }, null, 0x2)); } catch (_0x2bb6f4) { console[_0x5e4f2c(0x1c0)](_0x5e4f2c(0x1db), _0x2bb6f4); } } process['on']('SIGINT', () => { const _0x4bb57f = _0x228674; sessions[_0x4bb57f(0x173)](_0x571cef => _0x571cef['destroy']()), process[_0x4bb57f(0x1b3)](); }), main();